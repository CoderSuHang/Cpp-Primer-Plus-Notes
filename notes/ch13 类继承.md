## ç¬¬åä¸‰ç«  ç±»ç»§æ‰¿

é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸»è¦ç›®çš„ä¹‹ä¸€æ˜¯æä¾›å¯é‡ç”¨çš„ä»£ç ã€‚å¼€å‘æ–°é¡¹ç›®ï¼Œå°¤å…¶æ˜¯å½“é¡¹ç›®ååˆ†åºå¤§æ—¶ï¼Œé‡ç”¨ç»è¿‡æµ‹è¯•çš„ä»£ç æ¯”é‡æ–°ç¼–å†™ä»£ç è¦å¥½å¾—å¤šã€‚ä½¿ç”¨å·²æœ‰çš„ä»£ç å¯ä»¥èŠ‚çœæ—¶é—´ï¼Œç”±äºå·²æœ‰çš„ä»£ç å·²è¢«ä½¿ç”¨å’Œæµ‹è¯•è¿‡ï¼Œå› æ­¤æœ‰åŠ©äºé¿å…åœ¨ç¨‹åºä¸­å¼•å…¥é”™è¯¯ã€‚å¦å¤–ï¼Œå¿…é¡»è€ƒè™‘çš„ç»†èŠ‚è¶Šå°‘ï¼Œä¾¿è¶Šèƒ½ä¸“æ³¨äºç¨‹åºçš„æ•´ä½“ç­–ç•¥ã€‚

C++æä¾›äº†æ¯”ä¿®æ”¹ä»£ç æ›´å¥½çš„æ–¹æ³•æ¥æ‰©å±•å’Œä¿®æ”¹ç±»ã€‚è¿™ç§æ–¹æ³•å«ä½œç±»ç»§æ‰¿ï¼Œå®ƒèƒ½å¤Ÿä»å·²æœ‰çš„ç±»æ´¾ç”Ÿå‡ºæ–°çš„ç±»ï¼Œè€Œæ´¾ç”Ÿç±»ç»§æ‰¿äº†åŸæœ‰ç±»ï¼ˆç§°ä¸ºåŸºç±»ï¼‰çš„ç‰¹å¾ï¼ŒåŒ…æ‹¬æ–¹æ³•ã€‚

* å¯ä»¥åœ¨å·²æœ‰ç±»çš„åŸºç¡€ä¸Šæ·»åŠ åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ•°ç»„ç±»ï¼Œå¯ä»¥æ·»åŠ æ•°å­¦è¿ç®—ã€‚
* å¯ä»¥ç»™ç±»æ·»åŠ æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå­—ç¬¦ä¸²ç±»ï¼Œå¯ä»¥æ´¾ç”Ÿå‡ºä¸€ä¸ªç±»ï¼Œå¹¶æ·»åŠ æŒ‡å®šå­—ç¬¦ä¸²æ˜¾ç¤ºé¢œè‰²çš„æ•°æ®æˆå‘˜ã€‚
* å¯ä»¥ä¿®æ”¹ç±»æ–¹æ³•çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¯¹äºä»£è¡¨æä¾›ç»™é£æœºä¹˜å®¢çš„æœåŠ¡çš„ Passenger ç±»å¯ä»¥æ´¾ç”Ÿå‡ºæä¾›æ›´é«˜çº§åˆ«æœåŠ¡çš„FirstClassPassenger ç±»ã€‚

å½“ç„¶ï¼Œå¯ä»¥é€šè¿‡å¤åˆ¶åŸå§‹ç±»ä»£ç ï¼Œå¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹æ¥å®Œæˆä¸Šè¿°å·¥ä½œï¼Œä½†ç»§æ‰¿æœºåˆ¶åªéœ€æä¾›æ–°ç‰¹æ€§ï¼Œç”šè‡³ä¸éœ€è¦è®¿é—®æºä»£ç å°±å¯ä»¥æ´¾ç”Ÿå‡ºç±»ã€‚

### 13.1 ä¸€ä¸ªç®€å•çš„åŸºç±»

ä»ä¸€ä¸ªç±»æ´¾ç”Ÿå‡ºå¦ä¸€ä¸ªç±»æ—¶ï¼ŒåŸå§‹ç±»ç§°ä¸ºåŸºç±»ï¼Œç»§æ‰¿ç±»ç§°ä¸ºæ´¾ç”Ÿç±»ã€‚

* 1ã€åŸºç±»ï¼š

  * ä»¥Webtownä¿±ä¹éƒ¨å†³å®šè·Ÿè¸ªä¹’ä¹“çƒä¼šä¼šå‘˜ä¸ºä¾‹ï¼Œè®¾è®¡ä¸€ä¸ªç®€å•çš„ TableTennisPlayer ç±»ã€‚

  * TableTennisPlayer ç±»åªæ˜¯è®°å½•ä¼šå‘˜çš„å§“åä»¥åŠæ˜¯å¦æœ‰çƒæ¡Œã€‚

    * ```c++
      #pragma once
      // ch13_01_tabtenn0.h -- a table-tennis base class
      #ifndef CH13_01_TABTENN0_H_
      #define CH13_01_TABTENN0_H_
      #include <string>
      
      using std::string;
      // simple base class
      class TableTennisPlayer
      {
      private:
      	string firstname;
      	string lastname;
      	bool hasTable;
      public:
      	TableTennisPlayer(const string& fn = "none", const string& ln = "none", bool ht = false);
      	void Name() const;
      	bool HasTable() const { return hasTable; };
      	void ResetTable(bool v) { hasTable = v; };
      };
      #endif
      ```

    * ```c++
      // ch13_02_tabtenn0.cpp -- simple base-class method
      #include "ch13_01_tabtenn0.h"
      #include <iostream>
      
      TableTennisPlayer::TableTennisPlayer(const string & fn, 
      	const string & ln, bool ht) : firstname(fn), 
      	lastname(ln), hasTable(ht) {}
      
      void TableTennisPlayer::Name() const
      {
      	std::cout << lastname << ", " << firstname;
      }
      ```

      * å…¶ä¸­ch13_02_tabtenn0.cppä½¿ç”¨äº†ç¬¬12ç« ä»‹ç»çš„æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•ï¼Œç­‰ä»·äºä¸‹é¢å†…å®¹ï¼š

        * ```c++
          TableTennisPlayer::TableTennisPlayer(const string & fn, 
          	const string & ln, bool ht)
          {
          	firstname = fn; 
          	lastname = ln;
              hasTable = ht;
          }
          ```

        * è¯¦ç»†æ­¥éª¤æ˜¯ï¼š

          * è¿™å°†é¦–å…ˆä¸º firstname è°ƒç”¨ string çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œå†è°ƒç”¨ string çš„èµ‹å€¼è¿ç®—ç¬¦å°† firstname è®¾ç½®ä¸º fnï¼Œ
          * ä½†åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•å¯å‡å°‘ä¸€ä¸ªæ­¥éª¤ï¼Œå®ƒç›´æ¥ä½¿ç”¨ string çš„å¤åˆ¶æ„é€ å‡½æ•°å°† firstname åˆå§‹åŒ–ä¸º fn

    * ```c++
      // ch13_03_usett0.cpp -- using a base class
      #include <iostream>
      #include "ch13_01_tabtenn0.h"
      
      int main(void)
      {
      	using std::cout;
      	TableTennisPlayer player1("Chuck", "Blizzard", true);
      	TableTennisPlayer player2("Tara", "Boomdea", false);
      
      	player1.Name();
      	if (player1.HasTable())
      		cout << ": has a table.\n";
      	else
      		cout << ": hasn't a table.\n";
      
      	player2.Name();
      	if (player2.HasTable())
      		cout << ": has a table.\n";
      	else
      		cout << ": hasn't a table.\n";
      
      	return 0;
      }
      ```

  * ç»“æœï¼š

    * ```c++
      Blizzard, Chuck: has a table.
      Boomdea, Tara: hasn't a table.
      ```

    * æ³¨æ„åˆ°è¯¥ç¨‹åºå®ä¾‹åŒ–å¯¹è±¡æ—¶å°† C-é£æ ¼å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼š

      * ```c++
        TableTennisPlayer player1("Chuck", "Blizzard", true);
        TableTennisPlayer player2("Tara", "Boomdea", false);
        ```

      * ä½†æ„é€ å‡½æ•°çš„å½¢å‚ç±»å‹è¢«å£°æ˜ä¸º const string &ã€‚è¿™å¯¼è‡´ç±»å‹ä¸åŒ¹é…ï¼Œä½†ä¸ç¬¬12ç« åˆ›å»ºçš„ String ç±»ä¸€æ ·ï¼Œstring ç±»æœ‰ä¸€ä¸ªå°† const char * ä½œä¸ºå‚æ•°çš„æ„é€ å‡½æ•°ï¼Œä½¿ç”¨C-é£æ ¼å­—ç¬¦ä¸²åˆå§‹åŒ– string å¯¹è±¡æ—¶ï¼Œå°†è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ„é€ å‡½æ•°ã€‚

      * æ€»ä¹‹ï¼Œ**å¯å°† string å¯¹è±¡æˆ–C-é£æ ¼å­—ç¬¦ä¸²ä½œä¸ºæ„é€ å‡½æ•° TableTennisPlayer çš„å‚æ•°**ï¼š

        * å°†å‰è€…ä½œä¸ºå‚æ•°æ—¶ï¼Œå°†è°ƒç”¨æ¥å— const string & ä½œä¸ºå‚æ•°çš„ string æ„é€ å‡½æ•°ï¼›
        * è€Œå°†åè€…ä½œä¸ºå‚æ•°æ—¶ï¼Œå°†è°ƒç”¨æ¥å— const char* ä½œä¸ºå‚æ•°çš„ string æ„é€ å‡½æ•°ã€‚

#### 13.1.1 æ´¾ç”Ÿä¸€ä¸ªç±»

Webtown ä¿±ä¹éƒ¨çš„ä¸€äº›æˆå‘˜**æ›¾ç»**å‚åŠ è¿‡å½“åœ°çš„ä¹’ä¹“çƒé”¦æ ‡èµ›ï¼šéœ€è¦è¿™æ ·ä¸€ä¸ªç±»ï¼Œå®ƒèƒ½åŒ…æ‹¬æˆå‘˜åœ¨æ¯”èµ›ä¸­çš„æ¯”åˆ†ã€‚

* ä¸å…¶ä»é›¶å¼€å§‹ï¼Œä¸å¦‚ä» TableTennisClass ç±»æ´¾ç”Ÿå‡ºä¸€ä¸ªç±»ã€‚é¦–å…ˆå°† RatedPlayer ç±»å£°æ˜ä¸ºä» TableTennisClass ç±»æ´¾ç”Ÿè€Œæ¥ï¼š

  * ```c++
    // RatedPlayer derives from the TableTennisPlayer base class
    class RatedPlayer : public TableTennisPlayer
    {
    ...
    };
    ```

  * å†’å·æŒ‡å‡º RatedPlayer ç±»çš„åŸºç±»æ˜¯ public TableTennisPlayer ç±»ã€‚

  * â€œclass RatedPlayer : public TableTennisPlayerâ€ç‰¹æ®Šçš„å£°æ˜å¤´è¡¨æ˜ TableTennisPlayer æ˜¯ä¸€ä¸ªå…¬æœ‰åŸºç±»ï¼Œè¿™è¢«ç§°ä¸ºå…¬æœ‰æ´¾ç”Ÿã€‚

    * æ´¾ç”Ÿç±»å¯¹è±¡åŒ…å«åŸºç±»å¯¹è±¡ï¼›
    * ä½¿ç”¨å…¬æœ‰æ´¾ç”Ÿï¼š
      * åŸºç±»çš„å…¬æœ‰æˆå‘˜å°†æˆä¸ºæ´¾ç”Ÿç±»çš„å…±æœ‰æˆå‘˜ï¼›
      * åŸºç±»çš„ç§æœ‰éƒ¨åˆ†ç§°ä¸ºæ´¾ç”Ÿç±»çš„ä¸€éƒ¨åˆ†ï¼Œä½†åªèƒ½é€šè¿‡åŸºç±»çš„å…¬æœ‰å’Œä¿æŠ¤æ–¹æ³•è®¿é—®ã€‚

  * RatedPlayer å¯¹è±¡å°†å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

    * æ´¾ç”Ÿç±»å¯¹è±¡å‚¨å­˜äº†åŸºç±»çš„æ•°æ®æˆå‘˜ï¼ˆæ´¾ç”Ÿç±»ç»§æ‰¿äº†åŸºç±»çš„å®ç°ï¼‰ï¼›
    * æ´¾ç”Ÿç±»å¯¹è±¡å¯ä»¥ä½¿ç”¨åŸºç±»çš„æ–¹æ³•ï¼ˆæ´¾ç”Ÿç±»ç»§æ‰¿äº†åŸºç±»çš„æ¥å£ï¼‰ã€‚
    * å› æ­¤ï¼ŒRatedPlayer å¯¹è±¡å¯ä»¥å‚¨å­˜è¿åŠ¨å‘˜çš„å§“ååŠå…¶æ˜¯å¦æœ‰çƒæ¡Œï¼Œå¦å¤–è¿˜å¯ä»¥ä½¿ç”¨ T ç±»çš„Name()ã€hasTable()ã€ResetTable()æ–¹æ³•ï¼š
      * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/3dc3f49a-a1a3-490d-9ed5-5ecbb3b498fe)

  * éœ€è¦å†ç»§æ‰¿ç‰¹æ€§ä¸­æ·»åŠ ä»€ä¹ˆå‘¢ï¼š

    * æ´¾ç”Ÿç±»éœ€è¦è‡ªå·±çš„æ„é€ å‡½æ•°ã€‚

    * æ´¾ç”Ÿç±»å¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ é¢å¤–çš„æ•°æ®æˆå‘˜å’Œæˆå‘˜å‡½æ•°ã€‚

    * åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ´¾ç”Ÿç±»éœ€è¦å¦ä¸€ä¸ªæ•°æ®æˆå‘˜æ¥å­˜å‚¨æ¯”åˆ†ï¼Œè¿˜åº”åŒ…å«æ£€ç´¢æ¯”åˆ†çš„æ–¹æ³•å’Œé‡ç½®æ¯”åˆ†çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œç±»å£°æ˜ä¸ä¸‹é¢ç±»ä¼¼ï¼š

      * ```c++
        // simple detived class
        class RatedPlayer : public TableTennisPlayer
        {
        private:
            unsigned int rating;	// add a data member
        public:
            RatedPlayer (unsigned int r = 0, const string & fn = "none", const string& ln = "none", bool ht = false);
            RatedPlayer (unsigned int r, const TableTennisPlayer & tp);
            unsigned int Rating () const { return rating; }		// add a method
            void ResetRating (unsigned int r) { rating = r; }	// add a method
        };
        ```

#### 13.1.2 æ„é€ å‡½æ•°ï¼šè®¿é—®æƒé™çš„è€ƒè™‘

ğŸ“Œæ´¾ç”Ÿç±»ä¸èƒ½ç›´æ¥è®¿é—®åŸºç±»çš„ç§æœ‰æˆå‘˜ï¼Œè€Œå¿…é¡»é€šè¿‡åŸºç±»æ–¹è¿›è¡Œè®¿é—®ã€‚å…·ä½“åœ°è¯´ï¼Œæ´¾ç”Ÿç±»æ„é€ å‡½æ•°å¿…é¡»ä½¿ç”¨åŸºç±»æ„é€ å‡½æ•°ã€‚

åˆ›å»ºæ´¾ç”Ÿå¯¹è±¡æ—¶ï¼Œç¨‹åºé¦–å…ˆåˆ›å»ºåŸºç±»å¯¹è±¡ï¼š

* ```c++
  RatedPlayer::RatedPlayer(unsigned int r, const string & fn,
                          const string & ln, bool ht) : TableTennisPlayer(fn, 
                          ln, ht)
  {
      rating = r;
  }
  ```

* å…¶ä¸­ï¼š**TableTennisPlayer (fn, ln, ht) æ˜¯æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨**ã€‚å®ƒæ˜¯å¯æ‰§è¡Œçš„ä»£ç ï¼Œè°ƒç”¨TableTennisPlayeræ„é€ å‡½æ•°ï¼š

  * ```C++
    RatedPlayer rplayer1(1140, "Mallory", "Duck", true);
    ```

    * RatedPlayeræ„é€ å‡½æ•°å°†æŠŠå®å‚ï¼ˆ"Mallory", "Duck", trueï¼‰èµ‹ç»™å½¢å‚ï¼ˆfn, ln, htï¼‰
    * ç„¶åå°†è¿™äº›å‚æ•°ä½œä¸ºå®å‚ä¼ é€’ç»™TableTennisPlayeræ„é€ å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åˆ›å»ºä¸€ä¸ªåµŒå¥—TableTennisPlayerå¯¹è±¡ï¼Œå¹¶å°†æ•°æ®ï¼ˆ"Mallory", "Duck", trueï¼‰å­˜å‚¨åœ¨è¯¥å¯¹è±¡ä¸­ã€‚
    * æœ€åï¼Œç¨‹åºè¿›å…¥RatedPlayeræ„é€ å‡½æ•°æ„é€ å‡½æ•°ä½“ï¼Œå®ŒæˆRealPlayerå¯¹è±¡çš„åˆ›å»ºï¼Œå¹¶å°†å‚æ•°çš„ r å€¼ï¼ˆ1140ï¼‰èµ‹ç»™ratingæˆå‘˜ï¼š
      * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/24b7d846-aaf7-447f-b044-20ad6e2dc6c2)


  * å¦‚æœçœç•¥æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼Œç¨‹åºä¼šä½¿ç”¨é»˜è®¤çš„åŸºç±»æ„é€ å‡½æ•°è¿›è¡Œåˆ›å»ºåŸºç±»å¯¹è±¡ï¼Œè§P485

* å¦‚æœæ„¿æ„ï¼Œä¹Ÿå¯ä»¥å¯¹æ´¾ç”Ÿç±»æˆå‘˜ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨**æˆå‘˜å**ï¼Œè€Œä¸æ˜¯ç±»åã€‚æ‰€ä»¥ï¼Œç¬¬äºŒä¸ªæ„é€ å‡½æ•°å¯ä»¥æŒ‰ç…§ä¸‹è¿°æ–¹å¼ç¼–å†™ï¼š

  * ```c++
    // alternative version
    RatedPlayer::RatedPlayer(unsigned int r, const TableTennisPlayer & tp)
        : TableTennisPlayer(tp), rating(r)
        {
        }
    ```

* æœ‰å…³æ´¾ç”Ÿç±»æ„é€ å‡½æ•°çš„è¦ç‚¹å¦‚ä¸‹ï¼š

  * é¦–å…ˆåˆ›å»ºåŸºç±»å¯¹è±¡ï¼›
  * æ´¾ç”Ÿç±»æ„é€ å‡½æ•°åº”é€šè¿‡æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨å°†åŸºç±»ä¿¡æ¯ä¼ é€’ç»™åŸºç±»æ„é€ å‡½æ•°ï¼›
  * æ´¾ç”Ÿç±»æ„é€ å‡½æ•°åº”åˆå§‹åŒ–æ´¾ç”Ÿç±»æ–°å¢çš„æ•°æ®æˆå‘˜ã€‚

* åˆ›å»ºæ´¾ç”Ÿç±»å¯¹è±¡æ—¶ï¼Œç¨‹åºé¦–å…ˆè°ƒç”¨åŸºç±»æ„é€ å‡½æ•°ï¼Œç„¶åå†è°ƒç”¨æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ï¼š

  * åŸºç±»æ„é€ å‡½æ•°è´Ÿè´£åˆå§‹åŒ–ç»§æ‰¿çš„æ•°æ®æˆå‘˜ï¼›
  * æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ä¸»è¦ç”¨äºåˆå§‹åŒ–æ–°å¢çš„æ•°æ®æˆå‘˜ã€‚
    * æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°æ€»æ˜¯è°ƒç”¨ä¸€ä¸ªåŸºç±»æ„é€ å‡½æ•°ã€‚å¯ä»¥ä½¿ç”¨åˆå§‹åŒ–å™¨åˆ—è¡¨è¯­æ³•æŒ‡æ˜è¦ä½¿ç”¨çš„åŸºç±»æ„é€ å‡½æ•°ï¼Œå¦åˆ™å°†ä½¿ç”¨é»˜è®¤çš„åŸºç±»æ„é€ å‡½æ•°ã€‚
    * æ´¾ç”Ÿç±»å¯¹è±¡è¿‡æœŸæ—¶ï¼Œç¨‹åºå°†é¦–å…ˆè°ƒç”¨æ´¾ç”Ÿç±»ææ„å‡½æ•°ï¼Œç„¶åå†è°ƒç”¨åŸºç±»ææ„å‡½æ•°ã€‚

ğŸ“Œæˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼š

* æ´¾ç”Ÿç±»æ„é€ å‡½æ•°å¯ä»¥ä½¿ç”¨åˆå§‹åŒ–å™¨åˆ—è¡¨æœºåˆ¶å°†å€¼ä¼ é€’ç»™åŸºç±»æ„é€ å‡½æ•°ï¼š

  * ```c++
    derived::derived(type1 x, type2 y) : base(x, y)
    {
        ...
    }
    ```

  * å…¶ä¸­ derived æ˜¯æ´¾ç”Ÿç±»ï¼Œbase æ˜¯åŸºç±»ï¼Œxå’Œyæ˜¯åŸºç±»æ„é€ å‡½æ•°ä½¿ç”¨çš„å˜é‡ã€‚

  * å¦‚æœæ²¡æœ‰åœ¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ä¸­æä¾›åŸºç±»æ„é€ å‡½æ•°ï¼Œç¨‹åºå°†ä½¿ç”¨é»˜è®¤çš„åŸºç±»æ„é€ å‡½æ•°ã€‚æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨åªèƒ½ç”¨äºæ„é€ å‡½æ•°ã€‚



#### 13.1.3 ä½¿ç”¨æ´¾ç”Ÿç±»

è¦ä½¿ç”¨æ´¾ç”Ÿç±»ï¼Œç¨‹åºå¿…é¡»è¦**èƒ½å¤Ÿè®¿é—®åŸºç±»å£°æ˜**ã€‚ç¨‹åºæ¸…å• 13.4 å°†è¿™**ä¸¤ç§ç±»**çš„**å£°æ˜**ç½®äº**åŒä¸€ä¸ªå¤´æ–‡ä»¶**ä¸­ã€‚ä¹Ÿå¯ä»¥å°†æ¯ä¸ªç±»æ”¾åœ¨ç‹¬ç«‹çš„å¤´æ–‡ä»¶ä¸­ï¼Œä½†ç”±äºè¿™ä¸¤ä¸ªç±»æ˜¯ç›¸å…³çš„ï¼Œæ‰€ä»¥æŠŠå…¶ç±»å£°æ˜æ”¾åœ¨ä¸€èµ·æ›´åˆé€‚ã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    #pragma once
    // ch13_04_tabtenn1.h -- a table-tennis base class
    #ifndef CH13_04_TABTENN1_H_
    #define CH13_04_TABTENN1_H_
    #include<string>
    using std::string;
    // simple base class
    class TableTennisPlayer
    {
    private:
    	string firstname;
    	string lastname;
    	bool hasTable;
    public:
    	TableTennisPlayer(const string& fn = "none",
    					  const string& ln = "none", bool ht = false);
    	void Name() const;
    	bool HasTable() const { return hasTable; };
    	void ResetTable(bool v) { hasTable = v; };
    };
    
    // simple derived class
    class RatedPlayer : public TableTennisPlayer
    {
    private:
    	unsigned int rating;
    public:
    	RatedPlayer(unsigned int r = 0, const string& fn = "none",
    				const string& ln = "none", bool ht = false);
    	RatedPlayer(unsigned int r, const TableTennisPlayer& tp);
    	unsigned int Rating() const { return rating; }
    	void ResetRating(unsigned int r) { rating = r; }
    };
    #endif
    ```

  * ```c++
    // ch13_05_tabtenn1.cpp -- simple base-class methods
    #include "ch13_04_tabtenn1.h"
    #include <iostream>
    
    TableTennisPlayer::TableTennisPlayer (const string & fn,
    	const string & ln, bool ht) : firstname(fn),
    	lastname(ln), hasTable(ht) {}
    
    void TableTennisPlayer::Name() const
    {
    	std::cout << lastname << ", " << firstname;
    }
    
    // RatedPlayer methods
    RatedPlayer::RatedPlayer (unsigned int r, const string& fn,
    	const string& ln, bool ht) : TableTennisPlayer(fn, ln, ht)
    {
    	rating = r;
    }
    
    RatedPlayer::RatedPlayer(unsigned int r, const TableTennisPlayer& tp)
    	: TableTennisPlayer(tp), rating(r)
    {
    }
    ```

  * ```c++
    // ch13_06_usett1.cpp -- using base class and derived class
    #include <iostream>
    #include "ch13_04_tabtenn1.h"
    
    int main(void)
    {
    	using std::cout;
    	using std::endl;
    	TableTennisPlayer player1("Tara", "Boomdea", false);
    	RatedPlayer rplayer1(1140, "Mallory", "Duck", true);
    	rplayer1.Name();
    	if (rplayer1.HasTable())
    		cout << ": has a table.\n";
    	else
    		cout << ": hasn't a table.\n";
    	player1.Name();
    	if (player1.HasTable())
    		cout << ": has a table\n";
    	else
    		cout << ": hasn't a table.\n";
    	cout << "Name: ";
    	rplayer1.Name();
    	cout << "; Rating: " << rplayer1.Rating() << endl;
    	RatedPlayer rplayer2(1212, player1);
    	cout << "Name: ";
    	rplayer2.Name();
    	cout << "; Rating: " << rplayer2.Rating() << endl;
    
    	return 0;
    }
    ```

* ç»“æœï¼š

  * ```c++
    Duck, Mallory: has a table.
    Boomdea, Tara: hasn't a table.
    Name: Duck, Mallory; Rating: 1140
    Name: Boomdea, Tara; Rating: 1212
    ```



#### 13.1.4 æ´¾ç”Ÿç±»å’ŒåŸºç±»ä¹‹é—´çš„ç‰¹æ®Šå…³ç³»

ï¼ˆ1ï¼‰æ´¾ç”Ÿç±»å¯¹è±¡å¯ä»¥ä½¿ç”¨åŸºç±»çš„æ–¹æ³•ï¼Œæ¡ä»¶æ˜¯æ–¹æ³•ä¸æ˜¯ç§æœ‰çš„ï¼›

* ```c++
  RatedPlayer rplayer1(1140, "Mallory", "Duck", true);
  rplayer1.Name();
  ```

ï¼ˆ2ï¼‰åŸºç±»æŒ‡é’ˆå¯ä»¥åœ¨ä¸è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢çš„æƒ…å†µä¸‹æŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡ï¼›

* ```c++
  RatedPlayer rplayer1(1140, "Mallory", "Duck", true);
  TableTennisPlayer * pt = &rplayer;
  py->Name();
  ```

ï¼ˆ3ï¼‰åŸºç±»åº”ç”¨å¯ä»¥åœ¨ä¸è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢çš„æƒ…å†µä¸‹å¼•ç”¨æ´¾ç”Ÿç±»å¯¹è±¡/

* ```c++
  RatedPlayer rplayer1(1140, "Mallory", "Duck", true);
  TableTennisPlayer & rt = rplayer;
  rt.Name();
  ```

â—åŸºç±»**æŒ‡é’ˆ**æˆ–**å¼•ç”¨**åªèƒ½è°ƒç”¨åŸºç±»æ–¹æ³•ï¼Œå› æ­¤ï¼Œä¸èƒ½ä½¿ç”¨rtæˆ–ptæ¥è°ƒç”¨æ´¾ç”Ÿç±»çš„ResetRankingæ–¹æ³•ã€‚

â—å¯ä»¥å°†æ´¾ç”Ÿç±»å¯¹è±¡å’Œåœ°å€èµ‹ç»™åŸºç±»åº”ç”¨å’ŒæŒ‡é’ˆã€‚ï¼ˆåŒ…å«å…³ç³»ï¼‰

* é€šå¸¸ï¼ŒC++è¦æ±‚å¼•ç”¨å’ŒæŒ‡é’ˆç±»å‹ä¸èµ‹ç»™çš„ç±»å‹åŒ¹é…ï¼Œä½†è¿™ä¸€è§„åˆ™å¯¹**ç»§æ‰¿**æ¥è¯´æ˜¯ä¾‹å¤–ã€‚ç„¶è€Œï¼Œè¿™ç§ä¾‹å¤–åªæ˜¯å•å‘çš„ï¼Œä¸å¯ä»¥å°†åŸºç±»å¯¹è±¡å’Œåœ°å€èµ‹ç»™æ´¾ç”Ÿç±»å¼•ç”¨å’ŒæŒ‡é’ˆã€‚
* ä»£ç è§P488ï¼Œè¿™ä¸€éƒ¨åˆ†å¾ˆæ·±å¥¥ï¼Œåœ¨åç»­åº”ç”¨è¿‡ç¨‹ä¸­å¯ä»¥åå¤ç¿»é˜…æŸ¥çœ‹



### 13.2 ç»§æ‰¿ï¼šis-aå…³ç³»

æ´¾ç”Ÿç±»å’ŒåŸºç±»ä¹‹é—´çš„ç‰¹æ®Šå…³ç³»æ˜¯åŸºäºC++ç»§æ‰¿çš„åº•å±‚æ¨¡å‹ã€‚å®é™…ä¸ŠC++æœ‰3ç§ç»§æ‰¿æ–¹å¼ï¼šï¼ˆå…¬æœ‰ç»§æ‰¿ã€ä¿æŠ¤ç»§æ‰¿ã€ç§æœ‰ç»§æ‰¿ï¼‰

* å…¬æœ‰ç»§æ‰¿ï¼š
  * is-aå…³ç³»ï¼Œå³æ´¾ç”Ÿç±»å¯¹è±¡ä¹Ÿæ˜¯ä¸€ä¸ªåŸºç±»å¯¹è±¡ï¼Œå¯ä»¥å¯¹åŸºç±»å¯¹è±¡æ‰§è¡Œçš„ä»»ä½•æ“ä½œï¼Œä¹Ÿå¯ä»¥å¯¹æ´¾ç”Ÿç±»å¯¹è±¡æ‰§è¡Œã€‚
    * ä¸è¯¥æ¨¡å‹ä¸ç¬¦çš„ä¾‹å­ï¼šP490
      * has-aå…³ç³»
      * is-like-aå…³ç³»
      * is-implemented-as-aå…³ç³»
      * use-aå…³ç³»



### 13.3 å¤šæ€å…¬æœ‰ç»§æ‰¿

å¤šæ€ï¼šå…·æœ‰å¤šç§å½¢æ€çš„å¤æ‚è¡Œä¸ºï¼Œå³æ–¹æ³•çš„è¡Œä¸ºåº”å–å†³äºè°ƒç”¨è¯¥æ–¹æ³•çš„å¯¹è±¡ã€‚

* ä¹‹å‰è®²è¿°çš„ç»§æ‰¿å¾ˆç®€å•ï¼Œæ´¾ç”Ÿç±»å¯¹è±¡ä½¿ç”¨åŸºç±»çš„æ–¹æ³•ï¼Œè€Œæœªåšä»»ä½•æ”¹å˜ã€‚ç„¶è€Œï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œå³å¸Œæœ›åŒä¸€ä¸ªæ–¹æ³•åœ¨æ´¾ç”Ÿç±»çš„å’ŒåŸºç±»ç§çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ã€‚

ç”¨äºå®ç°å¤šæ€å…¬æœ‰ç»§æ‰¿çš„ä¸¤ç§é‡è¦æœºåˆ¶ï¼š

* åœ¨æ´¾ç”Ÿç±»ç§é‡æ–°å®šä¹‰åŸºç±»çš„æ–¹æ³•ï¼›
* ä½¿ç”¨è™šæ–¹æ³•ã€‚

ç¤ºä¾‹ï¼šåˆ›å»ºä¸¤ä¸ªç±»

* 1ã€ç”¨äºè¡¨ç¤ºåŸºæœ¬æ”¯ç¥¨è´¦æˆ·â€”â€”Brass Account
* 2ã€è°ƒä»·äº†é€æ”¯ä¿æŠ¤æ€§çš„æ”¯ç¥¨ä¿æŠ¤â€”â€”Brass Plus

ä»Brasså…¬æœ‰ç±»æ´¾ç”Ÿå‡ºBrassPlusï¼Œå¹¶ä¸”BrassPlusç±»æ»¡è¶³is-aæ¡ä»¶ï¼ˆis-aå…³ç³»é€šå¸¸ä¸å¯é€†ï¼šæ°´æœä¸æ˜¯é¦™è•‰ï¼ŒåŒæ ·ï¼ŒBrasså¯¹è±¡ä¸å…·å¤‡BrassPluså¯¹è±¡çš„æ‰€æœ‰åŠŸèƒ½ã€‚

#### 13.3.1 å¼€å‘Brassç±»å’ŒBrassPlusç±»

è§P491

* ç¤ºä¾‹ï¼š

  * ```c++
    //ch13_07_brass.h -- bank account classes
    #ifndef CH13_07_BRASS_H_
    #define CH13_07_BRASS_H_
    #include <iostream>
    // Brass Account Class
    class Brass
    {
    private:
    	std::string fullName;
    	long acctNum;
    	double balance;
    public:
    	Brass(const std::string& s = "Nullbody", long an = -1,
    		double bal = 0.0);
    	void Deposit(double amt);
    	virtual void Withdraw(double amt);
    	double Balance() const;
    	virtual void ViewAcct() const;
    	virtual ~Brass() {}
    };
    
    // Brass Plus Account Class
    class BrassPlus : public Brass
    {
    private:
    	double maxLoan;
    	double rate;
    	double owesBank;
    public:
    	BrassPlus(const std::string& s = "Nullbody", long an = -1,
    		double bal = 0.0, double ml = 500,
    		double r = 0.11125);
    	BrassPlus(const Brass & ba, double ml = 500,
    		double r = 0.11125);
    	virtual void ViewAcct() const;
    	virtual void Withdraw(double amt);
    	void ResetMax(double m) { maxLoan = m; }
    	void ResetRate(double r) { rate = r; }
    	void ResetOwes() { owesBank = 0; }
    };
    
    #endif
    ```

    * BrassPlus ç±»åœ¨ Brass ç±»çš„åŸºç¡€ä¸Šæ·»åŠ äº†3ä¸ªæœ‰æ•°æ®æˆå‘˜å’Œ3å…¬æœ‰æˆå‘˜å‡½æ•°ï¼›
    * Brass ç±»å’Œ BrassPlus ç±»éƒ½å£°æ˜äº† ViewAcct() å’Œ Withdraw() æ–¹æ³•, BrassPlus å¯¹è±¡å’Œ Brass å¯¹è±¡çš„è¿™äº›æ–¹æ³•çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼›
    * Brass ç±»åœ¨å£°æ˜ ViewAcct() å’Œ Withdraw() æ—¶ä½¿ç”¨äº†æ–°å…³é”®å­— **virtual**ã€‚è¿™äº›æ–¹æ³•è¢«ç§°ä¸º**è™šæ–¹æ³•(virtualmethod)**ï¼›è§P493
      * å¦‚æœæ–¹æ³•æ˜¯é€šè¿‡å¼•ç”¨æˆ–æŒ‡é’ˆè€Œä¸æ˜¯å¯¹è±¡è°ƒç”¨çš„ï¼Œå®ƒå°†ç¡®å®šä½¿ç”¨å“ªä¸€ç§æ–¹æ³•ã€‚
      * å¦‚æœæ²¡æœ‰ä½¿ç”¨å…³é”®å­— virtualï¼Œç¨‹åºå°†æ ¹æ®å¼•ç”¨ç±»å‹æˆ–æŒ‡é’ˆç±»å‹é€‰æ‹©æ–¹æ³•ï¼›
      * å¦‚æœä½¿ç”¨äº†virtualï¼Œç¨‹åºå°†æ ¹æ®å¼•ç”¨æˆ–æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„ç±»å‹æ¥é€‰æ‹©æ–¹æ³•ã€‚
      * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/6217972f-e18f-4795-a50f-e3817fc3859d)
    * Brass ç±»è¿˜å£°æ˜äº†ä¸€ä¸ªè™šææ„å‡½æ•°ï¼Œè™½ç„¶è¯¥ææ„å‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚
      * åŸºç±»å£°æ˜äº†ä¸€ä¸ªè™šææ„å‡½æ•°ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿é‡Šæ”¾æ´¾ç”Ÿå¯¹è±¡æ—¶ï¼ŒæŒ‰æ­£ç¡®çš„é¡ºåºè°ƒç”¨ææ„å‡½æ•°ã€‚

  * ğŸ“Œå¦‚æœè¦åœ¨**æ´¾ç”Ÿç±»**ä¸­é‡**æ–°å®šä¹‰åŸºç±»**çš„æ–¹æ³•ï¼Œé€šå¸¸åº”**å°†åŸºç±»æ–¹æ³•å£°æ˜ä¸ºè™šçš„**ã€‚è¿™æ ·ï¼Œç¨‹åºå°†æ ¹æ®å¯¹è±¡ç±»å‹è€Œä¸æ˜¯å¼•ç”¨æˆ–æŒ‡é’ˆçš„ç±»å‹æ¥é€‰æ‹©æ–¹æ³•ç‰ˆæœ¬ã€‚ä¸ºåŸºç±»å£°æ˜ä¸€ä¸ªè™šææ„å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§æƒ¯ä¾‹ã€‚

**1ã€ç±»å®ç°**

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch13_08_brass.cpp -- bank account class methods
    #include <iostream>
    #include "ch13_07_brass.h"
    using std::cout;
    using std::endl;
    using std::string;
    
    // formatting stuff
    typedef std::ios_base::fmtflags format;
    typedef std::streamsize precis;
    format setFormat();
    void restore(format f, precis p);
    
    // Brass methods
    
    Brass::Brass(const string& s, long an, double bal)
    {
    	fullName = s;
    	acctNum = an;
    	balance = bal;
    }
    
    void Brass::Deposit(double amt)
    {
    	if (amt < 0)
    		cout << "Negative deposit not allowed; "
    		<< "deposit is cancelled.\n";
    	else
    		balance += amt;
    }
    
    void Brass::Withdraw(double amt)
    {
    	// set up ###.## format
    	format initialState = setFormat();
    	precis prec = cout.precision(2);
    
    	if (amt < 0)
    		cout << "Withdrawal amount must be positive;"
    		<< "withdrawal canceled.\n";
    	else if (amt <= balance)
    		balance -= amt;
    	else
    		cout << "Withdrawal amount of $" << amt
    			 << " exceeds your balance.\n"
    			 << "Withdrawal canceled.\n";
    	restore(initialState, prec);
    }
    
    double Brass::Balance() const
    {
    	return balance;
    }
    
    void Brass::ViewAcct() const
    {
    	// set up ###.## format
    	format initialState = setFormat();
    	precis prec = cout.precision(2);
    	cout << "Client: " << fullName << endl;
    	cout << "Account Number: " << acctNum << endl;
    	cout << "Balance: $" << balance << endl;
    	restore(initialState, prec);
    }
    
    // BrassPlus Methods
    BrassPlus::BrassPlus(const string& s, long an, double bal,
    	double ml, double r) : Brass(s, an, bal)
    {
    	maxLoan = ml;
    	owesBank = 0.0;
    	rate = r;
    }
    
    BrassPlus::BrassPlus(const Brass& ba, double ml, double r)
    	: Brass(ba)	// use implicit copy constructor
    {
    	maxLoan = ml;
    	owesBank = 0.0;
    	rate = r;
    }
    
    // redefine how ViewAcct() works
    void BrassPlus::ViewAcct() const
    {
    	// set up ###.## format
    	format initialState = setFormat();
    	precis prec = cout.precision(2);
    
    	Brass::ViewAcct();
    	cout << "Maximum loan: $" << maxLoan << endl;
    	cout << "Owed to bank: $" << oweBank << endl;
    	cout.precision(3);
    	cout << "Loan Rate: " << 100 * rate << "&\n";
    	restore(initialState, prec);
    }
    
    // redefine how Withdraw() works
    void BrassPlus::Withdraw(double amt)
    {
    	// set up ###.## format
    	format initialState = setFormat();
    	precis prec = cout.precision(2);
    
    	double bal = Balance();
    	if (amt <= bal)
    		Brass::Withdraw(amt);
    	else if (amt <= bal + maxLoan - owesBank)
    	{
    		double advance = amt - bal;
    		owesBank += advance * (1.0 + rate);
    		cout << "Bank advance: $" << advance << endl;
    		cout << "Finance charge: $" << advance * rate << endl;
    		Deposit(advance);
    		Brass::Withdraw(amt);
    	}
    	else
    		cout << "Credit limit exceeded. Transaction cancelled.\n";
    	restore(initialState, prec);
    }
    
    format setFormat()
    {
    	// set up ###.## format
    	return cout.setf(std::ios_base::fixed,
    		std::ios_base::floatfield);
    }
    
    void restore(format f, precis p)
    {
    	cout.setf(f, std::ios_base::floatfield);
    	cout.precision(p);
    }
    ```

    * æ´¾ç”Ÿç±»å¹¶ä¸èƒ½ç›´æ¥è®¿é—®åŸºç±»çš„ç§æœ‰æ•°æ®ï¼Œè€Œå¿…é¡»ä½¿ç”¨åŸºç±»çš„å…¬æœ‰æ–¹æ³•æ‰èƒ½è®¿é—®è¿™äº›æ•°æ®ã€‚
      * æ´¾ç”Ÿç±»æ„é€ å‡½æ•°åœ¨åˆå§‹åŒ–åŸºç±»ç§æœ‰æ•°æ®æ—¶ï¼Œé‡‡ç”¨çš„æ˜¯**æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨**è¯­æ³•ã€‚RatedPlayer ç±»æ„é€ å‡½æ•°å’ŒBrassPlusæ„é€ å‡½æ•°éƒ½ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚P496
        * å°†åŸºç±»ä¿¡æ¯ä¼ é€’ç»™åŸºç±»æ„é€ å‡½æ•°ï¼Œç„¶åä½¿ç”¨æ„é€ å‡½æ•°ä½“åˆå§‹åŒ–BrassPlusç±»æ–°å¢çš„æ•°æ®é¡¹ã€‚
      * éæ„é€ å‡½æ•°ä¸èƒ½ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•ï¼Œä½†æ´¾ç”Ÿç±»æ–¹æ³•å¯ä»¥è°ƒç”¨å…¬æœ‰çš„åŸºç±»æ–¹æ³•ã€‚P496
        * åœ¨æ´¾ç”Ÿç±»æ–¹æ³•ä¸­ï¼Œæ ‡å‡†æŠ€æœ¯æ˜¯ä½¿ç”¨ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦æ¥è°ƒç”¨åŸºç±»æ–¹æ³•ã€‚
        * å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰é‡æ–°å®šä¹‰è¯¥æ–¹æ³•ï¼Œä»£ç ä¸å¿…å¯¹å‡½æ•°ä½¿ç”¨ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦ã€‚
      * æ–¹æ³• ViewAcct() å’Œ Withdraw() ä½¿ç”¨æ ¼å¼åŒ–æ–¹æ³• setf() å’Œ precision() å°†ç‚¹å€¼çš„è¾“å‡ºæ¨¡å¼è®¾ç½®ä¸ºå®šç‚¹ï¼Œå³åŒ…å«ä¸¤ä½å°æ•°ã€‚è®¾ç½®æ¨¡å¼åï¼Œè¾“å‡ºçš„æ¨¡å¼å°†ä¿æŒä¸å˜ï¼Œå› æ­¤è¯¥æ–¹æ³•å°†æ ¼å¼æ¨¡å¼é‡ç½®ä¸ºè°ƒç”¨å‰çš„çŠ¶æ€ã€‚
      * å‡½æ•° setFormat() è®¾ç½®å®šç‚¹è¡¨ç¤ºæ³•å¹¶è¿”å›ä»¥å‰çš„æ ‡è®°è®¾ç½®ï¼›
      * è€Œå‡½æ•°restore()é‡ç½®æ ¼å¼å’Œç²¾åº¦ã€‚

**2ã€ä½¿ç”¨ Brass å’Œ BrassPlus ç±»**

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch13_09_usebrass1.cpp -- testing bank account classes
    // compile with ch13_09_usebrass1.cpp
    #include <iostream>
    #include "ch13_07_brass.h"
    
    int main()
    {
    	using std::cout;
    	using std::endl;
    
    	Brass Piggy("Porcelot Pigg", 381299, 4000.00);
    	BrassPlus Hoggy("Horatia Hogg", 382288, 3000.00);
    	Piggy.ViewAcct();
    	cout << endl;
    	Hoggy.ViewAcct();
    	cout << endl;
    	cout << "Depositing $1000 into the Hogg Account:\n";
    	Hoggy.Deposit(1000.00);
    	cout << "New balance: $" << Hoggy.Balance() << endl;
    	cout << "Withdrawing $4200 from the Pigg Account:\n";
    	Piggy.Withdraw(4200.00);
    	cout << "Pigg account balance: $" << Piggy.Balance() << endl;
    	cout << "Withdrawing $4200 from the Hogg Account:\n";
    	Hoggy.Withdraw(4200.00);
    	Hoggy.ViewAcct();
    
    	return 0;
    }
    ```

* ç»“æœï¼š

  * ```c++
    Client: Porcelot Pigg
    Account Number: 381299
    Balance: $4000.00
    
    Client: Horatia Hogg
    Account Number: 382288
    Balance: $3000.00
    Maximum loan: $500.00
    Owed to bank: $0.00
    Loan Rate: 11.125%
    
    Depositing $1000 into the Hogg Account:
    New balance: $4000
    Withdrawing $4200 from the Pigg Account:
    Withdrawal amount of $4200.00 exceeds your balance.
    Withdrawal canceled.
    Pigg account balance: $4000
    Withdrawing $4200 from the Hogg Account:
    Bank advance: $200.00
    Finance charge: $22.25
    Client: Horatia Hogg
    Account Number: 382288
    Balance: $0.00
    Maximum loan: $500.00
    Owed to bank: $222.25
    Loan Rate: 11.125%
    ```

**3ã€æ¼”ç¤ºè™šæ–¹æ³•çš„è¡Œä¸º**

ch13_09_usebrass1.cppç¨‹åºæ¸…å•ä¸­ï¼Œæ–¹æ³•æ˜¯é€šè¿‡å¯¹è±¡ï¼ˆè€Œä¸æ˜¯æŒ‡é’ˆæˆ–å¼•ç”¨ï¼‰è°ƒç”¨çš„ï¼Œæ²¡æœ‰ä½¿ç”¨è™šæ–¹æ³•ç‰¹æ€§ï¼Œä¸‹é¢æ¥ä½¿ç”¨è™šæ–¹æ³•ï¼š

* åˆ›å»ºæŒ‡å‘Brassçš„æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹éƒ½ç›¸åŒï¼Œä½†ç”±äºä½¿ç”¨çš„æ˜¯å…¬æœ‰ç»§æ‰¿æ¨¡å‹ï¼Œå› æ­¤BrassæŒ‡é’ˆæ—¢å¯ä»¥æŒ‡å‘Brasså¯¹è±¡ä¹Ÿå¯ä»¥æŒ‡å‘BrassPluså¯¹è±¡ã€‚

* å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥è¡¨ç¤ºå¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œè¿™å°±æ˜¯å¤šæ€æ€§ã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch13_10_usebrass2.cpp -- polymorphic example
    // compile with ch13_08_brass.cpp
    #include <iostream>
    #include <string>
    #include "ch13_07_brass.h"
    
    const int CLIENTS = 4;
    
    int main()
    {
    	using std::cin;
    	using std::cout;
    	using std::endl;
    
    	Brass* p_clients[CLIENTS];
    	std::string temp;
    	long tempnum;
    	double tempbal;
    	char kind;
    
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		cout << "Enter client's name: ";
    		getline(cin, temp);
    		cout << "Enter client's account number: ";
    		cin >> tempnum;
    		cout << "Enter opening balance: $";
    		cin >> tempbal;
    		cout << "Enter 1 for Brass Account or "
    			<< "2 for BrassPlus Account: ";
    		while (cin >> kind && (kind != '1' && kind != '2'))
    			cout << "Enter either 1 or 2: ";
    		if (kind == '1')
    			p_clients[i] = new Brass(temp, tempnum, tempbal);
    		else
    		{
    			double tmax, trate;
    			cout << "Enter the overdraft limit: $";
    			cin >> tmax;
    			cout << "Enter the interest rate "
    				<< "as a decimal fraction: ";
    			cin >> trate;
    			p_clients[i] = new BrassPlus(temp, tempnum, tempbal,
    										 tmax, trate);
    		}
    		while (cin.get() != '\n')
    			continue;
    	}
    	cout << endl;
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		p_clients[i]->ViewAcct();
    		// å¦‚æœæ•°ç»„æˆå‘˜æŒ‡å‘çš„æ˜¯ Brass å¯¹è±¡ï¼Œåˆ™è°ƒç”¨ Brass::ViewAcct();
    		// å¦‚æœæ•°ç»„æˆå‘˜æŒ‡å‘çš„æ˜¯ BrassPlus å¯¹è±¡ï¼Œåˆ™è°ƒç”¨ BrassPlus::ViewAcct();
    		// å¦‚æœ Brass::ViewAcct() è¢«å£°æ˜ä¸ºè™šçš„ï¼Œåˆ™åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å°†è°ƒç”¨ Brass::ViewAcct()ã€‚
    		cout << endl;
    	}
    
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		delete p_clients[i];
    	}
    	cout << "Done.\n";
    	return 0;
    }
    ```

    * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/1121fab3-5dc3-4991-a71d-dece265eec3f)
      * æŠ¥é”™åŸå› ï¼šä¸¤ä¸ªforå¾ªç¯åµŒå¥—åœ¨äº†ç¬¬ä¸€ä¸ªforå¾ªç¯ä¸­ï¼Œç¨‹åºå´©æºƒã€‚

* ç»“æœï¼š

  * ```c++
    Enter client's name: Harry Fishsong
    Enter client's account number: 112233
    Enter opening balance: $1500
    Enter 1 for Brass Account or 2 for BrassPlus Account: 1
    Enter client's name: Dinah Otternoe
    Enter client's account number: 121213
    Enter opening balance: $1800
    Enter 1 for Brass Account or 2 for BrassPlus Account: 2
    Enter the overdraft limit: $350
    Enter the interest rate as a decimal fraction: 0.12
    Enter client's name: Brenda Birdherd
    Enter client's account number: 212118
    Enter opening balance: $5200
    Enter 1 for Brass Account or 2 for BrassPlus Account: 2
    Enter the overdraft limit: $800
    Enter the interest rate as a decimal fraction: 0.10
    Enter client's name: Tim Turtletop
    Enter client's account number: 233255
    Enter opening balance: $688
    Enter 1 for Brass Account or 2 for BrassPlus Account: 1
    
    Client: Harry Fishsong
    Account Number: 112233
    Balance: $1500.00
    
    Client: Dinah Otternoe
    Account Number: 121213
    Balance: $1800.00
    Maximum loan: $350.00
    Owed to bank: $0.00
    Loan Rate: 12.000%
    
    Client: Brenda Birdherd
    Account Number: 212118
    Balance: $5200.00
    Maximum loan: $800.00
    Owed to bank: $0.00
    Loan Rate: 10.000%
    
    Client: Tim Turtletop
    Account Number: 233255
    Balance: $688.00
    
    Done.
    ```



**4ã€ä¸ºä½•éœ€è¦ææ„å‡½æ•°**

åœ¨ä¸Šè¿°ç¨‹åºæ¸…å•ä¸­ï¼Œä½¿ç”¨ delete é‡Šæ”¾ç”± new åˆ†é…çš„å¯¹è±¡ä»£ç è¯´æ˜äº†ä¸ºä½•åŸºç±»åº”åŒ…å«ä¸€ä¸ªè™šææ„å‡½æ•°ï¼š

* å¦‚æœææ„å‡½æ•°ä¸æ˜¯è™šçš„ï¼Œåˆ™å°†åªè°ƒç”¨å¯¹åº”äºæŒ‡é’ˆç±»å‹çš„ææ„å‡½æ•°ã€‚å¯¹äºç¨‹åºæ¸…å•13.10è¿™æ„å‘³ç€åªæœ‰ Brass çš„ææ„å‡½æ•°è¢«è°ƒç”¨ï¼Œå³ä½¿æŒ‡é’ˆæŒ‡çš„æ˜¯ä¸€ä¸ª BrassPluså¯¹è±¡ã€‚
* å¦‚æœææ„æ•°æ˜¯è™šçš„ï¼Œå°†è°ƒç”¨ç›¸åº”å¯¹è±¡ç±»å‹çš„ææ„å‡½æ•°ã€‚
* å› æ­¤ï¼Œå¦‚æœæŒ‡é’ˆæŒ‡çš„æ˜¯ BrassPlus å¯¹è±¡ï¼Œå°†è°ƒç”¨ BrassPlus çš„ææ„å‡½æ•°ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ã€‚

å› æ­¤ï¼Œä½¿ç”¨è™šææ„å‡½æ•°å¯ä»¥ç¡®ä¿æ­£ç¡®çš„ææ„å‡½æ•°åºåˆ—è¢«è°ƒç”¨ã€‚

å¯¹äºç¨‹åºæ¸…å• 13.10ï¼Œè¿™ç§æ­£ç¡®çš„è¡Œä¸ºå¹¶ä¸æ˜¯å¾ˆé‡è¦ï¼Œå› ä¸ºææ„å‡½æ•°æ²¡æœ‰æ‰§è¡Œä»»ä½•æ“ä½œã€‚ç„¶è€Œï¼Œå¦‚æœ BrassPlus åŒ…å«ä¸€ä¸ªæ‰§è¡ŒæŸäº›æ“ä½œçš„ææ„å‡½æ•°ï¼Œåˆ™ Brass å¿…é¡»æœ‰ä¸€ä¸ªè™šææ„å‡½æ•°ï¼Œå³ä½¿è¯¥ææ„å‡½æ•°ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚



### 13.4 é™æ€è”ç¼–å’ŒåŠ¨æ€è”ç¼–

å°†æºä»£ç ä¸­çš„å‡½æ•°è°ƒç”¨è§£é‡Šä¸ºæ‰§è¡Œç‰¹å®šçš„å‡½æ•°ä»£ç å—è¢«ç§°ä¸ºå‡½æ•°åè”ç¼–ï¼Œåœ¨C++ä¸­ï¼Œç”±äºå‡½æ•°é‡è½½çš„ç¼˜æ•…ï¼Œè¿™é¡¹ä»»åŠ¡æ›´åŠ å¤æ‚ã€‚ç„¶è€ŒC/C++ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å®Œæˆè¿™ç§è”ç¼–ã€‚

* é™æ€è”ç¼–ï¼ˆæ—©æœŸè”ç¼–ï¼‰ï¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œè”ç¼–ï¼›
* åŠ¨æ€è”ç¼–ï¼ˆæ™šæœŸè”ç¼–ï¼‰ï¼šç¼–è¯‘å™¨å¿…é¡»ç”Ÿæˆèƒ½èƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶é€‰æ‹©æ­£ç¡®çš„è™šæ–¹æ³•çš„ä»£ç ã€‚



#### 13.4.1 æŒ‡é’ˆå’Œå¼•ç”¨ç±»å‹çš„å…¼å®¹æ€§

åœ¨ C++ä¸­ï¼ŒåŠ¨æ€è”ç¼–ä¸é€šè¿‡æŒ‡é’ˆå’Œå¼•ç”¨è°ƒç”¨æ–¹æ³•ç›¸å…³ï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯´ï¼Œè¿™æ˜¯ç”±ç»§æ‰¿æ§åˆ¶çš„ã€‚

* å°†æ´¾ç”Ÿç±»å¼•ç”¨æˆ–æŒ‡é’ˆè½¬æ¢ä¸ºåŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆè¢«ç§°ä¸ºå‘ä¸Šå¼ºåˆ¶è½¬æ¢ï¼ˆupcastingï¼‰ï¼Œè¿™ä½¿å…¬æœ‰ç»§æ‰¿ä¸éœ€è¦è¿›è¡Œæ˜¾å¼ç±»å‹è½¬æ¢ã€‚è¯¥è§„åˆ™æ˜¯ is-a å…³ç³»çš„ä¸€éƒ¨åˆ†ã€‚

* ç›¸åçš„è¿‡ç¨‹â€”â€”å°†åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨è½¬æ¢ä¸ºæ´¾ç”Ÿç±»æŒ‡é’ˆæˆ–å¼•ç”¨â€”â€”ç§°ä¸ºå‘ä¸‹å¼ºåˆ¶è½¬æ¢ã€‚å¦‚æœä¸ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢ï¼Œåˆ™å‘ä¸‹å¼ºåˆ¶è½¬æ¢æ˜¯ä¸å…è®¸çš„ã€‚åŸå› æ˜¯ is-a å…³ç³»é€šå¸¸æ˜¯ä¸å¯é€†çš„ã€‚

* æ´¾ç”Ÿç±»å¯ä»¥æ–°å¢æ•°æ®æˆå‘˜ï¼Œå› æ­¤ä½¿ç”¨è¿™äº›æ•°æ®æˆå‘˜çš„ç±»æˆå‘˜å‡½æ•°ä¸èƒ½åº”ç”¨äºåŸºç±»ã€‚

* å¯¹äºä½¿ç”¨åŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆä½œä¸ºå‚æ•°çš„å‡½æ•°è°ƒç”¨ï¼Œå°†è¿›è¡Œå‘ä¸Šè½¬æ¢ã€‚è¯·çœ‹ä¸‹é¢çš„ä»£ç æ®µï¼Œè¿™é‡Œå‡å®šæ¯ä¸ªå‡½æ•°éƒ½è°ƒç”¨è™šæ–¹æ³•ViewAcct()ï¼š

  * ```c++
    void fr(Brass & rb);	// user rb.ViewAcct()
    void fp(Brass * pd);	// uses pb->ViewAcct()
    void fv(Brass b);		//uses b.ViewAcct()
    int main()
    {
        Brass b("Billy Bee", 123432, 10000.0);
        BrassPlus bp("Betty Beep", 232313, 123456.0);
        fr(b);		// uses Brass::ViewAcct()
        fr(bp);		// uses BrassPlus::ViewAcct()
        fp(b);		// uses Brass::ViewAcct()
        fp(bp);		// uses BrassPlus::ViewAcct()
        fv(b);		// uses Brass::ViewAcct()
        fv(bp);		// uses Brass::ViewAcct()
        ...
    }
    ```

  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/e451bc5c-a12b-4ad6-973e-49655e6c64bc)

  * æŒ‰å€¼ä¼ é€’å¯¼è‡´åªå°† BrassPlus å¯¹è±¡çš„ Brass éƒ¨åˆ†ä¼ é€’ç»™å‡½æ•° fv()ã€‚

  * ä½†éšå¼•ç”¨å’ŒæŒ‡é’ˆå‘ç”Ÿçš„éšå¼å‘ä¸Šè½¬æ¢å¯¼è‡´å‡½æ•°fr()å’Œfp()åˆ†åˆ«ä¸º Brass å¯¹è±¡å’Œ BrassPlus å¯¹è±¡ä½¿ç”¨ Brass::ViewAcct() å’Œ BrassPlus::ViewAcct()ã€‚

* éšå¼å‘ä¸Šå¼ºåˆ¶è½¬æ¢ä½¿åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨å¯ä»¥æŒ‡å‘åŸºç±»å¯¹è±¡æˆ–æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œå› æ­¤éœ€è¦åŠ¨æ€è”ç¼–ã€‚C++ä½¿ç”¨è™šæˆå‘˜å‡½æ•°æ¥æ»¡è¶³è¿™ç§éœ€æ±‚ã€‚



#### 13.4.2 è™šæˆå‘˜å‡½æ•°å’ŒåŠ¨æ€è”ç¼–

* ```c++
  BrassPlus ophelia;	// derived-class object
  Brass * bp;		    // base-class pointer
  bp = &ophelia;		// Brass pointer to BrassPlus object
  bp->ViewAcct();		// which version?
  ```

* å¦‚æœåœ¨åŸºç±»ä¸­æ²¡æœ‰å°† ViewAcct() å£°æ˜ä¸ºè™šçš„ï¼Œåˆ™ bp->ViewAcct(); å°†æ ¹æ®æŒ‡é’ˆç±»å‹ï¼ˆBrass *ï¼‰è°ƒç”¨ Brass::ViewAcct()ã€‚

  * æ€»ä¹‹ï¼Œç¼–è¯‘å™¨å¯¹éè™šæ–¹æ³•ä½¿ç”¨é™æ€è”ç¼–ã€‚

* å¦‚æœåœ¨åŸºç±»ä¸­å°† ViewAcct() å£°æ˜ä¸ºè™šçš„ï¼Œåˆ™ bp->ViewAcct(); æ ¹æ®å¯¹è±¡ç±»å‹ï¼ˆBrassPlusï¼‰è°ƒç”¨ BrassPlus::ViewAcct()ã€‚

  * æ€»ä¹‹ï¼Œç¼–è¯‘å™¨å¯¹è™šæ–¹æ³•ä½¿ç”¨åŠ¨æ€è”ç¼–ã€‚

**1ã€ä¸ºä»€ä¹ˆæœ‰ä¸¤ç§ç±»å‹çš„è”ç¼–ä»¥åŠä¸ºä»€ä¹ˆé»˜è®¤ä¸ºé™æ€è”ç¼–**

* åŸå› ï¼šæ•ˆç‡å’Œæ¦‚å¿µæ¨¡å‹
  * é™æ€è”ç¼–çš„æ•ˆç‡æ›´é«˜ï¼Œä¸ºä½¿ç¨‹åºèƒ½å¤Ÿåœ¨è¿è¡Œé˜¶æ®µè¿›è¡Œå†³ç­–ï¼Œå¿…é¡»é‡‡å–ä¸€äº›æ–¹æ³•æ¥è·Ÿè¸ªåŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ç±»å‹ï¼Œè¿™å¢åŠ äº†é¢å¤–çš„å¤„ç†å¼€é”€ã€‚
    * ä¾‹å¦‚ï¼Œå¦‚æœç±»ä¸ä¼šç”¨ä½œåŸºç±»ï¼Œåˆ™ä¸éœ€è¦åŠ¨æ€è”ç¼–ã€‚
    * åŒæ ·ï¼Œå¦‚æœæ´¾ç”Ÿç±»ä¸é‡æ–°å®šä¹‰åŸºç±»çš„ä»»ä½•æ–¹æ³•ï¼Œä¹Ÿä¸éœ€è¦ä½¿ç”¨åŠ¨æ€è”ç¼–ã€‚
  * æ¦‚å¿µæ¨¡å‹ï¼Œåœ¨è®¾è®¡ç±»æ—¶ï¼Œå¯èƒ½åŒ…å«ä¸€äº›ä¸åœ¨æ´¾ç”Ÿç±»é‡æ–°å®šä¹‰çš„æˆå‘˜å‡½æ•°ï¼Œä¸å°†è¯¥å‡½æ•°è®¾ç½®ä¸ºè™šå‡½æ•°ä¸ä»…æ•ˆç‡æ›´é«˜ï¼Œè€Œä¸”æŒ‡å‡ºä¸è¦é‡æ–°å®šä¹‰è¯¥å‡½æ•°ã€‚
    * è¿™è¡¨æ˜ï¼Œä»…å°†é‚£äº›é¢„æœŸå°†è¢«é‡æ–°å®šä¹‰çš„æ–¹æ³•å£°æ˜ä¸ºè™šçš„ã€‚
* ğŸ“Œå¦‚æœè¦åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰åŸºç±»çš„æ–¹æ³•ï¼Œåˆ™å°†å®ƒè®¾ç½®ä¸ºè™šæ–¹æ³•ï¼›å¦åˆ™ï¼Œè®¾ç½®ä¸ºéè™šæ–¹æ³•ã€‚

**2ã€è™šå‡½æ•°çš„å·¥ä½œåŸç†**

![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/842897ef-0b4a-4bd4-bdf5-32186d73d9f8)

æ€»ä¹‹ï¼Œä½¿ç”¨è™šå‡½æ•°æ—¶ï¼Œåœ¨å†…å­˜å’Œæ‰§è¡Œé€Ÿåº¦æ–¹é¢æœ‰ä¸€å®šçš„æˆæœ¬ï¼ŒåŒ…æ‹¬ï¼š

* æ¯ä¸ªå¯¹è±¡éƒ½å°†å¢å¤§ï¼Œå¢å¤§é‡ä¸ºå­˜å‚¨åœ°å€çš„ç©ºé—´ï¼›
* å¯¹äºæ¯ä¸ªç±»ï¼Œç¼–è¯‘å™¨éƒ½åˆ›å»ºä¸€ä¸ªè™šå‡½æ•°åœ°å€è¡¨ï¼ˆæ•°ç»„ï¼‰ï¼›
* å¯¹äºæ¯ä¸ªå‡½æ•°è°ƒç”¨ï¼Œéƒ½éœ€è¦æ‰§è¡Œä¸€é¡¹é¢å¤–çš„æ“ä½œï¼Œå³åˆ°è¡¨ä¸­æŸ¥æ‰¾åœ°å€ã€‚

è™½ç„¶éè™šå‡½æ•°çš„æ•ˆç‡æ¯”è™šå‡½æ•°ç¨é«˜ï¼Œä½†ä¸å…·å¤‡åŠ¨æ€è”ç¼–åŠŸèƒ½ã€‚



#### 13.4.3 æœ‰å…³è™šå‡½æ•°æ³¨æ„äº‹é¡¹

è™šå‡½æ•°è¦ç‚¹ï¼š

* åœ¨åŸºç±»æ–¹æ³•çš„å£°æ˜ä¸­ä½¿ç”¨å…³é”®å­— virtual å¯ä½¿è¯¥æ–¹æ³•åœ¨åŸºç±»ä»¥åŠæ‰€æœ‰çš„æ´¾ç”Ÿç±»ï¼ˆåŒ…æ‹¬ä»æ´¾ç”Ÿç±»æ´¾ç”Ÿå‡ºæ¥çš„ç±»ï¼‰ä¸­æ˜¯è™šçš„ã€‚
* å¦‚æœä½¿ç”¨æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨æˆ–æŒ‡é’ˆæ¥è°ƒç”¨è™šæ–¹æ³•ï¼Œç¨‹åºå°†ä½¿ç”¨ä¸ºå¯¹è±¡ç±»å‹å®šä¹‰çš„æ–¹æ³•ï¼Œè€Œä¸ä½¿ç”¨ä¸ºå¼•ç”¨æˆ–æŒ‡é’ˆç±»å‹å®šä¹‰çš„æ–¹æ³•ã€‚è¿™ç§°ä¸º**åŠ¨æ€è”ç¼–**æˆ–æ™šæœŸè”ç¼–ã€‚è¿™ç§è¡Œä¸ºéå¸¸é‡è¦ï¼Œå› ä¸ºè¿™æ ·åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨å¯ä»¥æŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡ã€‚
* å¦‚æœå®šä¹‰çš„ç±»å°†è¢«ç”¨ä½œåŸºç±»ï¼Œåˆ™åº”å°†é‚£äº›è¦åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰çš„ç±»æ–¹æ³•å£°æ˜ä¸ºè™šçš„ã€‚

**1ã€æ„é€ å‡½æ•°ï¼š**

* æ„é€ å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°ï¼Œæ´¾ç”Ÿç±»ä¸ç»§æ‰¿åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å°†ç±»æ„é€ å‡½æ•°å£°æ˜ä¸ºè™šçš„æ²¡æ„ä¹‰ã€‚

**2ã€ææ„å‡½æ•°ï¼š**

* ææ„å‡½æ•°åº”å½“æ˜¯è™šå‡½æ•°ï¼Œé™¤éç±»ä¸ç”¨åšåŸºç±»ã€‚
* é€šå¸¸åº”ç»™åŸºç±»æä¾›ä¸€ä¸ªè™šææ„å‡½æ•°ï¼Œå³ä½¿å®ƒå¹¶ä¸éœ€è¦ææ„å‡½æ•°ã€‚

**3ã€å‹å…ƒï¼š**

* å‹å…ƒä¸èƒ½æ˜¯è™šå‡½æ•°ï¼Œå› ä¸ºå‹å…ƒä¸æ˜¯ç±»æˆå‘˜ï¼Œè€Œåªæœ‰æˆå‘˜æ‰èƒ½æ˜¯è™šå‡½æ•°ã€‚

**4ã€æ²¡æœ‰é‡æ–°å®šä¹‰ï¼š**

* å¦‚æœæ´¾ç”Ÿç±»æ²¡æœ‰é‡æ–°å®šä¹‰å‡½æ•°ï¼Œå°†ä½¿ç”¨è¯¥å‡½æ•°çš„åŸºç±»ç‰ˆæœ¬ï¼›
* å¦‚æœæ´¾ç”Ÿç±»ä½äºæ´¾ç”Ÿé“¾ä¸­ï¼Œåˆ™å°†ä½¿ç”¨æœ€æ–°çš„è™šå‡½æ•°ç‰ˆæœ¬ï¼›
* ä¾‹å¤–çš„æƒ…å†µæ˜¯åŸºç±»ç‰ˆæœ¬æ˜¯éšè—çš„ï¼ˆç¨åå°†ä»‹ç»ï¼‰ã€‚

**5ã€é‡æ–°å®šä¹‰å°†éšè—æ–¹æ³•ï¼š**

* é‡æ–°å®šä¹‰ä¸ä¼šç”Ÿæˆå‡½æ•°çš„ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œè€Œæ˜¯éšè—äº†åŸºç±»ç‰ˆæœ¬ã€‚
  * æ€»ä¹‹ï¼Œé‡æ–°å®šä¹‰ç»§æ‰¿çš„æ–¹æ³•å¹¶ä¸æ˜¯é‡è½½ã€‚
  * å¦‚æœåœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰å‡½æ•°ï¼Œå°†ä¸æ˜¯ä½¿ç”¨ç›¸åŒçš„å‡½æ•°ç‰¹å¾æ ‡è¦†ç›–åŸºç±»å£°æ˜ï¼Œè€Œæ˜¯éšè—åŒåçš„åŸºç±»æ–¹æ³•ï¼Œä¸ç®¡å‚æ•°ç‰¹å¾æ ‡å¦‚ä½•ã€‚
* ä¸¤æ¡ç»éªŒè§„åˆ™ï¼š
  * å¦‚æœé‡æ–°å®šä¹‰ç»§æ‰¿çš„æ–¹æ³•ï¼Œåº”ç¡®ä¿ä¸åŸæ¥çš„åŸå‹å®Œå…¨ç›¸åŒ.
    * ä½†å¦‚æœè¿”å›ç±»å‹æ˜¯åŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆï¼Œåˆ™å¯ä»¥ä¿®æ”¹ä¸ºæŒ‡å‘æ´¾ç”Ÿç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆï¼ˆè¿™ç§ä¾‹å¤–æ˜¯æ–°å‡ºç°çš„ï¼‰ã€‚
      * è¿™ç§ç‰¹æ€§è¢«ç§°ä¸ºè¿”å›ç±»å‹åå˜ï¼ˆcovariance ofreturn typeï¼‰ï¼Œå› ä¸ºå…è®¸è¿”å›ç±»å‹éšç±»ç±»å‹çš„å˜åŒ–è€Œå˜åŒ–ï¼šP506
      * è¿™ç§ä¾‹å¤–åªé€‚ç”¨äºè¿”å›å€¼ï¼Œè€Œä¸é€‚ç”¨äºå‚æ•°ã€‚
  * å¦‚æœåŸºç±»å£°æ˜è¢«é‡è½½äº†ï¼Œåˆ™åº”åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰æ‰€æœ‰çš„åŸºç±»ç‰ˆæœ¬ã€‚



### 13.5 è®¿é—®æ§åˆ¶ï¼šprotected

é™¤äº† public å’Œ private æ¥æ§åˆ¶å¯¹ç±»æˆå‘˜çš„è®¿é—®ï¼Œè¿˜å­˜åœ¨å¦ä¸€ä¸ªè®¿é—®ç±»åˆ«ï¼šprotected **ä¿æŠ¤æˆå‘˜**ï¼ˆä¸privateç›¸ä¼¼ï¼Œåœ¨ç±»å¤–åªèƒ½ç”¨å…¬æœ‰ç±»æˆå‘˜æ¥è®¿é—® protected éƒ¨åˆ†ä¸­çš„ç±»æˆå‘˜ï¼‰ã€‚

private å’Œ protected ä¹‹é—´çš„åŒºåˆ«åªæœ‰åœ¨åŸºç±»æ´¾ç”Ÿçš„ç±»ä¸­å¾—ä»¥è¡¨ç°ï¼š

* æ´¾ç”Ÿç±»æˆå‘˜å¯ä»¥ä¹‹é—´è®¿é—®åŸºç±»çš„ä¿æŠ¤æˆå‘˜ï¼Œä½†ä¸èƒ½ç›´æ¥è®¿é—®åŸºç±»çš„ç§æœ‰æˆå‘˜ã€‚
* å› æ­¤ï¼Œå¯¹äºå¤–éƒ¨ä¸–ç•Œæ¥è¯´ï¼Œ**ä¿æŠ¤æˆå‘˜**çš„è¡Œä¸ºä¸ç§æœ‰æˆå‘˜ç›¸ä¼¼ï¼›
* ä½†å¯¹äºæ´¾ç”Ÿç±»æ¥è¯´ï¼Œ**ä¿æŠ¤æˆå‘˜**çš„è¡Œä¸ºä¸å…¬æœ‰æˆå‘˜ç›¸ä¼¼ã€‚
* è§P507-508

â—è­¦å‘Šï¼šæœ€å¥½å¯¹ç±»æ•°æ®æˆå‘˜é‡‡ç”¨ç§æœ‰è®¿é—®æ§åˆ¶ï¼Œä¸è¦ä½¿ç”¨ä¿æŠ¤è®¿é—®æ§åˆ¶ï¼›åŒæ—¶é€šè¿‡åŸºç±»æ–¹æ³•ä½¿æ´¾ç”Ÿç±»èƒ½å¤Ÿè®¿é—®åŸºç±»æ•°æ®ã€‚

ç„¶è€Œï¼Œå¯¹äºæˆå‘˜å‡½æ•°æ¥è¯´ï¼Œä¿æŠ¤è®¿é—®æ§åˆ¶å¾ˆæœ‰ç”¨ï¼Œå®ƒè®©æ´¾ç”Ÿç±»èƒ½å¤Ÿè®¿é—®å…¬ä¼—ä¸èƒ½ä½¿ç”¨çš„å†…éƒ¨å‡½æ•°ã€‚



### 13.6 æŠ½è±¡åŸºç±»

ç¤ºä¾‹ï¼šå¼€å‘å›¾å½¢ç¨‹åºï¼Œæ˜¾ç¤ºåœ†å’Œæ¤­åœ†ï¼ˆåœ†æ˜¯æ¤­åœ†çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼‰ï¼Œå¯ä»¥ä» Ellipse ç±»æ´¾ç”Ÿå‡º Circle ç±»ï¼Œä½†æ˜¯æ¶‰åŠåˆ°æ¤­åœ†é¢ç§¯ï¼Œç§»åŠ¨æ¤­åœ†ç­‰æ“ä½œæ–¹æ³•æ—¶ï¼Œå¯¹åœ†æ¥è¯´å¹¶ä¸é€‚ç”¨ã€‚

* æ€»ä¹‹ï¼Œä¸é€‚ç”¨ç»§æ‰¿ï¼Œç›´æ¥å®šä¹‰ Circle ç±»æ›´ç®€å•ï¼›
* è§£å†³æ–¹æ³•ï¼š
  * ä» Ellipse å’Œ Circle ç±»ä¸­æŠ½è±¡å‡ºå®ƒä»¬çš„å…±æ€§ï¼Œå°†è¿™äº›ç‰¹æ€§æ”¾åˆ°ä¸€ä¸ªæŠ½è±¡åŸºç±»ä¸­ï¼ˆABCï¼‰ã€‚
  * ç„¶åï¼Œä»è¯¥ABCæ´¾ç”Ÿå‡º Circle å’Œ Ellipse ç±»ã€‚
  * è¿™æ ·ä¾¿å¯ä»¥ä½¿ç”¨åŸºç±»æŒ‡é’ˆæ•°ç»„åŒæ—¶ç®¡ç† Circle å’Œ Ellipse å¯¹è±¡ã€‚

C++é€šè¿‡ä½¿ç”¨**çº¯è™šå‡½æ•°**æä¾›ä¸ºå®ç°çš„å‡½æ•°ã€‚çº¯è™šå‡½æ•°å£°æ˜çš„ç»“å°¾å¤„ä¸º =0ï¼Œå‚è§P509çš„ Area()æ–¹æ³•ï¼š

* ```c++
  virtual double Area() const = 0;
  ```

* æ€»ä¹‹ï¼Œåœ¨åŸå‹ä¸­ä½¿ç”¨ =0 æŒ‡å‡ºç±»æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œåœ¨ç±»ä¸­å¯ä»¥ä¸å®šä¹‰è¯¥å‡½æ•°ã€‚

ç°åœ¨ï¼Œå¯ä»¥ä» BaseEllipse ç±»æ´¾ç”Ÿå‡º Ellips ç±»å’Œ Cirle ç±»ï¼Œæ·»åŠ æ‰€éœ€çš„æˆå‘˜æ¥å®Œæˆæ¯ä¸ªç±»ã€‚è§P510ã€‚

* ä½¿ç”¨è¿™äº›ç±»çš„ç¨‹åºå°†èƒ½å¤Ÿåˆ›å»º Ellipse å¯¹è±¡å’Œ Circle å¯¹è±¡ï¼Œä½†æ˜¯ä¸èƒ½åˆ›å»º BaseEllipse å¯¹è±¡ã€‚

ğŸ“Œæ€»ä¹‹ï¼ŒABC æè¿°çš„æ˜¯è‡³å°‘ä½¿ç”¨ä¸€ä¸ªçº¯è™šå‡½æ•°çš„æ¥å£ï¼Œä» ABC æ´¾ç”Ÿå‡ºçš„ç±»å°†æ ¹æ®æ´¾ç”Ÿç±»çš„å…·ä½“ç‰¹å¾ï¼Œä½¿ç”¨å¸¸è§„è™šå‡½æ•°æ¥å®ç°è¿™ç§æ¥å£ã€‚



#### 13.6.1 åº”ç”¨ ABC æ¦‚å¿µ

é¦–å…ˆå®šä¹‰ä¸€ä¸ªåä¸º AcctABC çš„ ABCã€‚è¿™ä¸ª**æŠ½è±¡åŸºç±»**åŒ…å« Brass å’Œ BrassPlus ç±»å…¬æœ‰çš„æ‰€æœ‰æ–¹æ³•å’Œæ•°æ®æˆå‘˜ï¼Œè€Œé‚£äº›åœ¨ BrassPluss å’Œ Brass ç±»ä¸­çš„è¡Œä¸ºä¸åŒçš„æ–¹æ³•åº”è¢«å£°æ˜ä¸ºè™šå‡½æ•°ã€‚<u>è‡³å°‘åº”æœ‰ä¸€ä¸ªè™šå‡½æ•°æ˜¯çº¯è™šå‡½æ•°ï¼Œè¿™æ ·æ‰èƒ½ä½¿ AcctABC ç§°ä¸ºæŠ½è±¡ç±»ã€‚</u>

ç¨‹åºæ¸…å•ï¼š

* ç¤ºä¾‹ï¼š

  * ```c++
    #pragma once
    // ch13_11_acctabc.h -- bank account classes
    #ifndef CH13_11_ACCTABC_H_
    #define CH13_11_ACCTABC_H_
    #include <iostream>
    #include <string>
    
    // Abstract Base Class
    class AcctABC
    {
    private:
    	std::string fullName;
    	long acctNum;
    	double balance;
    protected:
    	struct Formatting
    	{
    		std::ios_base::fmtflags flag;
    		std::streamsize pr;
    	};
    	const std::string& FullName() const { return fullName; }
    	long AcctNum() const { return acctNum; }
    	Formatting SetFormat() const;
    	void Restore(Formatting& f) const;
    public:
    	AcctABC(const std::string& s = "Nullbody", long an = -1,
    			double bal = 0.0);
    	void Deposit(double amt);
    	virtual void Withdraw(double amt) = 0;
    	double Balance() const { return balance; };
    	virtual void ViewAcct() const = 0;
    	virtual ~AcctABC() {}
    };
    
    // Brass Account Class
    class Brass : public AcctABC
    {
    public:
    	Brass(const std::string & s = "Nullbody", long an = -1,
    		double bal = 0.0) : AcctABC(s, an, bal) { }
    	virtual void Withdraw(double amt);
    	virtual void ViewAcct() const;
    	virtual ~Brass() {}
    };
    
    // Brass Plus Account Class
    class BrassPlus : public AcctABC
    {
    private:
    	double maxLoan;
    	double rate;
    	double owesBank;
    public:
    	BrassPlus(const std::string& s = "Nullbody", long an = -1,
    			double bal = 0.0, double ml = 500, double r = 0.10);
    	BrassPlus(const Brass& ba, double ml = 500, double r = 0.1);
    	virtual void ViewAcct() const;
    	virtual void Withdraw(double amt);
    	void ResetMax(double m) { maxLoan = m; }
    	void ResetRate(double r) { rate = r; }
    	void ResetOwes() { owesBank = 0; }
    };
    
    #endif
    ```

  * ```c++
    // ch13_12_acctabc.cpp -- bank account class methods
    #include <iostream>
    #include "ch13_11_acctabc.h"
    using std::cout;
    using std::ios_base;
    using std::endl;
    using std::string;
    
    // Abstract Base Class
    AcctABC::AcctABC(const string& s, long an, double bal)
    {
    	fullName = s;
    	acctNum = an;
    	balance = bal;
    }
    
    void AcctABC::Deposit(double amt)
    {
    	if (amt < 0)
    		cout << "Negative deposit not allowed; "
    		<< "deposit is cancelled.\n";
    	else
    		balance += amt;
    }
    
    void AcctABC::Withdraw(double amt)
    {
    	balance -= amt;
    }
    
    // protected methods for formatting
    AcctABC::Formatting AcctABC::SetFormat() const
    {
    // set up ###.## format
    	Formatting f;
    	f.flag = cout.setf(ios_base::fixed, ios_base::floatfield);
    	f.pr = cout.precision(2);
    	return f;
    }
    
    void AcctABC::Restore(Formatting& f) const
    {
    	cout.setf(f.flag, ios_base::floatfield);
    	cout.precision(f.pr);
    }
    
    // Brass methods
    void Brass::Withdraw(double amt)
    {
    	if (amt < 0)
    		cout << "Withdrawal amount must be positive; "
    		<< "withdrawal canceled.\n";
    	else if (amt <= Balance())
    		AcctABC::Withdraw(amt);
    	else
    		cout << "Withdrawal amount of $" << amt
    		<< " exceeds your balance.\n"
    		<< "Withdrawal canceled.\n";
    }
    
    void Brass::ViewAcct() const
    {
    	Formatting f = SetFormat();
    	cout << "Brass Client: " << FullName() << endl;
    	cout << "Account Number: " << AcctNum() << endl;
    	cout << "Balance: $" << Balance() << endl;
    	Restore(f);
    }
    
    // BrassPlus Methods
    BrassPlus::BrassPlus(const string& s, long an, double bal,
    	double ml, double r) : AcctABC(s, an, bal)
    {
    	maxLoan = ml;
    	owesBank = 0.0;
    	rate = r;
    }
    
    BrassPlus::BrassPlus(const Brass& ba, double ml, double r)
    	: AcctABC(ba)	// uses implicit copy constructor
    {
    	maxLoan = ml;
    	owesBank = 0.0;
    	rate = r;
    }
    
    void BrassPlus::ViewAcct() const
    {
    	Formatting f = SetFormat();
    
    	cout << "BrassPlus Clien: " << FullName() << endl;
    	cout << "Account Number: " << AcctNum() << endl;
    	cout << "Balance: $" << Balance() << endl;
    	cout << "Maximum loan: $" << maxLoan << endl;
    	cout << "Owed to bank: $" << owesBank << endl;
    	cout.precision(3);
    	cout << "Loan Rate: " << 100 * rate << "%\n";
    	Restore(f);
    }
    
    void BrassPlus::Withdraw(double amt)
    {
    	Formatting f = SetFormat();
    
    	double bal = Balance();
    	if (amt <= bal)
    		AcctABC::Withdraw(amt);
    	else if (amt <= bal + maxLoan - owesBank)
    	{
    		double advance = amt - bal;
    		owesBank += advance * (1.0 + rate);
    		cout << "Bank advance: $" << advance << endl;
    		cout << "Finance charge: $" << advance * rate << endl;
    		Deposit(advance);
    		AcctABC::Withdraw(amt);
    	}
    	else cout << "Credit limit exceeded. Transaction cancelled.\n";
    	Restore(f);
    }
    ```

    * å¯¹äºè¾“å‡ºæ ¼å¼ï¼Œè¿™ä¸€ç‰ˆæœ¬å®šä¹‰äº†ä¸€ä¸ªç»“æ„ï¼Œç”¨äºå­˜å‚¨ä¸¤é¡¹æ ¼å¼è®¾ç½®ï¼›å¹¶ä½¿ç”¨è¯¥ç»“æ„æ¥è®¾ç½®å’Œæ¢å¤æ ¼å¼ï¼Œå› æ­¤åªéœ€è¦ä¸¤ä¸ªå‡½æ•°è°ƒç”¨ã€‚
      * ç”±äºè¯¥ç¤ºä¾‹æ¢è®¨ä¿æŠ¤è®¿é—®æƒé™ï¼Œå› æ­¤å°†è¿™äº›å‡½æ•°ä»¥åŠç»“æ„æ”¾åœ¨äº†ç±»å®šä¹‰çš„ä¿æŠ¤éƒ¨åˆ†ã€‚è¿™ä½¿å¾—å®ƒä»¬å¯¹åŸºç±»å’Œæ´¾ç”Ÿç±»å¯ç”¨ï¼ŒåŒæ—¶å‘å¤–éšè—äº†å®ƒä»¬ã€‚

  * ```c++
    // ch13_13_usebrass3.cpp -- polymorphic example
    // compile with  ch13_12_acctabc.cpp
    #include <iostream>
    #include <string>
    #include "ch13_11_acctabc.h"
    
    const int CLIENTS = 4;
    
    int main()
    {
    	using std::cin;
    	using std::cout;
    	using std::endl;
    
    	AcctABC* p_clients[CLIENTS];
    	std::string temp;
    	long tempnum;
    	double tempbal;
    	char kind;
    
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		cout << "Enter client's name: ";
    		getline(cin, temp);
    		cout << "Enter client's account number: ";
    		cin >> tempnum;
    		cout << "Enter opening balance: $";
    		cin >> tempbal;
    		cout << "Enter 1 for Brass Account or "
    			<< "2 for BrassPlus Account: ";
    		while (cin >> kind && (kind != '1' && kind != '2'))
    			cout << "Enter either 1 or 2: ";
    		if (kind == '1')
    			p_clients[i] = new Brass(temp, tempnum, tempbal);
    		else
    		{
    			double tmax, trate;
    			cout << "Enter the overdraft limit: $";
    			cin >> tmax;
    			cout << "Enter the interest rate "
    				<< "as a decimal fraction: ";
    			cin >> trate;
    			p_clients[i] = new BrassPlus(temp, tempnum, tempbal,
    										 tmax, trate);
    		}
    		while (cin.get() != '\n')
    			continue;
    	}
    	cout << endl;
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		p_clients[i]->ViewAcct();
    		// å¦‚æœæ•°ç»„æˆå‘˜æŒ‡å‘çš„æ˜¯ Brass å¯¹è±¡ï¼Œåˆ™è°ƒç”¨ Brass::ViewAcct();
    		// å¦‚æœæ•°ç»„æˆå‘˜æŒ‡å‘çš„æ˜¯ BrassPlus å¯¹è±¡ï¼Œåˆ™è°ƒç”¨ BrassPlus::ViewAcct();
    		// å¦‚æœ Brass::ViewAcct() è¢«å£°æ˜ä¸ºè™šçš„ï¼Œåˆ™åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å°†è°ƒç”¨ Brass::ViewAcct()ã€‚
    		cout << endl;
    	}
    
    	for (int i = 0; i < CLIENTS; i++)
    	{
    		delete p_clients[i];
    	}
    	cout << "Done.\n";
    	return 0;
    }
    ```

* ç»“æœï¼š

  * ```c++
    Enter client's name: Harry Fishsong
    Enter client's account number: 112233
    Enter opening balance: $1500
    Enter 1 for Brass Account or 2 for BrassPlus Account: 1
    Enter client's name: Dinah Otternoe
    Enter client's account number: 121213
    Enter opening balance: $1800
    Enter 1 for Brass Account or 2 for BrassPlus Account: 2
    Enter the overdraft limit: $350
    Enter the interest rate as a decimal fraction: 0.12
    Enter client's name: Brenda Birdherd
    Enter client's account number: 212118
    Enter opening balance: $5200
    Enter 1 for Brass Account or 2 for BrassPlus Account: 2
    Enter the overdraft limit: $800
    Enter the interest rate as a decimal fraction: 0.10
    Enter client's name: Tim Turtletop
    Enter client's account number: 233255
    Enter opening balance: $688
    Enter 1 for Brass Account or 2 for BrassPlus Account: 1
    
    Brass Client: Harry Fishsong
    Account Number: 112233
    Balance: $1500.00
    
    BrassPlus Clien: Dinah Otternoe
    Account Number: 121213
    Balance: $1800.00
    Maximum loan: $350.00
    Owed to bank: $0.00
    Loan Rate: 12.000%
    
    BrassPlus Clien: Brenda Birdherd
    Account Number: 212118
    Balance: $5200.00
    Maximum loan: $800.00
    Owed to bank: $0.00
    Loan Rate: 10.000%
    
    Brass Client: Tim Turtletop
    Account Number: 233255
    Balance: $688.00
    
    Done.
    ```



#### 13.6.2 ABC ç†å¿µ

è®¾è®¡ ABC ä¹‹å‰ï¼Œé¦–å…ˆåº”å¼€å‘ä¸€ä¸ªæ¨¡å‹â€”â€”æŒ‡å‡ºç¼–ç¨‹é—®é¢˜æ‰€éœ€çš„ç±»ä»¥åŠå®ƒä»¬ä¹‹é—´ç›¸äº’å…³ç³»ã€‚

å¯ä»¥å°† ABC çœ‹ä½œæ˜¯ä¸€ç§å¿…é¡»å®æ–½çš„æ¥å£ã€‚ABC è¦æ±‚å…·ä½“æ´¾ç”Ÿç±»è¦†ç›–å…¶çº¯è™šå‡½æ•°â€”â€”è¿«ä½¿æ´¾ç”Ÿç±»éµå¾ªABC è®¾ç½®çš„æ¥å£è§„åˆ™ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ ABC ä½¿å¾—ç»„ä»¶è®¾è®¡äººå‘˜èƒ½å¤Ÿåˆ¶å®šâ€œæ¥å£çº¦å®šâ€ï¼Œè¿™æ ·ç¡®ä¿äº†ä»ABC æ´¾ç”Ÿçš„æ‰€æœ‰ç»„ä»¶éƒ½è‡³å°‘æ”¯æŒ ABC æŒ‡å®šçš„åŠŸèƒ½ã€‚



### 13.7 ç»§æ‰¿å’ŒåŠ¨æ€å†…å­˜åˆ†é…

ç»§æ‰¿ä¸åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆnew å’Œ deleteï¼‰äº’åŠ¨ï¼Œå¦‚æœåŸºç±»ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼Œå¹¶é‡æ–°å®šä¹‰èµ‹å€¼å’Œå¤åˆ¶æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆæ´¾ç”Ÿç±»çš„å®ç°å°†å–å†³äºæ´¾ç”Ÿç±»çš„å±æ€§ã€‚å¦‚æœæ´¾ç”Ÿç±»ä¹Ÿæ˜¯ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼Œé‚£ä¹ˆå°±éœ€è¦æ³¨æ„ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š



#### 13.7.1 ç¬¬ä¸€ç§æƒ…å†µï¼šæ´¾ç”Ÿç±»ä¸ä½¿ç”¨ new

å‡è®¾åŸºç±»ä½¿ç”¨äº†åŠ¨æ€å†…å­˜åˆ†é…ï¼š

* ```c++
  // Bass Class Using DMA
  class baseDMA
  {
  private:
      char * label;
      int rating;
  public:
      baseDMA(const char * 1 = "null", int r = 0);
      baseDMA(const baseDMA & rs);
      virtual ~baseDMA();
      baseDMA & operator=(const baseDMA & rs);
      ...
  };
  ```

  * å£°æ˜ä¸­åŒ…å«äº†**æ„é€ å‡½æ•°ä½¿ç”¨ new æ—¶éœ€è¦çš„ç‰¹æ®Šæ–¹æ³•**ï¼š<u>ææ„å‡½æ•°</u>ã€<u>å¤åˆ¶æ„é€ å‡½æ•°</u>å’Œ<u>é‡è½½èµ‹å€¼è¿ç®—ç¬¦</u>ã€‚

ç°åœ¨ä»åŸºç±» baseDMA ä¸­æ´¾ç”Ÿå‡º lackDMA ç±»ï¼Œè€Œåè€…ä¸é€‚ç”¨newï¼Œä¹ŸæœªåŒ…å«å…¶ä»–ä¸€äº›ä¸å¸¸ç”¨çš„ã€éœ€è¦ç‰¹æ®Šå¤„ç†çš„è®¾è®¡ç‰¹æ€§ï¼š

* ```c++
  // derived class without DMA
  class lacksDMA : public baseDMA
  {
  private:
      char color[40];
  public:
      ...
  };
  ```

* â—ä¸éœ€è¦ä¸ºæ´¾ç”Ÿç±» lackDMA ç±»å®šä¹‰æ˜¾ç¤ºææ„å‡½æ•°ã€å¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ã€‚è§P517

  * æ´¾ç”Ÿç±»å¯¹è±¡çš„è¿™äº›å±æ€§ä¹Ÿé€‚ç”¨äºæœ¬èº«æ­»å¯¹è±¡çš„ç±»æˆå‘˜ã€‚



#### 13.7.2 ç¬¬äºŒç§æƒ…å†µï¼šæ´¾ç”Ÿç±»ä½¿ç”¨ new

å‡è®¾åŸºç±»ä½¿ç”¨äº† newï¼š

* ```c++
  // derived class with DMA
  class hasDMA : public baseDMA
  {
  private:
      char * style;	// use new in constructors
  public:
      ...
  };
  ```

  * åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»ä¸ºæ´¾ç”Ÿç±»å®šä¹‰æ˜¾å¼ææ„å‡½æ•°ã€å¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦

* ææ„å‡½æ•°ï¼š

  * æ´¾ç”Ÿç±»ææ„å‡½æ•°è‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°ï¼Œæ•…å…¶è‡ªèº«çš„èŒè´£æ˜¯å¯¹æ´¾ç”Ÿç±»æ„é€ å‡½æ•°æ‰§è¡Œå·¥ä½œçš„è¿›è¡Œæ¸…ç†ã€‚å› æ­¤ hasDMA ææ„å‡½æ•°å¿…é¡»é‡Šæ”¾æŒ‡é’ˆ style ç®¡ç†çš„å†…å­˜å¹¶ä¾èµ–äº baseDMA çš„ææ„å‡½æ•°æ¥é‡Šæ”¾æŒ‡é’ˆ label ç®¡ç†çš„å†…å­˜ã€‚

    * ```c++
      baseDMA::~baseDMA()
      {
          delete [] label;
      }
      
      hasDMA::~hasDMA()
      {
          delete [] style;
      }
      ```

* å¤åˆ¶æ„é€ å‡½æ•°ï¼š

  * BaseDMAçš„å¤åˆ¶æ„é€ å‡½æ•°éµå¾ªç”¨äº char æ•°ç»„çš„å¸¸è§„æ¨¡å¼ï¼Œå³ä½¿ç”¨ strlen() æ¥è·æ‚‰å­˜å‚¨C-é£æ ¼å­—ç¬¦ä¸²æ‰€éœ€çš„ç©ºé—´ã€åˆ†é…è¶³å¤Ÿçš„å†…å­˜(å­—ç¬¦æ•°åŠ ä¸Šå­˜å‚¨ç©ºå­—ç¬¦æ‰€éœ€çš„1å­—èŠ‚)å¹¶ä½¿ç”¨å‡½æ•°strcpy()å°†åŸå§‹å­—ç¬¦ä¸²å¤åˆ¶åˆ°ç›®çš„åœ°ï¼š

    * ```c++
      baseDMA::baseDMA(const baseDMA & rs)
      {
          label = new char[std::strlen(re.label) + 1];
          std::strcpy(label, rs.label);
          rating = rs.rating;
      }
      ```

  * hasDMA å¤åˆ¶æ„é€ å‡½æ•°åªèƒ½è®¿é—® hasDMA çš„æ•°æ®å› æ­¤å®ƒå¿…é¡»è°ƒç”¨ baseDMA å¤åˆ¶æ„é€ å‡½æ•°æ¥å¤„ç†å…±äº«çš„ baseDMA æ•°æ®ï¼š

    * ```c++
      hasDMA::hasDMA(const hasDMA & hs) : baseDMA(hs)
      {
          style = new char[std::strlen(hs.style) + 1];
          std::strcpy(style, hs.style);
      }
      ```

* èµ‹å€¼è¿ç®—ç¬¦ï¼š

  * baseDMAèµ‹å€¼è¿ç®—ç¬¦éµå¾ªå¦‚ä¸‹å¸¸è§„æ ¼å¼ï¼š

    * ```c++
      baseDMA & baseDMA::operator=(const baseDMA & rs)
      {
          if (this == &rs)
              return *this;
          delete [] label;
          label = new chat[std::strlen(rs.label) + 1];
          std::strcpy(label, rs.label);
          rating = rs.rating;
          return * this;
      }
      ```

  * ç”±äº hasDMA ä¹Ÿä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼Œæ‰€ä»¥å®ƒä¹Ÿéœ€è¦ä¸€ä¸ªæ˜¾å¼èµ‹å€¼è¿ç®—ç¬¦ã€‚ä½œä¸º hasDMA çš„æ–¹æ³•ï¼Œå®ƒåªèƒ½ç›´æ¥è®¿é—® hasDMA çš„æ•°æ®ã€‚ç„¶è€Œï¼Œæ´¾ç”Ÿç±»çš„æ˜¾å¼èµ‹å€¼è¿ç®—ç¬¦å¿…é¡»è´Ÿè´£æ‰€æœ‰ç»§æ‰¿çš„ baseDMA åŸºç±»å¯¹è±¡çš„èµ‹å€¼ï¼Œå¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨åŸºç±»èµ‹å€¼è¿ç®—ç¬¦æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

    * ```c++
      hasDMA & hasDMA::operator=(const hasDMA & hs)
      {
          if (this == &hs)
              return *this;
          baseDMA::operator=(hs);
          delete [] style;
          style = new char[std::strlen(hs.style) + 1];
          std::strcpy(style, hs.style);
          return *this;
      }
      ```

      * baseDMA::operator=(hs); é€šè¿‡ä½¿ç”¨å‡½æ•°è¡¨ç¤ºæ³•ï¼Œè€Œä¸æ˜¯è¿ç®—ç¬¦è¡¨ç¤ºæ³•ï¼Œå¯ä»¥ä½¿ç”¨ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦ã€‚è¯¥è¯­å¥å«ä¹‰æ˜¯ï¼š*this = hs; 
      * ç¼–è¯‘å™¨å°†ä½¿ç”¨hasDMA::operator=()ï¼Œä»è€Œå½¢æˆé€’å½’è°ƒç”¨ã€‚ä½¿ç”¨å‡½æ•°è¡¨ç¤ºæ³•ä½¿å¾—èµ‹å€¼è¿ç®—ç¬¦è¢«æ­£ç¡®è°ƒç”¨ã€‚

æ€»ä¹‹ï¼Œå½“**åŸºç±»å’Œæ´¾ç”Ÿç±»**éƒ½é‡‡ç”¨**åŠ¨æ€å†…å­˜åˆ†é…**æ—¶ï¼Œæ´¾ç”Ÿç±»çš„ææ„å‡½æ•°ã€å¤åˆ¶æ„é€ å‡½æ•°ã€èµ‹å€¼è¿ç®—ç¬¦éƒ½**å¿…é¡»ä½¿ç”¨ç›¸åº”**çš„åŸºç±»æ–¹æ³•æ¥å¤„ç†åŸºç±»å…ƒç´ ã€‚

è¿™ç§è¦æ±‚æ˜¯é€šè¿‡ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥æ»¡è¶³çš„ï¼š

* å¯¹äºææ„å‡½æ•°ï¼Œè¿™æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼›
* å¯¹äºæ„é€ å‡½æ•°ï¼Œè¿™æ˜¯é€šè¿‡åœ¨åˆå§‹åŒ–æˆå‘˜åˆ—è¡¨ä¸­è°ƒç”¨åŸºç±»çš„å¤åˆ¶æ„é€ å‡½æ•°æ¥å®Œæˆçš„ï¼›å¦‚æœä¸è¿™æ ·åšï¼Œå°†è‡ªåŠ¨è°ƒç”¨åŸºç±»çš„é»˜è®¤æ„é€ å‡½æ•°ã€‚
* å¯¹äºèµ‹å€¼è¿ç®—ç¬¦ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨ä½œç”¨åŸŸè§£æè¿ç®—ç¬¦æ˜¾å¼åœ°è°ƒç”¨åŸºç±»çš„èµ‹å€¼è¿ç®—ç¬¦æ¥å®Œæˆçš„ã€‚



#### 13.7.3 ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…å’Œå‹å…ƒçš„ç»§æ‰¿ç¤ºä¾‹

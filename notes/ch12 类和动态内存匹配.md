## ç¬¬åäºŒç«  ç±»å’ŒåŠ¨æ€å†…å­˜åŒ¹é…

åœ¨ç±»æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newè¿ç®—ç¬¦åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ†é…æ‰€éœ€çš„å†…å­˜ã€‚ä¸ºæ­¤ï¼Œé€šå¸¸çš„æ–¹æ³•æ˜¯ä½¿ç”¨ string ç±»ï¼Œå®ƒå°†ä¸ºæ‚¨å¤„ç†å†…å­˜ç®¡ç†ç»†èŠ‚ã€‚

### 12.1 åŠ¨æ€å†…å­˜å’Œç±»

C++ä½¿ç”¨ new å’Œ delete è¿ç®—ç¬¦æ¥åŠ¨æ€æ§åˆ¶å†…å­˜ã€‚ä½†æ˜¯åœ¨ç±»ä¸­ä½¿ç”¨è¿™äº›è¿ç®—ç¬¦å°†å¯¼è‡´è®¸å¤šæ–°çš„ç¼–ç¨‹é—®é¢˜ã€‚å› æ­¤ï¼Œææ„å‡½æ•°å°†æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè€Œä¸å†æ˜¯å¯æœ‰å¯æ— ã€‚

æ‰©å±•ææ„å‡½æ•°ã€ä½¿æ‰€æœ‰çš„æ„é€ å‡½æ•°ä¸ new ææ„å‡½æ•°åè°ƒä¸€è‡´ã€ç¼–å†™é¢å¤–çš„ç±»æ–¹æ³•æ¥å¸®åŠ©æ­£ç¡®å®Œæˆåˆå§‹åŒ–å’Œå¤åˆ¶ã€‚

#### 12.1.1 å¤ä¹ ç¤ºä¾‹å’Œé™æ€ç±»æˆå‘˜

ï¼ˆ1ï¼‰é™æ€ç±»æˆå‘˜ã€æ–°çš„å­˜å‚¨ç±»å‹ã€‘

* ç¤ºä¾‹ï¼š

  * ```c++
    #pragma once
    // ch12_01_strngbad.h -- flawed string class definition
    #include <iostream>
    #ifndef CH12_01_STRNGBAD_H_
    #define CH12_01_STRNGBAD_H_
    
    class StringBad
    {
    private:
    	char* str;
    	int len;
    	static int num_strings;
    public:
    	StringBad(const char* s);
    	StringBad();
    	~StringBad();
    // friend function
    	friend std::ostream& operator<<(std::ostream& os, const StringBad& st);
    };
    #endif
    ```

  * å¯¹è¿™ä¸ªå£°æ˜ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ä¸¤ç‚¹ï¼š

    * é¦–å…ˆï¼Œå®ƒä½¿ç”¨ char æŒ‡é’ˆ(è€Œä¸æ˜¯ char æ•°ç»„)æ¥è¡¨ç¤ºå§“åã€‚è¿™æ„å‘³ç€ç±»å£°æ˜æ²¡æœ‰ä¸ºå­—ç¬¦ä¸²æœ¬èº«åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€Œæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ new æ¥ä¸ºå­—ç¬¦åˆ†é…ç©ºé—´ã€‚è¿™é¿å…äº†åœ¨ç±»å£°æ˜ä¸­é¢„å…ˆå®šä¹‰å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚
    * å…¶æ¬¡ï¼Œå°† num_strings æˆå‘˜å£°æ˜ä¸ºé™æ€å­˜å‚¨ç±»ã€‚
      * é™æ€ç±»æˆå‘˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šæ— è®ºåˆ›å»ºäº†å¤šå°‘å¯¹è±¡ï¼Œç¨‹åºéƒ½åªåˆ›å»ºä¸€ä¸ªé™æ€ç±»å˜é‡å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»çš„æ‰€æœ‰å¯¹è±¡å…±äº«åŒä¸€ä¸ªé™æ€æˆå‘˜ï¼Œå°±åƒå®¶ä¸­çš„ç”µè¯å¯ä¾›å…¨ä½“å®¶åº­æˆå‘˜å…±äº«ä¸€æ ·ã€‚å‡è®¾åˆ›å»ºäº†10ä¸ªStringBad å¯¹è±¡ï¼Œå°†æœ‰10ä¸ª str æˆå‘˜å’Œ10ä¸ª len æˆå‘˜ä½†åªæœ‰ä¸€ä¸ªå…±äº«çš„num_stringsæˆå‘˜(å‚è§å›¾ 12.1)è¿™å¯¹äºæ‰€æœ‰ç±»å¯¹éƒ½å…·æœ‰ç›¸åŒå€¼çš„ç±»ç§æœ‰æ•°æ®æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚ä¾‹å¦‚numstringsæˆå‘˜å¯ä»¥è®°å½•æ‰€åˆ›å»ºçš„å¯¹è±¡æ•°ç›®ã€‚
      ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/1bc29af5-e530-45a0-b8c2-7b72c629ba0a)

* ç¤ºä¾‹ï¼šç±»æ–¹æ³•æ–‡ä»¶

  * ```c++
    // ch12_02_strngbad.cpp -- StringBad class methods
    #include <cstring>
    #include "ch12_01_strngbad.h"
    using std::cout;
    
    // initializing static class member
    int StringBad::num_strings = 0;
    
    // class methods
    // construct StringBad from C string
    StringBad::StringBad(const char* s)
    {
    	len = std::strlen(s);
    	str = new char[len + 1];
    	std::strcpy(str, s);
    	num_strings++;
    	cout << num_strings << ": \"" << str
    		<< "\" object created\n";
    }
    
    StringBad::StringBad()
    {
    	len = 4;
    	str = new char[4];
    	std::strcpy(str, "C++");
    	num_strings++;
    	cout << num_strings << ": \"" << str
    		<< "\" default object created\n";
    }
    
    StringBad::~StringBad()
    {
    	cout << "\"" << str << "\" object deleted, ";
    	--num_strings;
    	cout << num_strings << " left\n";
    	delete[] str;
    }
    
    std::ostream& operator <<(std::ostream& os, const StringBad& st)
    {
    	os << st.str;
    	return os;
    }
    ```

  * é™æ€æˆå‘˜num_stringsçš„å€¼åˆå§‹åŒ–ä¸ºé›¶ï¼š

    * ```c++
      int StringBad::num_strings = 0;
      ```

    * ğŸ“Œæ³¨æ„ï¼ä¸èƒ½åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ–é™æ€æˆå‘˜å˜é‡ï¼š

      * å› ä¸ºå£°æ˜æè¿°äº†å¦‚ä½•åˆ†é…å†…å­˜ï¼Œä½†å¹¶ä¸åˆ†é…å†…å­˜ã€‚
      * å¯¹äºé™æ€ç±»æˆå‘˜ï¼Œå¯ä»¥åœ¨ç±»å£°æ˜ä¹‹å¤–ä½¿ç”¨å•ç‹¬çš„è¯­å¥æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ˜¯å› ä¸ºé™æ€ç±»æˆå‘˜æ˜¯å•ç‹¬å­˜å‚¨çš„ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ã€‚è¯·æ³¨æ„ï¼Œåˆå§‹åŒ–è¯­å¥æŒ‡å‡ºäº†ç±»å‹ï¼Œå¹¶ä½¿ç”¨äº†ä½œç”¨åŸŸè¿ç®—ç¬¦ï¼Œä½†æ²¡æœ‰ä½¿ç”¨å…³é”®å­—staticã€‚
      * åˆå§‹åŒ–æ˜¯åœ¨æ–¹æ³•æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç±»å£°æ˜æ–‡ä»¶ä¸­è¿›è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºç±»å£°æ˜ä½äºå¤´æ–‡ä»¶ä¸­ï¼Œç¨‹åºå¯èƒ½å°†å¤´æ–‡ä»¶åŒ…æ‹¬åœ¨å…¶ä»–å‡ ä¸ªæ–‡ä»¶ä¸­ã€‚å¦‚æœåœ¨å¤´æ–‡ä»¶ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†å‡ºç°å¤šä¸ªåˆå§‹åŒ–è¯­å¥å‰¯æœ¬ï¼Œä»è€Œå¼•å‘é”™è¯¯ã€‚
      * <u>æ³¨æ„ï¼šé™æ€æ•°æ®æˆå‘˜åœ¨ç±»å£°æ˜ä¸­å£°æ˜ï¼Œåœ¨åŒ…å«ç±»æ–¹æ³•çš„æ–‡ä»¶ä¸­åˆå§‹åŒ–ã€‚åˆå§‹åŒ–æ—¶ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥æŒ‡å‡ºé™æ€æˆå‘˜æ‰€å±çš„ç±»ã€‚ä½†å¦‚æœé™æ€æˆå‘˜æ˜¯æ•´å‹æˆ–æšä¸¾å‹ constï¼Œåˆ™å¯ä»¥åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ–</u>

  * ä¸èƒ½å°†ã€std::strcpy(str, s);ã€‘æ”¹æˆã€str = s;ã€‘ï¼Œå› ä¸ºè¿™åªä¿å­˜äº†åœ°å€ï¼Œè€Œæ²¡æœ‰åˆ›å»ºå­—ç¬¦ä¸²å‰¯æœ¬ã€‚

  * ææ„å‡½æ•°ï¼šåˆ é™¤å¯¹è±¡å¯ä»¥é‡Šæ”¾å¯¹è±¡æœ¬èº«å ç”¨çš„å†…å­˜ï¼Œä½†å¹¶ä¸èƒ½è‡ªåŠ¨é‡Šæ”¾å±äºå¯¹è±¡æˆå‘˜çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ã€‚å› æ­¤ï¼Œå¿…é¡»ä½¿ç”¨ææ„å‡½æ•°ã€‚åœ¨ææ„å‡½æ•°ä¸­ä½¿ç”¨ delete è¯­å¥å¯ç¡®ä¿å¯¹è±¡è¿‡æœŸæ—¶ï¼Œç”±æ„é€ å‡½æ•°ä½¿ç”¨ new åˆ†é…çš„å†…å­˜è¢«é‡Šæ”¾ã€‚

    * è­¦å‘Šâ—ã€åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ new æ¥åˆ†é…å†…å­˜æ—¶ï¼Œå¿…é¡»åœ¨ç›¸åº”çš„ææ„å‡½æ•°ä¸­ä½¿ç”¨ delete æ¥é‡Šæ”¾å†…å­˜ã€‚å¦‚æœä½¿ç”¨new[] (åŒ…æ‹¬ä¸­æ‹¬å·)æ¥åˆ†é…å†…å­˜ï¼Œåˆ™åº”ä½¿ç”¨ delete[] (åŒ…æ‹¬ä¸­æ‹¬å·)æ¥é‡Šæ”¾å†…å­˜ã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch12_03_vegnews.cpp -- using new and delete with classes
    // compile with strongbad.cpp
    #include <iostream>
    using std::cout;
    #include "ch12_01_strngbad.h"
    
    void callme1(StringBad&);
    void callme2(StringBad);
    
    int main()
    {
    	using std::endl;
    	{
    		cout << "Starting an inner block.\n";
    		StringBad headline1("Celery Stalks at Midnight");
    		StringBad headline2("Lettuce Prey");
    		StringBad sports("Spinach Leaves Bowl for Dollars");
    
    		cout << "headline1: " << headline1 << endl;
    		cout << "headline2: " << headline2 << endl;
    		cout << "sports: " << sports << endl;
    		
    		callme1(headline1);
    		cout << "headline1: " << headline1 << endl;
    		callme2(headline2);
    		cout << "headline2: " << headline2 << endl;
    		
    		cout << "Initialize one object to another:\n";
    		StringBad sailor = sports;
    		cout << "sailor: " << sailor << endl;
    		cout << "Assign one object to another:\n";
    		StringBad knot;
    		cout << "knot: " << knot << endl;
    		cout << "Exiting the block.\n";
    	}
    	cout << "End of main()\n";
    
    	return 0;
    }
    
    void callme1(StringBad& rsb)
    {
    	cout << "String passed by reference:\n";
    	cout << "    \"" << rsb << "\"\n";
    }
    
    void callme2(StringBad& sb)
    {
    	cout << "String passed by value:\n";
    	cout << "    \"" << sb << "\"\n";
    }
    ```

* ç»“æœï¼š

  * ```c++
    Starting an inner block.
    1: "Celery Stalks at Midnight" object created
    2: "Lettuce Prey" object created
    3: "Spinach Leaves Bowl for Dollars" object created
    headline1: Celery Stalks at Midnight
    headline2: Lettuce Prey
    sports: Spinach Leaves Bowl for Dollars
    String passed by reference:
        "Celery Stalks at Midnight"
    headline1: Celery Stalks at Midnight
    String passed by value:
        "Lettuce Prey"
    "Lettuce Prey" object deleted, 2 left
    headline2: è‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘
    Initialize one object to another:
    sailor: Spinach Leaves Bowl for Dollars
    Assign one object to another:
    3: "C++" default object created
    knot: Celery Stalks at Midnight
    Exiting the block.
    "Celery Stalks at Midnight" object deleted, 2 left
    "Spinach Leaves Bowl for Dollars" object deleted, 1 left
    "è‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘º" object deleted, 0 left
    ```

  * æŠ¥é”™ï¼š
    * æ­£å¸¸ï¼Œä¹¦ä¸­æ˜¯åœ¨æœ«å°¾å¯¹è±¡è®¡æ•°ä¸ºè´Ÿï¼Œæˆ‘ä½¿ç”¨è¾ƒæ–°çš„ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿï¼Œåœ¨æ˜¾ç¤ºæœ‰å…³-1ä¸ªå¯¹è±¡çš„ä¿¡æ¯ä¹‹å‰ç»ˆç«¯ï¼Œå› ä¸ºè¿™æ ·çš„æœºå™¨å°†æŠ¥å‘Šé€šç”¨ä¿æŠ¤é”™è¯¯ï¼ˆGPFï¼‰ã€‚GPFè¡¨æ˜ç¨‹åºè¯•å›¾è®¿é—®ç¦æ­¢å®ƒè®¿é—®çš„å†…å­˜å•å…ƒï¼Œæ˜¯ä¸€ç§ç³Ÿç³•çš„ä¿¡å·ã€‚
   
  * å½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆä¸Šè¿°æ„é€ å‡½æ•°ï¼ˆç§°ä¸ºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒåˆ›å»ºå¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ï¼‰ï¼š
    * ```c++
      StringBad sailor = StringBad(sports);
      ```
    * è‡ªåŠ¨ç”Ÿæˆçš„æ„é€ å‡½æ•°ä¸çŸ¥é“éœ€è¦æ›´æ–°é™æ€å˜é‡ num_stringï¼Œå› æ­¤ä¼šå°†è®¡æ•°æ–¹æ¡ˆæä¹±ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªä¾‹å­è¯´æ˜çš„æ‰€æœ‰é—®é¢˜éƒ½æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜å‡½æ•°å¼•èµ·çš„ï¼Œä¸‹é¢ä»‹ç»è¿™ä¸ªä¸»é¢˜ã€‚å½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆä¸Šè¿°æ„é€ å‡½æ•°ï¼ˆç§°ä¸ºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒåˆ›å»ºå¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ï¼‰ï¼š

#### 12.1.2 ç‰¹æ®Šæˆå‘˜å‡½æ•°

StringBadç±»çš„é—®é¢˜æ˜¯ç”±ç‰¹æ®Šæˆå‘˜å‡½æ•°é€ æˆçš„ã€‚C++è‡ªåŠ¨æä¾›äº†ä¸‹é¢è¿™äº›æˆå‘˜å‡½æ•°ï¼š

* é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°ï¼›
* é»˜è®¤ææ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* èµ‹å€¼è¿ç®—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* åœ°å€è¿ç®—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ã€‚

StringBadç±»ä¸­çš„é—®é¢˜æ˜¯ç”±éšå¼å¤åˆ¶æ„é€ å‡½æ•°å’Œéšå¼èµ‹å€¼è¿ç®—ç¬¦å¼•èµ·çš„ã€‚

1ã€é»˜è®¤æ„é€ å‡½æ•°

* å¦‚æœæ²¡æœ‰æä¾›ä»»ä½•æ„é€ å‡½æ•°ï¼ŒC++å°†åˆ›å»ºé»˜è®¤æ„é€ å‡½æ•°ï¼š

  * ```c++
    Klunk::Klunk() { }
    ```

  * ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨å°†æä¾›ä¸€ä¸ªä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œä¹Ÿä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„æ„é€ å‡½æ•°(é»˜è®¤çš„é»˜è®¤æ„é€ å‡½æ•°)ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºå¯¹è±¡æ—¶æ€»æ˜¯ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼š

    * ```C++
      Klunk lunk;
      ```

* å¦‚æœå®šä¹‰äº†æ„é€ å‡½æ•°ï¼ŒC++å°†ä¸ä¼šå®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚æœå¸Œæœ›åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸æ˜¾å¼åœ°å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™å¿…é¡»æ˜¾å¼åœ°å®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ã€‚è¿™ç§æ„é€ å‡½æ•°æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä½†å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®ç‰¹å®šçš„å€¼ï¼š

  * ```c++
    klunk::klunk()
    {
        klunk_ct = 0;
        ...
    }
    ```

  * å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼Œåªè¦æ‰€æœ‰å‚æ•°éƒ½æœ‰é»˜è®¤å€¼:

    * ```c++
      Klunk(int n = 0) { klunk_ct = n; }
      ```

  * ä½†åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼Œè§P433

2ã€å¤åˆ¶æ„é€ å‡½æ•°

* å¤åˆ¶æ„é€ å‡½æ•°ç”¨äºå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç”¨äºåˆå§‹åŒ–è¿‡ç¨‹ä¸­(åŒ…æ‹¬æŒ‰å€¼ä¼ é€’å‚æ•°)ï¼Œè€Œä¸æ˜¯å¸¸è§„çš„èµ‹å€¼è¿‡ç¨‹ä¸­ã€‚ç±»çš„å¤åˆ¶æ„é€ å‡½æ•°åŸå‹é€šå¸¸å¦‚ä¸‹ï¼š

  * ```c++
    Class_name(const Class_name &);
    ```

  * å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ç±»å¯¹è±¡çš„å¸¸é‡å¼•ç”¨ä½œä¸ºå‚æ•°ï¼›

  * å¯¹äºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œéœ€è¦çŸ¥é“ä¸¤ç‚¹ï¼š

    * ä½•æ—¶è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°

      * æ–°å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶åˆå§‹åŒ–ä¸ºåŒç±»ç°æœ‰å¯¹è±¡æ—¶ï¼Œå¤åˆ¶æ„é€ å‡½æ•°éƒ½å°†è¢«è°ƒç”¨ã€‚è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¯èƒ½å‘ç”Ÿï¼Œæœ€å¸¸è§çš„æƒ…å†µæ˜¯å°†æ–°å¯¹è±¡æ˜¾å¼åœ°åˆå§‹åŒ–ä¸ºç°æœ‰çš„å¯¹è±¡ã€‚
      * æ¯å½“ç¨‹åºç”Ÿæˆäº†å¯¹è±¡å‰¯æœ¬æ—¶ï¼Œç¼–è¯‘å™¨éƒ½å°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚
        * å…·ä½“åœ°è¯´ï¼Œå½“å‡½æ•°æŒ‰å€¼ä¼ é€’å¯¹è±¡æˆ–å‡½æ•°è¿”å›å¯¹è±¡æ—¶ï¼Œéƒ½å°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚
        * ç”±äºæŒ‰å€¼ä¼ é€’å¯¹è±¡å°†è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› æ­¤åº”è¯¥æŒ‰å¼•ç”¨ä¼ é€’å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥èŠ‚çœè°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶é—´ä»¥åŠå­˜å‚¨æ–°å¯¹è±¡çš„ç©ºé—´ã€‚

    * é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°çš„åŠŸèƒ½

      * é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°é€ä¸ªå¤åˆ¶éé™æ€æˆå‘˜(æˆå‘˜å¤åˆ¶ä¹Ÿç§°ä¸ºæµ…å¤åˆ¶)ï¼Œå¤åˆ¶çš„æ˜¯æˆå‘˜çš„å€¼ï¼š

        * ```c++
          StringBad sailor = sports;
          // ä¸ä¸‹é¢ä»£ç ç­‰æ•ˆï¼š
          StringBad sailor;
          sailor.str = sports.str;
          sailor.len = sports.len;
          ```

      * å¦‚æœæˆå‘˜æœ¬èº«å°±æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™å°†ä½¿ç”¨è¿™ä¸ªç±»çš„å¤åˆ¶æ„é€ å‡½æ•°æ¥å¤åˆ¶æˆå‘˜å¯¹è±¡ã€‚é™æ€å‡½æ•°(å¦‚ num_strings )ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒä»¬å±äºæ•´ä¸ªç±»ï¼Œè€Œä¸æ˜¯å„ä¸ªå¯¹è±¡ã€‚å›¾ 12.2 è¯´æ˜äº†éšå¼å¤åˆ¶æ„é€ å‡½æ•°æ‰§è¡Œçš„æ“ä½œã€‚

        * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/c77de957-0bd3-4a03-8c11-634279641fa7)

#### 12.1.3 å›åˆ° StringBadï¼šå¤åˆ¶æ„é€ å‡½æ•°çš„å“ªé‡Œå‡ºäº†é—®é¢˜

ç¨‹åºæ¸…å•12.3ä¸¤ä¸ªå¼‚å¸¸ä¹‹å¤„ï¼š

ï¼ˆ1ï¼‰ç¨‹åºè¾“å‡ºè¡¨æ˜ï¼Œææ„å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°æ¯”æ„é€ å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°å¤š2ï¼ŒåŸå› å¯èƒ½æ˜¯ç¨‹åºç¡®å®ä½¿ç”¨é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°å¦å¤–åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚

* è§£å†³åŠæ³•ï¼šæä¾›ä¸€ä¸ªå¯¹è®¡æ•°è¿›è¡Œæ›´æ–°çš„æ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°ï¼š

  * ```C++
    StringBad::StringBad(const String & s)
    {
        num_strings++;
        ...
    }
    ```

  * â—å¦‚æœç±»ä¸­åŒ…å«è¿™æ ·çš„**é™æ€æ•°æ®æˆå‘˜**ï¼Œå³å…¶å€¼å°†åœ¨æ–°å¯¹è±¡è¢«åˆ›å»ºæ—¶å‘ç”Ÿå˜åŒ–ï¼Œåˆ™åº”è¯¥æä¾›ä¸€ä¸ª**æ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°**æ¥å¤„ç†è®¡æ•°é—®é¢˜ã€‚

ï¼ˆ2ï¼‰å­—ç¬¦ä¸²å†…å®¹å‡ºç°ä¹±ç ï¼š

* åŸå› åœ¨äºéšå¼å¤åˆ¶æ„é€ å‡½æ•°æ˜¯æŒ‰å€¼è¿›è¡Œå¤åˆ¶çš„ã€‚

  * ```c++
    sailor.str = sport.str;
    ```

  * è¿™é‡Œå¤åˆ¶çš„å¹¶ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚å½“ææ„å‡½æ•°è¢«è°ƒç”¨æ˜¯ï¼Œææ„å‡½æ•°é‡Šæ”¾å¤åˆ¶ç±»åæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ï¼Œä½†æ˜¯æŒ‡å‘çš„å†…å­˜ä¹‹å‰å·²ç»è¢«æœ¬ä½“çš„ææ„å‡½æ•°é‡Šæ”¾äº†ï¼Œè¿™å°†å¯¼è‡´ä¸ç¡®å®šçš„ã€å¯èƒ½æœ‰å®³çš„åæœã€‚

ï¼ˆ3ï¼‰å®šä¹‰ä¸€ä¸ªæ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°ä»¥è§£å†³é—®é¢˜ï¼š

* æ·±åº¦å¤åˆ¶ï¼šå¤åˆ¶æ„é€ å‡½æ•°åº”å½“å¤åˆ¶å­—ç¬¦ä¸²å¹¶å°†å‰¯æœ¬çš„åœ°å€èµ‹ç»™stræˆå‘˜ï¼Œè€Œä¸ä»…ä»…æ˜¯å¤åˆ¶å­—ç¬¦ä¸²åœ°å€ã€‚

  * è¿™æ ·æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚

  * è°ƒç”¨ææ„å‡½æ•°æ—¶éƒ½å°†é‡Šæ”¾ä¸åŒçš„å­—ç¬¦ä¸²ï¼Œè€Œä¸ä¼šè¯•å›¾å»é‡Šæ”¾å·²ç»è¢«é‡Šæ”¾çš„å­—ç¬¦ä¸²ã€‚

  * å¯ä»¥è¿™æ ·ç¼–å†™Stringçš„å¤åˆ¶æ„é€ å‡½æ•°ï¼š

    * ```c++
      StringBad::StringBad(const StringBad & st)
      {
          num_strings++;
          len = st.len;
          str = new char[len + 1];
          std::strcpy(str, st.str);
          cout << num_strings << ": \" << str <<"\" object created\n";
      }
      ```

  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/7d300f0f-c9e7-4050-8f4f-906829b70fa4)

  * å¦‚æœç±»ä¸­åŒ…å«äº†ä½¿ç”¨newåˆå§‹åŒ–çš„æŒ‡é’ˆæˆå‘˜ï¼Œåº”å½“å®šä¹‰ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ï¼Œä»¥å¤åˆ¶æŒ‡å‘çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆï¼Œè¿™è¢«ç§°ä¸ºæ·±åº¦å¤åˆ¶ã€‚

#### 12.1.4 StringBad çš„å…¶ä»–é—®é¢˜ï¼šèµ‹å€¼è¿ç®—ç¬¦

C++å…è®¸ç±»å¯¹è±¡èµ‹å€¼ï¼Œè¿™æ˜¯é€šè¿‡è‡ªåŠ¨ä¸ºç±»é‡è½½èµ‹å€¼è¿ç®—ç¬¦å®ç°çš„ï¼š

* ```c++
  Class_name & Class_name::operator=(const Class_name &);
  ```

* å®ƒæ¥å—å¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚

ï¼ˆ1ï¼‰èµ‹å€¼è¿ç®—ç¬¦çš„åŠŸèƒ½ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒ

* å°†å·²æœ‰çš„å¯¹è±¡èµ‹ç»™å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†ä½¿ç”¨é‡è½½çš„èµ‹å€¼è¿ç®—ç¬¦ï¼›
* åˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¸€å®šä¼šä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ã€‚
* ä¸å¤åˆ¶æ„é€ å‡½æ•°ç›¸ä¼¼ï¼Œèµ‹å€¼è¿ç®—ç¬¦çš„éšå¼å®ç°ä¹Ÿå¯¹æˆå‘˜è¿›è¡Œé€ä¸ªå¤åˆ¶ã€‚å¦‚æœæˆå‘˜æœ¬èº«å°±æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™ç¨‹åºå°†ä½¿ç”¨ä¸ºè¿™ä¸ªç±»å®šä¹‰çš„èµ‹å€¼è¿ç®—ç¬¦æ¥å¤åˆ¶è¯¥æˆå‘˜ï¼Œä½†é™æ€æ•°æ®æˆå‘˜ä¸å—å½±å“ã€‚

ï¼ˆ2ï¼‰èµ‹å€¼çš„é—®é¢˜å‡ºåœ¨å“ªé‡Œ

* å‡ºç°çš„é—®é¢˜ä¸éšå¼å¤åˆ¶æ„é€ å‡½æ•°ç›¸åŒï¼šæ•°æ®å—æŸã€‚

ï¼ˆ3ï¼‰è§£å†³èµ‹å€¼çš„é—®é¢˜

* æä¾›èµ‹å€¼è¿ç®—ç¬¦ï¼ˆè¿›è¡Œæ·±åº¦å¤åˆ¶ï¼‰çš„å®šä¹‰ï¼Œå…¶å®ç°ä¸å¤åˆ¶æ„é€ å‡½æ•°ç›¸ä¼¼ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›å·®åˆ«ï¼š

  * ç”±äºç›®æ ‡å¯¹è±¡å¯èƒ½å¼•ç”¨äº†ä»¥å‰åˆ†é…çš„æ•°æ®ï¼Œæ‰€ä»¥å‡½æ•°åº”ä½¿ç”¨ delete[ ]æ¥é‡Šæ”¾è¿™äº›æ•°æ®ã€‚
  * å‡½æ•°åº”å½“é¿å…å°†å¯¹è±¡èµ‹ç»™è‡ªèº«ï¼›å¦åˆ™ï¼Œç»™å¯¹è±¡é‡æ–°èµ‹å€¼å‰ï¼Œé‡Šæ”¾å†…å­˜æ“ä½œå¯èƒ½åˆ é™¤å¯¹è±¡çš„å†…å®¹ã€‚
  * å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘è°ƒç”¨å¯¹è±¡çš„å¼•ç”¨ã€‚

* ```c++
  StringBad & StringBad::operator=(const StringBad & st)
  {
      if(this == &st)
          return *this;
      delete [] str;
      len = st.len;
      str = new char [len + 1];
      std::strcpy(str, st.str);
      return *this;
  }
  ```

* èµ‹å€¼æ“ä½œå¹¶ä¸åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå› æ­¤ä¸éœ€è¦è°ƒæ•´é™æ€æ•°æ®æˆå‘˜num_stringsçš„å€¼ã€‚



### 12.2 æ”¹è¿›åçš„æ–° String ç±»

ï¼ˆ1ï¼‰æ·»åŠ **å¤åˆ¶æ„é€ å‡½æ•°**å’Œ**èµ‹å€¼è¿ç®—ç¬¦**ï¼Œä½¿ç±»èƒ½å¤Ÿæ­£ç¡®ç®¡ç†ç±»å¯¹è±¡ä½¿ç”¨çš„å†…å­˜ã€‚

ï¼ˆ2ï¼‰æ ¹æ®å¯¹è±¡ä½•æ—¶è¢«åˆ›å»ºå’Œé‡Šæ”¾ï¼Œå¯ä»¥è®©æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¿æŒæ²‰é»˜ï¼Œä¸å†åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶éƒ½æ˜¾ç¤ºæ¶ˆæ¯ã€‚

ï¼ˆ3ï¼‰ä¸ç”¨å†ç›‘è§†æ„é€ å‡½æ•°çš„å·¥ä½œæƒ…å†µï¼Œå› æ­¤å¯ä»¥ç®€åŒ–é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ä¹‹åˆ›å»ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯"C++"ã€‚

#### 12.2.1 ä¿®è®¢åçš„é»˜è®¤æ„é€ å‡½æ•°

* ```c++
  String::String()
  {
      len = 0;
      str = new char[1];//ä¸ç±»ææ„å‡½æ•°å…¼å®¹ï¼Œè€Œåè€…ä¸å…¼å®¹ï¼Œè§P438
      str[0] = '\0';
  }
  ```

* C++ç©ºæŒ‡é’ˆï¼Œå…³é”®å­—nullptrï¼Œå‡¯å—P438

  * ```c++
    str = nullpter;
    ```

#### 12.2.2 æ¯”è¾ƒæˆå‘˜å‡½æ•°

* æ‰§è¡Œæ¯”è¾ƒæ“ä½œçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š<ã€>å’Œ==ï¼Œå®ç°å­—ç¬¦ä¸²åœ¨å‰åœ¨åçš„æ¯”è¾ƒï¼š

  * ```c++
    bool operator<(const String &st1, const String &st2)
    {
        return(std::strcmp(st1.str, st2.str) < 0);
    }
    ```

  * å¦å¤–ä¸¤ä¸ªå¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼æ¥ç¼–å†™ã€‚

#### 12.2.3 ä½¿ç”¨ä¸­æ‹¬å·è¡¨ç¤ºæ³•è®¿é—®å­—ç¬¦

* åœ¨C++ä¸­ï¼Œä¸¤ä¸ªä¸­æ‹¬å·ç»„æˆä¸€ä¸ªè¿ç®—ç¬¦â€”â€”ä¸­æ‹¬å·è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•operator[ ] ( )æ¥é‡è½½è¯¥è¿ç®—ç¬¦ã€‚

  * é€šå¸¸ï¼ŒäºŒå…ƒC++è¿ç®—ç¬¦ï¼ˆå¸¦ä¸¤ä¸ªæ“ä½œæ•°ï¼‰ä½äºä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´ï¼Œä¾‹å¦‚2+5ã€‚ä½†å¯¹äºä¸­æ‹¬å·è¿ç®—ç¬¦ï¼Œä¸€ä¸ªæ“ä½œæ•°ä½äºç¬¬ä¸€ä¸ªä¸­æ‹¬å·çš„å‰é¢ï¼Œä¸¤ä¸€ä¸ªä½äºä¸¤ä¸ªä¸­æ‹¬å·ä¹‹é—´ã€‚
  * å› æ­¤åœ¨è¡¨è¾¾å¼city[0]ä¸­ï¼Œcityæ˜¯ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼Œ[]æ˜¯è¿ç®—ç¬¦ï¼Œ0æ˜¯ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼š

* å…¬æœ‰æ–¹æ³•å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®ï¼Œå¹¶ç»™ç‰¹å®šçš„å…ƒç´ èµ‹å€¼ï¼š

  * ```c++
    char & String::operator [] (int i)
    {
        return str[i];
    }
    ```

  * è¿”å›å€¼æ˜¯xxx.str[4]ã€‚å› æ­¤å…¬æœ‰æ–¹æ³•å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®ã€‚

  * å°†è¿”å›ç±»å‹å£°æ˜ä¸ºchar &ï¼Œä¾¿å¯ä»¥ç»™ç‰¹å®šçš„å…ƒç´ èµ‹å€¼ï¼š

    * ```c++
      String means("might");
      means[0] = 'r';
      ```

* å¯¹äºå¸¸é‡å¯¹è±¡ï¼Œä¸Šè¿°æ–¹æ³•å°†å‡ºé”™ã€‚å› ä¸ºåœ¨é‡è½½æ—¶C++å°†åŒºåˆ†å¸¸é‡å’Œéå¸¸é‡å‡½æ•°çš„ç‰¹å¾æ ‡ï¼Œå› æ­¤å¯ä»¥æä¾›å¦ä¸€ä¸ªä»…ä¾›const Stringå¯¹è±¡ä½¿ç”¨çš„operator[ ] ( )ç‰ˆæœ¬ï¼š

  * ```c++
    const char & String::operator [] (int i) const
    {
        return str[i];
    }
    ```

#### 12.2.4 é™æ€ç±»æˆå‘˜å‡½æ•°

* å¯ä»¥å°†æˆå‘˜å‡½æ•°å£°æ˜ä¸ºé™æ€çš„åæœï¼š

  * 1ã€ä¸èƒ½é€šè¿‡å¯¹è±¡è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ï¼Œç”šè‡³ä¸èƒ½ä½¿ç”¨thisæŒ‡é’ˆã€‚

    * å¦‚æœé™æ€æˆå‘˜å‡½æ•°æ˜¯åœ¨å…¬æœ‰éƒ¨åˆ†å£°æ˜çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç±»åå’Œä½œç”¨åŸŸè§£æè¿ç®—ç¬¦æ¥è°ƒç”¨å®ƒï¼š

      * ```C++
        static int HowMany() {return num_strings;}
        int count = String::HowMany;
        ```

  * 2ã€ç”±äºé™æ€æˆå‘˜å‡½æ•°ä¸ä¸ç‰¹å®šçš„å¯¹è±¡ç›¸å…³è”ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨é™æ€æ•°æ®æˆå‘˜ã€‚

    * ä¾‹å¦‚é™æ€æ–¹æ³•HowMany()å¯ä»¥è®¿é—®é™æ€æˆå‘˜ num_stringï¼Œä½†ä¸èƒ½è®¿é—®strå’Œlenã€‚

#### 12.2.5 è¿›ä¸€æ­¥é‡è½½èµ‹å€¼è¿ç®—ç¬¦

* å°†å¸¸è§„å­—ç¬¦ä¸²å¤åˆ¶åˆ°Stringå¯¹è±¡ä¸­ï¼Œå¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œè§P439ã€‚ä¸ºäº†æé«˜å¤„ç†æ•ˆç‡ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼Œä½¿ä¹‹èƒ½å¤Ÿç›´æ¥ä½¿ç”¨å¸¸è§„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶å¯¹è±¡äº†ã€‚

  * ```c++
    String & String::operator=(const char * s)
    {
        delete [] str;
        len = std::strlens(s);
        str = new char[len + 1];
        std::strcpy(str, s);
        return *this;
    }
    ```

  * ä¸€èˆ¬æ¥è¯´å¿…é¡»é‡Šæ”¾stræŒ‡å‘çš„å†…å­˜ï¼Œå¹¶ä¸ºæ–°å­—ç¬¦ä¸²åˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚

#### 12.2.6 ç¨‹åºæ¸…å•

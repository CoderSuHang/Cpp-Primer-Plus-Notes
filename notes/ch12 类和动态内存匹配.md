## ç¬¬åäºŒç«  ç±»å’ŒåŠ¨æ€å†…å­˜åŒ¹é…

åœ¨ç±»æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newè¿ç®—ç¬¦åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ†é…æ‰€éœ€çš„å†…å­˜ã€‚ä¸ºæ­¤ï¼Œé€šå¸¸çš„æ–¹æ³•æ˜¯ä½¿ç”¨ string ç±»ï¼Œå®ƒå°†ä¸ºæ‚¨å¤„ç†å†…å­˜ç®¡ç†ç»†èŠ‚ã€‚

### 12.1 åŠ¨æ€å†…å­˜å’Œç±»

C++ä½¿ç”¨ new å’Œ delete è¿ç®—ç¬¦æ¥åŠ¨æ€æ§åˆ¶å†…å­˜ã€‚ä½†æ˜¯åœ¨ç±»ä¸­ä½¿ç”¨è¿™äº›è¿ç®—ç¬¦å°†å¯¼è‡´è®¸å¤šæ–°çš„ç¼–ç¨‹é—®é¢˜ã€‚å› æ­¤ï¼Œææ„å‡½æ•°å°†æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè€Œä¸å†æ˜¯å¯æœ‰å¯æ— ã€‚

æ‰©å±•ææ„å‡½æ•°ã€ä½¿æ‰€æœ‰çš„æ„é€ å‡½æ•°ä¸ new ææ„å‡½æ•°åè°ƒä¸€è‡´ã€ç¼–å†™é¢å¤–çš„ç±»æ–¹æ³•æ¥å¸®åŠ©æ­£ç¡®å®Œæˆåˆå§‹åŒ–å’Œå¤åˆ¶ã€‚

#### 12.1.1 å¤ä¹ ç¤ºä¾‹å’Œé™æ€ç±»æˆå‘˜

ï¼ˆ1ï¼‰é™æ€ç±»æˆå‘˜ã€æ–°çš„å­˜å‚¨ç±»å‹ã€‘

* ç¤ºä¾‹ï¼š

  * ```c++
    #pragma once
    // ch12_01_strngbad.h -- flawed string class definition
    #include <iostream>
    #ifndef CH12_01_STRNGBAD_H_
    #define CH12_01_STRNGBAD_H_
    
    class StringBad
    {
    private:
    	char* str;
    	int len;
    	static int num_strings;
    public:
    	StringBad(const char* s);
    	StringBad();
    	~StringBad();
    // friend function
    	friend std::ostream& operator<<(std::ostream& os, const StringBad& st);
    };
    #endif
    ```

  * å¯¹è¿™ä¸ªå£°æ˜ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ä¸¤ç‚¹ï¼š

    * é¦–å…ˆï¼Œå®ƒä½¿ç”¨ char æŒ‡é’ˆ(è€Œä¸æ˜¯ char æ•°ç»„)æ¥è¡¨ç¤ºå§“åã€‚è¿™æ„å‘³ç€ç±»å£°æ˜æ²¡æœ‰ä¸ºå­—ç¬¦ä¸²æœ¬èº«åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€Œæ˜¯åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ new æ¥ä¸ºå­—ç¬¦åˆ†é…ç©ºé—´ã€‚è¿™é¿å…äº†åœ¨ç±»å£°æ˜ä¸­é¢„å…ˆå®šä¹‰å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚
    * å…¶æ¬¡ï¼Œå°† num_strings æˆå‘˜å£°æ˜ä¸ºé™æ€å­˜å‚¨ç±»ã€‚
      * é™æ€ç±»æˆå‘˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šæ— è®ºåˆ›å»ºäº†å¤šå°‘å¯¹è±¡ï¼Œç¨‹åºéƒ½åªåˆ›å»ºä¸€ä¸ªé™æ€ç±»å˜é‡å‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»çš„æ‰€æœ‰å¯¹è±¡å…±äº«åŒä¸€ä¸ªé™æ€æˆå‘˜ï¼Œå°±åƒå®¶ä¸­çš„ç”µè¯å¯ä¾›å…¨ä½“å®¶åº­æˆå‘˜å…±äº«ä¸€æ ·ã€‚å‡è®¾åˆ›å»ºäº†10ä¸ªStringBad å¯¹è±¡ï¼Œå°†æœ‰10ä¸ª str æˆå‘˜å’Œ10ä¸ª len æˆå‘˜ä½†åªæœ‰ä¸€ä¸ªå…±äº«çš„num_stringsæˆå‘˜(å‚è§å›¾ 12.1)è¿™å¯¹äºæ‰€æœ‰ç±»å¯¹éƒ½å…·æœ‰ç›¸åŒå€¼çš„ç±»ç§æœ‰æ•°æ®æ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚ä¾‹å¦‚numstringsæˆå‘˜å¯ä»¥è®°å½•æ‰€åˆ›å»ºçš„å¯¹è±¡æ•°ç›®ã€‚
      ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/1bc29af5-e530-45a0-b8c2-7b72c629ba0a)

* ç¤ºä¾‹ï¼šç±»æ–¹æ³•æ–‡ä»¶

  * ```c++
    // ch12_02_strngbad.cpp -- StringBad class methods
    #include <cstring>
    #include "ch12_01_strngbad.h"
    using std::cout;
    
    // initializing static class member
    int StringBad::num_strings = 0;
    
    // class methods
    // construct StringBad from C string
    StringBad::StringBad(const char* s)
    {
    	len = std::strlen(s);
    	str = new char[len + 1];
    	std::strcpy(str, s);
    	num_strings++;
    	cout << num_strings << ": \"" << str
    		<< "\" object created\n";
    }
    
    StringBad::StringBad()
    {
    	len = 4;
    	str = new char[4];
    	std::strcpy(str, "C++");
    	num_strings++;
    	cout << num_strings << ": \"" << str
    		<< "\" default object created\n";
    }
    
    StringBad::~StringBad()
    {
    	cout << "\"" << str << "\" object deleted, ";
    	--num_strings;
    	cout << num_strings << " left\n";
    	delete[] str;
    }
    
    std::ostream& operator <<(std::ostream& os, const StringBad& st)
    {
    	os << st.str;
    	return os;
    }
    ```

  * é™æ€æˆå‘˜num_stringsçš„å€¼åˆå§‹åŒ–ä¸ºé›¶ï¼š

    * ```c++
      int StringBad::num_strings = 0;
      ```

    * ğŸ“Œæ³¨æ„ï¼ä¸èƒ½åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ–é™æ€æˆå‘˜å˜é‡ï¼š

      * å› ä¸ºå£°æ˜æè¿°äº†å¦‚ä½•åˆ†é…å†…å­˜ï¼Œä½†å¹¶ä¸åˆ†é…å†…å­˜ã€‚
      * å¯¹äºé™æ€ç±»æˆå‘˜ï¼Œå¯ä»¥åœ¨ç±»å£°æ˜ä¹‹å¤–ä½¿ç”¨å•ç‹¬çš„è¯­å¥æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ˜¯å› ä¸ºé™æ€ç±»æˆå‘˜æ˜¯å•ç‹¬å­˜å‚¨çš„ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„ç»„æˆéƒ¨åˆ†ã€‚è¯·æ³¨æ„ï¼Œåˆå§‹åŒ–è¯­å¥æŒ‡å‡ºäº†ç±»å‹ï¼Œå¹¶ä½¿ç”¨äº†ä½œç”¨åŸŸè¿ç®—ç¬¦ï¼Œä½†æ²¡æœ‰ä½¿ç”¨å…³é”®å­—staticã€‚
      * åˆå§‹åŒ–æ˜¯åœ¨æ–¹æ³•æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ç±»å£°æ˜æ–‡ä»¶ä¸­è¿›è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºç±»å£°æ˜ä½äºå¤´æ–‡ä»¶ä¸­ï¼Œç¨‹åºå¯èƒ½å°†å¤´æ–‡ä»¶åŒ…æ‹¬åœ¨å…¶ä»–å‡ ä¸ªæ–‡ä»¶ä¸­ã€‚å¦‚æœåœ¨å¤´æ–‡ä»¶ä¸­è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†å‡ºç°å¤šä¸ªåˆå§‹åŒ–è¯­å¥å‰¯æœ¬ï¼Œä»è€Œå¼•å‘é”™è¯¯ã€‚
      * <u>æ³¨æ„ï¼šé™æ€æ•°æ®æˆå‘˜åœ¨ç±»å£°æ˜ä¸­å£°æ˜ï¼Œåœ¨åŒ…å«ç±»æ–¹æ³•çš„æ–‡ä»¶ä¸­åˆå§‹åŒ–ã€‚åˆå§‹åŒ–æ—¶ä½¿ç”¨ä½œç”¨åŸŸè¿ç®—ç¬¦æ¥æŒ‡å‡ºé™æ€æˆå‘˜æ‰€å±çš„ç±»ã€‚ä½†å¦‚æœé™æ€æˆå‘˜æ˜¯æ•´å‹æˆ–æšä¸¾å‹ constï¼Œåˆ™å¯ä»¥åœ¨ç±»å£°æ˜ä¸­åˆå§‹åŒ–</u>

  * ä¸èƒ½å°†ã€std::strcpy(str, s);ã€‘æ”¹æˆã€str = s;ã€‘ï¼Œå› ä¸ºè¿™åªä¿å­˜äº†åœ°å€ï¼Œè€Œæ²¡æœ‰åˆ›å»ºå­—ç¬¦ä¸²å‰¯æœ¬ã€‚

  * ææ„å‡½æ•°ï¼šåˆ é™¤å¯¹è±¡å¯ä»¥é‡Šæ”¾å¯¹è±¡æœ¬èº«å ç”¨çš„å†…å­˜ï¼Œä½†å¹¶ä¸èƒ½è‡ªåŠ¨é‡Šæ”¾å±äºå¯¹è±¡æˆå‘˜çš„æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ã€‚å› æ­¤ï¼Œå¿…é¡»ä½¿ç”¨ææ„å‡½æ•°ã€‚åœ¨ææ„å‡½æ•°ä¸­ä½¿ç”¨ delete è¯­å¥å¯ç¡®ä¿å¯¹è±¡è¿‡æœŸæ—¶ï¼Œç”±æ„é€ å‡½æ•°ä½¿ç”¨ new åˆ†é…çš„å†…å­˜è¢«é‡Šæ”¾ã€‚

    * è­¦å‘Šâ—ã€åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ new æ¥åˆ†é…å†…å­˜æ—¶ï¼Œå¿…é¡»åœ¨ç›¸åº”çš„ææ„å‡½æ•°ä¸­ä½¿ç”¨ delete æ¥é‡Šæ”¾å†…å­˜ã€‚å¦‚æœä½¿ç”¨new[] (åŒ…æ‹¬ä¸­æ‹¬å·)æ¥åˆ†é…å†…å­˜ï¼Œåˆ™åº”ä½¿ç”¨ delete[] (åŒ…æ‹¬ä¸­æ‹¬å·)æ¥é‡Šæ”¾å†…å­˜ã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch12_03_vegnews.cpp -- using new and delete with classes
    // compile with strongbad.cpp
    #include <iostream>
    using std::cout;
    #include "ch12_01_strngbad.h"
    
    void callme1(StringBad&);
    void callme2(StringBad);
    
    int main()
    {
    	using std::endl;
    	{
    		cout << "Starting an inner block.\n";
    		StringBad headline1("Celery Stalks at Midnight");
    		StringBad headline2("Lettuce Prey");
    		StringBad sports("Spinach Leaves Bowl for Dollars");
    
    		cout << "headline1: " << headline1 << endl;
    		cout << "headline2: " << headline2 << endl;
    		cout << "sports: " << sports << endl;
    		
    		callme1(headline1);
    		cout << "headline1: " << headline1 << endl;
    		callme2(headline2);
    		cout << "headline2: " << headline2 << endl;
    		
    		cout << "Initialize one object to another:\n";
    		StringBad sailor = sports;
    		cout << "sailor: " << sailor << endl;
    		cout << "Assign one object to another:\n";
    		StringBad knot;
    		cout << "knot: " << knot << endl;
    		cout << "Exiting the block.\n";
    	}
    	cout << "End of main()\n";
    
    	return 0;
    }
    
    void callme1(StringBad& rsb)
    {
    	cout << "String passed by reference:\n";
    	cout << "    \"" << rsb << "\"\n";
    }
    
    void callme2(StringBad& sb)
    {
    	cout << "String passed by value:\n";
    	cout << "    \"" << sb << "\"\n";
    }
    ```

* ç»“æœï¼š

  * ```c++
    Starting an inner block.
    1: "Celery Stalks at Midnight" object created
    2: "Lettuce Prey" object created
    3: "Spinach Leaves Bowl for Dollars" object created
    headline1: Celery Stalks at Midnight
    headline2: Lettuce Prey
    sports: Spinach Leaves Bowl for Dollars
    String passed by reference:
        "Celery Stalks at Midnight"
    headline1: Celery Stalks at Midnight
    String passed by value:
        "Lettuce Prey"
    "Lettuce Prey" object deleted, 2 left
    headline2: è‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘
    Initialize one object to another:
    sailor: Spinach Leaves Bowl for Dollars
    Assign one object to another:
    3: "C++" default object created
    knot: Celery Stalks at Midnight
    Exiting the block.
    "Celery Stalks at Midnight" object deleted, 2 left
    "Spinach Leaves Bowl for Dollars" object deleted, 1 left
    "è‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘ºè‘º" object deleted, 0 left
    ```

  * æŠ¥é”™ï¼š
    * æ­£å¸¸ï¼Œä¹¦ä¸­æ˜¯åœ¨æœ«å°¾å¯¹è±¡è®¡æ•°ä¸ºè´Ÿï¼Œæˆ‘ä½¿ç”¨è¾ƒæ–°çš„ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿï¼Œåœ¨æ˜¾ç¤ºæœ‰å…³-1ä¸ªå¯¹è±¡çš„ä¿¡æ¯ä¹‹å‰ç»ˆç«¯ï¼Œå› ä¸ºè¿™æ ·çš„æœºå™¨å°†æŠ¥å‘Šé€šç”¨ä¿æŠ¤é”™è¯¯ï¼ˆGPFï¼‰ã€‚GPFè¡¨æ˜ç¨‹åºè¯•å›¾è®¿é—®ç¦æ­¢å®ƒè®¿é—®çš„å†…å­˜å•å…ƒï¼Œæ˜¯ä¸€ç§ç³Ÿç³•çš„ä¿¡å·ã€‚
   
  * å½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆä¸Šè¿°æ„é€ å‡½æ•°ï¼ˆç§°ä¸ºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒåˆ›å»ºå¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ï¼‰ï¼š
    * ```c++
      StringBad sailor = StringBad(sports);
      ```
    * è‡ªåŠ¨ç”Ÿæˆçš„æ„é€ å‡½æ•°ä¸çŸ¥é“éœ€è¦æ›´æ–°é™æ€å˜é‡ num_stringï¼Œå› æ­¤ä¼šå°†è®¡æ•°æ–¹æ¡ˆæä¹±ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªä¾‹å­è¯´æ˜çš„æ‰€æœ‰é—®é¢˜éƒ½æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜å‡½æ•°å¼•èµ·çš„ï¼Œä¸‹é¢ä»‹ç»è¿™ä¸ªä¸»é¢˜ã€‚å½“ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ¥åˆå§‹åŒ–å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨å°†è‡ªåŠ¨ç”Ÿæˆä¸Šè¿°æ„é€ å‡½æ•°ï¼ˆç§°ä¸ºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒåˆ›å»ºå¯¹è±¡çš„ä¸€ä¸ªå‰¯æœ¬ï¼‰ï¼š

#### 12.1.2 ç‰¹æ®Šæˆå‘˜å‡½æ•°

StringBadç±»çš„é—®é¢˜æ˜¯ç”±ç‰¹æ®Šæˆå‘˜å‡½æ•°é€ æˆçš„ã€‚C++è‡ªåŠ¨æä¾›äº†ä¸‹é¢è¿™äº›æˆå‘˜å‡½æ•°ï¼š

* é»˜è®¤æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰æ„é€ å‡½æ•°ï¼›
* é»˜è®¤ææ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* èµ‹å€¼è¿ç®—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼›
* åœ°å€è¿ç®—ç¬¦ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ã€‚

StringBadç±»ä¸­çš„é—®é¢˜æ˜¯ç”±éšå¼å¤åˆ¶æ„é€ å‡½æ•°å’Œéšå¼èµ‹å€¼è¿ç®—ç¬¦å¼•èµ·çš„ã€‚

1ã€é»˜è®¤æ„é€ å‡½æ•°

* å¦‚æœæ²¡æœ‰æä¾›ä»»ä½•æ„é€ å‡½æ•°ï¼ŒC++å°†åˆ›å»ºé»˜è®¤æ„é€ å‡½æ•°ï¼š

  * ```c++
    Klunk::Klunk() { }
    ```

  * ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨å°†æä¾›ä¸€ä¸ªä¸æ¥å—ä»»ä½•å‚æ•°ï¼Œä¹Ÿä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„æ„é€ å‡½æ•°(é»˜è®¤çš„é»˜è®¤æ„é€ å‡½æ•°)ï¼Œè¿™æ˜¯å› ä¸ºåˆ›å»ºå¯¹è±¡æ—¶æ€»æ˜¯ä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼š

    * ```C++
      Klunk lunk;
      ```

* å¦‚æœå®šä¹‰äº†æ„é€ å‡½æ•°ï¼ŒC++å°†ä¸ä¼šå®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ã€‚å¦‚æœå¸Œæœ›åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä¸æ˜¾å¼åœ°å¯¹å®ƒè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™å¿…é¡»æ˜¾å¼åœ°å®šä¹‰é»˜è®¤æ„é€ å‡½æ•°ã€‚è¿™ç§æ„é€ å‡½æ•°æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œä½†å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®ç‰¹å®šçš„å€¼ï¼š

  * ```c++
    klunk::klunk()
    {
        klunk_ct = 0;
        ...
    }
    ```

  * å¸¦å‚æ•°çš„æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥æ˜¯é»˜è®¤æ„é€ å‡½æ•°ï¼Œåªè¦æ‰€æœ‰å‚æ•°éƒ½æœ‰é»˜è®¤å€¼:

    * ```c++
      Klunk(int n = 0) { klunk_ct = n; }
      ```

  * ä½†åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼Œè§P433

2ã€å¤åˆ¶æ„é€ å‡½æ•°

* å¤åˆ¶æ„é€ å‡½æ•°ç”¨äºå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„å¯¹è±¡ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç”¨äºåˆå§‹åŒ–è¿‡ç¨‹ä¸­(åŒ…æ‹¬æŒ‰å€¼ä¼ é€’å‚æ•°)ï¼Œè€Œä¸æ˜¯å¸¸è§„çš„èµ‹å€¼è¿‡ç¨‹ä¸­ã€‚ç±»çš„å¤åˆ¶æ„é€ å‡½æ•°åŸå‹é€šå¸¸å¦‚ä¸‹ï¼š

  * ```c++
    Class_name(const Class_name &);
    ```

  * å®ƒæ¥å—ä¸€ä¸ªæŒ‡å‘ç±»å¯¹è±¡çš„å¸¸é‡å¼•ç”¨ä½œä¸ºå‚æ•°ï¼›

  * å¯¹äºå¤åˆ¶æ„é€ å‡½æ•°ï¼Œéœ€è¦çŸ¥é“ä¸¤ç‚¹ï¼š

    * ä½•æ—¶è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°

      * æ–°å»ºä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶åˆå§‹åŒ–ä¸ºåŒç±»ç°æœ‰å¯¹è±¡æ—¶ï¼Œå¤åˆ¶æ„é€ å‡½æ•°éƒ½å°†è¢«è°ƒç”¨ã€‚è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½å¯èƒ½å‘ç”Ÿï¼Œæœ€å¸¸è§çš„æƒ…å†µæ˜¯å°†æ–°å¯¹è±¡æ˜¾å¼åœ°åˆå§‹åŒ–ä¸ºç°æœ‰çš„å¯¹è±¡ã€‚
      * æ¯å½“ç¨‹åºç”Ÿæˆäº†å¯¹è±¡å‰¯æœ¬æ—¶ï¼Œç¼–è¯‘å™¨éƒ½å°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚
        * å…·ä½“åœ°è¯´ï¼Œå½“å‡½æ•°æŒ‰å€¼ä¼ é€’å¯¹è±¡æˆ–å‡½æ•°è¿”å›å¯¹è±¡æ—¶ï¼Œéƒ½å°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ã€‚
        * ç”±äºæŒ‰å€¼ä¼ é€’å¯¹è±¡å°†è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› æ­¤åº”è¯¥æŒ‰å¼•ç”¨ä¼ é€’å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥èŠ‚çœè°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶é—´ä»¥åŠå­˜å‚¨æ–°å¯¹è±¡çš„ç©ºé—´ã€‚

    * é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°çš„åŠŸèƒ½

      * é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°é€ä¸ªå¤åˆ¶éé™æ€æˆå‘˜(æˆå‘˜å¤åˆ¶ä¹Ÿç§°ä¸ºæµ…å¤åˆ¶)ï¼Œå¤åˆ¶çš„æ˜¯æˆå‘˜çš„å€¼ï¼š

        * ```c++
          StringBad sailor = sports;
          // ä¸ä¸‹é¢ä»£ç ç­‰æ•ˆï¼š
          StringBad sailor;
          sailor.str = sports.str;
          sailor.len = sports.len;
          ```

      * å¦‚æœæˆå‘˜æœ¬èº«å°±æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™å°†ä½¿ç”¨è¿™ä¸ªç±»çš„å¤åˆ¶æ„é€ å‡½æ•°æ¥å¤åˆ¶æˆå‘˜å¯¹è±¡ã€‚é™æ€å‡½æ•°(å¦‚ num_strings )ä¸å—å½±å“ï¼Œå› ä¸ºå®ƒä»¬å±äºæ•´ä¸ªç±»ï¼Œè€Œä¸æ˜¯å„ä¸ªå¯¹è±¡ã€‚å›¾ 12.2 è¯´æ˜äº†éšå¼å¤åˆ¶æ„é€ å‡½æ•°æ‰§è¡Œçš„æ“ä½œã€‚

        * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/c77de957-0bd3-4a03-8c11-634279641fa7)

#### 12.1.3 å›åˆ° StringBadï¼šå¤åˆ¶æ„é€ å‡½æ•°çš„å“ªé‡Œå‡ºäº†é—®é¢˜

ç¨‹åºæ¸…å•12.3ä¸¤ä¸ªå¼‚å¸¸ä¹‹å¤„ï¼š

ï¼ˆ1ï¼‰ç¨‹åºè¾“å‡ºè¡¨æ˜ï¼Œææ„å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°æ¯”æ„é€ å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°å¤š2ï¼ŒåŸå› å¯èƒ½æ˜¯ç¨‹åºç¡®å®ä½¿ç”¨é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°å¦å¤–åˆ›å»ºäº†ä¸¤ä¸ªå¯¹è±¡ã€‚

* è§£å†³åŠæ³•ï¼šæä¾›ä¸€ä¸ªå¯¹è®¡æ•°è¿›è¡Œæ›´æ–°çš„æ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°ï¼š

  * ```C++
    StringBad::StringBad(const String & s)
    {
        num_strings++;
        ...
    }
    ```

  * â—å¦‚æœç±»ä¸­åŒ…å«è¿™æ ·çš„**é™æ€æ•°æ®æˆå‘˜**ï¼Œå³å…¶å€¼å°†åœ¨æ–°å¯¹è±¡è¢«åˆ›å»ºæ—¶å‘ç”Ÿå˜åŒ–ï¼Œåˆ™åº”è¯¥æä¾›ä¸€ä¸ª**æ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°**æ¥å¤„ç†è®¡æ•°é—®é¢˜ã€‚

ï¼ˆ2ï¼‰å­—ç¬¦ä¸²å†…å®¹å‡ºç°ä¹±ç ï¼š

* åŸå› åœ¨äºéšå¼å¤åˆ¶æ„é€ å‡½æ•°æ˜¯æŒ‰å€¼è¿›è¡Œå¤åˆ¶çš„ã€‚

  * ```c++
    sailor.str = sport.str;
    ```

  * è¿™é‡Œå¤åˆ¶çš„å¹¶ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆã€‚å½“ææ„å‡½æ•°è¢«è°ƒç”¨æ˜¯ï¼Œææ„å‡½æ•°é‡Šæ”¾å¤åˆ¶ç±»åæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ï¼Œä½†æ˜¯æŒ‡å‘çš„å†…å­˜ä¹‹å‰å·²ç»è¢«æœ¬ä½“çš„ææ„å‡½æ•°é‡Šæ”¾äº†ï¼Œè¿™å°†å¯¼è‡´ä¸ç¡®å®šçš„ã€å¯èƒ½æœ‰å®³çš„åæœã€‚

ï¼ˆ3ï¼‰å®šä¹‰ä¸€ä¸ªæ˜¾å¼å¤åˆ¶æ„é€ å‡½æ•°ä»¥è§£å†³é—®é¢˜ï¼š

* æ·±åº¦å¤åˆ¶ï¼šå¤åˆ¶æ„é€ å‡½æ•°åº”å½“å¤åˆ¶å­—ç¬¦ä¸²å¹¶å°†å‰¯æœ¬çš„åœ°å€èµ‹ç»™stræˆå‘˜ï¼Œè€Œä¸ä»…ä»…æ˜¯å¤åˆ¶å­—ç¬¦ä¸²åœ°å€ã€‚

  * è¿™æ ·æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡çš„å­—ç¬¦ä¸²ã€‚

  * è°ƒç”¨ææ„å‡½æ•°æ—¶éƒ½å°†é‡Šæ”¾ä¸åŒçš„å­—ç¬¦ä¸²ï¼Œè€Œä¸ä¼šè¯•å›¾å»é‡Šæ”¾å·²ç»è¢«é‡Šæ”¾çš„å­—ç¬¦ä¸²ã€‚

  * å¯ä»¥è¿™æ ·ç¼–å†™Stringçš„å¤åˆ¶æ„é€ å‡½æ•°ï¼š

    * ```c++
      StringBad::StringBad(const StringBad & st)
      {
          num_strings++;
          len = st.len;
          str = new char[len + 1];
          std::strcpy(str, st.str);
          cout << num_strings << ": \" << str <<"\" object created\n";
      }
      ```

  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/7d300f0f-c9e7-4050-8f4f-906829b70fa4)

  * å¦‚æœç±»ä¸­åŒ…å«äº†ä½¿ç”¨newåˆå§‹åŒ–çš„æŒ‡é’ˆæˆå‘˜ï¼Œåº”å½“å®šä¹‰ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ï¼Œä»¥å¤åˆ¶æŒ‡å‘çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æŒ‡é’ˆï¼Œè¿™è¢«ç§°ä¸ºæ·±åº¦å¤åˆ¶ã€‚

#### 12.1.4 StringBad çš„å…¶ä»–é—®é¢˜ï¼šèµ‹å€¼è¿ç®—ç¬¦

C++å…è®¸ç±»å¯¹è±¡èµ‹å€¼ï¼Œè¿™æ˜¯é€šè¿‡è‡ªåŠ¨ä¸ºç±»é‡è½½èµ‹å€¼è¿ç®—ç¬¦å®ç°çš„ï¼š

* ```c++
  Class_name & Class_name::operator=(const Class_name &);
  ```

* å®ƒæ¥å—å¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚

ï¼ˆ1ï¼‰èµ‹å€¼è¿ç®—ç¬¦çš„åŠŸèƒ½ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒ

* å°†å·²æœ‰çš„å¯¹è±¡èµ‹ç»™å¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå°†ä½¿ç”¨é‡è½½çš„èµ‹å€¼è¿ç®—ç¬¦ï¼›
* åˆå§‹åŒ–å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¸€å®šä¼šä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦ã€‚
* ä¸å¤åˆ¶æ„é€ å‡½æ•°ç›¸ä¼¼ï¼Œèµ‹å€¼è¿ç®—ç¬¦çš„éšå¼å®ç°ä¹Ÿå¯¹æˆå‘˜è¿›è¡Œé€ä¸ªå¤åˆ¶ã€‚å¦‚æœæˆå‘˜æœ¬èº«å°±æ˜¯ç±»å¯¹è±¡ï¼Œåˆ™ç¨‹åºå°†ä½¿ç”¨ä¸ºè¿™ä¸ªç±»å®šä¹‰çš„èµ‹å€¼è¿ç®—ç¬¦æ¥å¤åˆ¶è¯¥æˆå‘˜ï¼Œä½†é™æ€æ•°æ®æˆå‘˜ä¸å—å½±å“ã€‚

ï¼ˆ2ï¼‰èµ‹å€¼çš„é—®é¢˜å‡ºåœ¨å“ªé‡Œ

* å‡ºç°çš„é—®é¢˜ä¸éšå¼å¤åˆ¶æ„é€ å‡½æ•°ç›¸åŒï¼šæ•°æ®å—æŸã€‚

ï¼ˆ3ï¼‰è§£å†³èµ‹å€¼çš„é—®é¢˜

* æä¾›èµ‹å€¼è¿ç®—ç¬¦ï¼ˆè¿›è¡Œæ·±åº¦å¤åˆ¶ï¼‰çš„å®šä¹‰ï¼Œå…¶å®ç°ä¸å¤åˆ¶æ„é€ å‡½æ•°ç›¸ä¼¼ï¼Œä¹Ÿå­˜åœ¨ä¸€äº›å·®åˆ«ï¼š

  * ç”±äºç›®æ ‡å¯¹è±¡å¯èƒ½å¼•ç”¨äº†ä»¥å‰åˆ†é…çš„æ•°æ®ï¼Œæ‰€ä»¥å‡½æ•°åº”ä½¿ç”¨ delete[ ]æ¥é‡Šæ”¾è¿™äº›æ•°æ®ã€‚
  * å‡½æ•°åº”å½“é¿å…å°†å¯¹è±¡èµ‹ç»™è‡ªèº«ï¼›å¦åˆ™ï¼Œç»™å¯¹è±¡é‡æ–°èµ‹å€¼å‰ï¼Œé‡Šæ”¾å†…å­˜æ“ä½œå¯èƒ½åˆ é™¤å¯¹è±¡çš„å†…å®¹ã€‚
  * å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘è°ƒç”¨å¯¹è±¡çš„å¼•ç”¨ã€‚

* ```c++
  StringBad & StringBad::operator=(const StringBad & st)
  {
      if(this == &st)
          return *this;
      delete [] str;
      len = st.len;
      str = new char [len + 1];
      std::strcpy(str, st.str);
      return *this;
  }
  ```

* èµ‹å€¼æ“ä½œå¹¶ä¸åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå› æ­¤ä¸éœ€è¦è°ƒæ•´é™æ€æ•°æ®æˆå‘˜num_stringsçš„å€¼ã€‚



### 12.2 æ”¹è¿›åçš„æ–° String ç±»

ï¼ˆ1ï¼‰æ·»åŠ **å¤åˆ¶æ„é€ å‡½æ•°**å’Œ**èµ‹å€¼è¿ç®—ç¬¦**ï¼Œä½¿ç±»èƒ½å¤Ÿæ­£ç¡®ç®¡ç†ç±»å¯¹è±¡ä½¿ç”¨çš„å†…å­˜ã€‚

ï¼ˆ2ï¼‰æ ¹æ®å¯¹è±¡ä½•æ—¶è¢«åˆ›å»ºå’Œé‡Šæ”¾ï¼Œå¯ä»¥è®©æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¿æŒæ²‰é»˜ï¼Œä¸å†åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶éƒ½æ˜¾ç¤ºæ¶ˆæ¯ã€‚

ï¼ˆ3ï¼‰ä¸ç”¨å†ç›‘è§†æ„é€ å‡½æ•°çš„å·¥ä½œæƒ…å†µï¼Œå› æ­¤å¯ä»¥ç®€åŒ–é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½¿ä¹‹åˆ›å»ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯"C++"ã€‚

#### 12.2.1 ä¿®è®¢åçš„é»˜è®¤æ„é€ å‡½æ•°

* ```c++
  String::String()
  {
      len = 0;
      str = new char[1];//ä¸ç±»ææ„å‡½æ•°å…¼å®¹ï¼Œè€Œåè€…ä¸å…¼å®¹ï¼Œè§P438
      str[0] = '\0';
  }
  ```

* C++ç©ºæŒ‡é’ˆï¼Œå…³é”®å­—nullptrï¼Œå‡¯å—P438

  * ```c++
    str = nullpter;
    ```

#### 12.2.2 æ¯”è¾ƒæˆå‘˜å‡½æ•°

* æ‰§è¡Œæ¯”è¾ƒæ“ä½œçš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š<ã€>å’Œ==ï¼Œå®ç°å­—ç¬¦ä¸²åœ¨å‰åœ¨åçš„æ¯”è¾ƒï¼š

  * ```c++
    bool operator<(const String &st1, const String &st2)
    {
        return(std::strcmp(st1.str, st2.str) < 0);
    }
    ```

  * å¦å¤–ä¸¤ä¸ªå¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼æ¥ç¼–å†™ã€‚

#### 12.2.3 ä½¿ç”¨ä¸­æ‹¬å·è¡¨ç¤ºæ³•è®¿é—®å­—ç¬¦

* åœ¨C++ä¸­ï¼Œä¸¤ä¸ªä¸­æ‹¬å·ç»„æˆä¸€ä¸ªè¿ç®—ç¬¦â€”â€”ä¸­æ‹¬å·è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³•operator[ ] ( )æ¥é‡è½½è¯¥è¿ç®—ç¬¦ã€‚

  * é€šå¸¸ï¼ŒäºŒå…ƒC++è¿ç®—ç¬¦ï¼ˆå¸¦ä¸¤ä¸ªæ“ä½œæ•°ï¼‰ä½äºä¸¤ä¸ªæ“ä½œæ•°ä¹‹é—´ï¼Œä¾‹å¦‚2+5ã€‚ä½†å¯¹äºä¸­æ‹¬å·è¿ç®—ç¬¦ï¼Œä¸€ä¸ªæ“ä½œæ•°ä½äºç¬¬ä¸€ä¸ªä¸­æ‹¬å·çš„å‰é¢ï¼Œä¸¤ä¸€ä¸ªä½äºä¸¤ä¸ªä¸­æ‹¬å·ä¹‹é—´ã€‚
  * å› æ­¤åœ¨è¡¨è¾¾å¼city[0]ä¸­ï¼Œcityæ˜¯ç¬¬ä¸€ä¸ªæ“ä½œæ•°ï¼Œ[]æ˜¯è¿ç®—ç¬¦ï¼Œ0æ˜¯ç¬¬äºŒä¸ªæ“ä½œæ•°ï¼š

* å…¬æœ‰æ–¹æ³•å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®ï¼Œå¹¶ç»™ç‰¹å®šçš„å…ƒç´ èµ‹å€¼ï¼š

  * ```c++
    char & String::operator [] (int i)
    {
        return str[i];
    }
    ```

  * è¿”å›å€¼æ˜¯xxx.str[4]ã€‚å› æ­¤å…¬æœ‰æ–¹æ³•å¯ä»¥è®¿é—®ç§æœ‰æ•°æ®ã€‚

  * å°†è¿”å›ç±»å‹å£°æ˜ä¸ºchar &ï¼Œä¾¿å¯ä»¥ç»™ç‰¹å®šçš„å…ƒç´ èµ‹å€¼ï¼š

    * ```c++
      String means("might");
      means[0] = 'r';
      ```

* å¯¹äºå¸¸é‡å¯¹è±¡ï¼Œä¸Šè¿°æ–¹æ³•å°†å‡ºé”™ã€‚å› ä¸ºåœ¨é‡è½½æ—¶C++å°†åŒºåˆ†å¸¸é‡å’Œéå¸¸é‡å‡½æ•°çš„ç‰¹å¾æ ‡ï¼Œå› æ­¤å¯ä»¥æä¾›å¦ä¸€ä¸ªä»…ä¾›const Stringå¯¹è±¡ä½¿ç”¨çš„operator[ ] ( )ç‰ˆæœ¬ï¼š

  * ```c++
    const char & String::operator [] (int i) const
    {
        return str[i];
    }
    ```

#### 12.2.4 é™æ€ç±»æˆå‘˜å‡½æ•°

* å¯ä»¥å°†æˆå‘˜å‡½æ•°å£°æ˜ä¸ºé™æ€çš„åæœï¼š

  * 1ã€ä¸èƒ½é€šè¿‡å¯¹è±¡è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°ï¼Œç”šè‡³ä¸èƒ½ä½¿ç”¨thisæŒ‡é’ˆã€‚

    * å¦‚æœé™æ€æˆå‘˜å‡½æ•°æ˜¯åœ¨å…¬æœ‰éƒ¨åˆ†å£°æ˜çš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ç±»åå’Œä½œç”¨åŸŸè§£æè¿ç®—ç¬¦æ¥è°ƒç”¨å®ƒï¼š

      * ```C++
        static int HowMany() {return num_strings;}
        int count = String::HowMany;
        ```

  * 2ã€ç”±äºé™æ€æˆå‘˜å‡½æ•°ä¸ä¸ç‰¹å®šçš„å¯¹è±¡ç›¸å…³è”ï¼Œå› æ­¤åªèƒ½ä½¿ç”¨é™æ€æ•°æ®æˆå‘˜ã€‚

    * ä¾‹å¦‚é™æ€æ–¹æ³•HowMany()å¯ä»¥è®¿é—®é™æ€æˆå‘˜ num_stringï¼Œä½†ä¸èƒ½è®¿é—®strå’Œlenã€‚

#### 12.2.5 è¿›ä¸€æ­¥é‡è½½èµ‹å€¼è¿ç®—ç¬¦

* å°†å¸¸è§„å­—ç¬¦ä¸²å¤åˆ¶åˆ°Stringå¯¹è±¡ä¸­ï¼Œå¾€å¾€æ•ˆç‡ä¸é«˜ï¼Œè§P439ã€‚ä¸ºäº†æé«˜å¤„ç†æ•ˆç‡ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼Œä½¿ä¹‹èƒ½å¤Ÿç›´æ¥ä½¿ç”¨å¸¸è§„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶å¯¹è±¡äº†ã€‚

  * ```c++
    String & String::operator=(const char * s)
    {
        delete [] str;
        len = std::strlens(s);
        str = new char[len + 1];
        std::strcpy(str, s);
        return *this;
    }
    ```

  * ä¸€èˆ¬æ¥è¯´å¿…é¡»é‡Šæ”¾stræŒ‡å‘çš„å†…å­˜ï¼Œå¹¶ä¸ºæ–°å­—ç¬¦ä¸²åˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚

#### 12.2.6 ç¨‹åºæ¸…å•

* ç¤ºä¾‹ï¼šç±»å£°æ˜

  * ```c++
    #pragma once
    // ch12_04_string1.h -- fixed and augmented string class definition
    #ifndef CH12_04_STRING1_H_
    #define CH12_04_STRING1_H_
    #include <iostream>
    using std::ostream;
    using std::istream;
    
    class String
    {
    private:
    	char* str;
    	int len;
    	static int num_strings;
    	static const int CINLIM = 80;
    public:
    	String(const char* s);
    	String();
    	String(const String&);
    	~String();
    	int length() const { return len; }
    // overloaded operator methods
    	String& operator=(const String&);
    	String& operator=(const char*);
    	char& operator[](int i);
    	const char& operator[](int i)const;
    // overloaded operator friends
    	friend bool operator<(const String& st, const String& st2);
    	friend bool operator>(const String& st, const String& st2);
    	friend bool operator==(const String& st, const String& st2);
    	friend ostream& operator<<(ostream& os, const String& st);
    	friend istream& operator>>(istream& is, String& st);
    // static function
    	static int HowMany();
    };
    #endif
    ```

* ç¤ºä¾‹ï¼šç±»æ–¹æ³•å®šä¹‰ 

  * ```c++
    #define _CRT_SECURE_NO_WARNINGS
    // ch12_05_string1.cpp -- String class methods
    #include <cstring>
    #include "ch12_04_string1.h"
    using std::cin;
    using std::cout;
    
    // initializing static class member
    int String::num_strings = 0;
    
    // static method
    int String::HowMany()
    {
    	return num_strings;
    }
    
    // class methods
    // construct StringBad from C string
    String::String(const char* s)
    {
    	len = std::strlen(s);
    	str = new char[len + 1];
    	std::strcpy(str, s);
    	num_strings++;
    }
    
    String::String()
    {
    	len = 4;
    	str = new char[1];
    	str[0] = '\0';
    	num_strings++;
    }
    
    String::String(const String& st)
    {
    	num_strings++;
    	len = st.len;
    	str = new char[len + 1];
    	std::strcpy(str, st.str);
    }
    
    String::~String()
    {
    	--num_strings;
    	delete[] str;
    }
    
    // overloaded operator methods
    	// assign a String to a String
    String& String::operator=(const String& st)
    {
    	if (this == &st)
    		return *this;
    	delete[] str;
    	len = st.len;
    	str = new char[len + 1];
    	std::strcpy(str, st.str);
    	return *this;
    }
    
    	// assign a C string to a string
    String& String::operator=(const char* s)
    {
    	delete[] str;
    	len = std::strlen(s);
    	str = new char[len + 1];
    	std::strcpy(str, s);
    	return *this;
    }
    
    	// read-write char access for non-const String
    char& String::operator[](int i)
    {
    	return str[i];
    }
    
    	// read-only char access for const String
    const char& String::operator[](int i) const
    {
    	return str[i];
    }
    
    // overload operator friends
    
    bool operator<(const String& st1, const String& st2)
    {
    	return(std::strcmp(st1.str, st2.str) < 0);
    }
    
    bool operator>(const String& st1, const String& st2)
    {
    	return st2 < st1;
    }
    
    bool operator==(const String& st1, const String& st2)
    {
    	return(std::strcmp(st1.str, st2.str) == 0);
    }
    
    	// simple String output
    ostream& operator<<(ostream& os, const String& st)
    {
    	os << st.str;
    	return os;
    }
    
    	// quick and dirty String input
    istream& operator>>(istream& is, String& st)
    {
    	char temp[String::CINLIM];
    	is.get(temp, String::CINLIM);
    	if (is)
    		st = temp;
    	while (is && is.get() != '\n')
    		continue;
    	return is;
    }
    ```

* ç¤ºä¾‹ï¼šï¼ˆæ–¹æ³•ä½¿ç”¨ï¼‰

  * ```c++
    // ch12_06_sayings1.cpp -- using expanded String class
    // compile with ch12_06_sayings1.cpp
    #include <iostream>
    #include "ch12_04_string1.h"
    
    const int ArSize = 10;
    const int MaxLen = 81;
    
    int main()
    {
    	using std::cout;
    	using std::cin;
    	using std::endl;
    
    	String name;
    	cout << "Hi, what's your name?\n>> ";
    	cin >> name;
    
    	cout << name << ", please enter up to " << ArSize
    		<< " short sayings <empty line to quit>:\n";
    	String sayings[ArSize];
    	char temp[MaxLen];
    	int i;
    	for (i = 0; i < ArSize; i++)
    	{
    		cout << i + 1 << ": ";
    		cin.get(temp, MaxLen);
    		while (cin && cin.get() != '\n')
    			continue;
    		if (!cin || temp[0] == '\0')	//empty line?
    			break;
    		else
    			sayings[i] = temp;
    	}
    	int total = i;
    
    	if (total > 0)
    	{
    		cout << "Here are your sayings:\n";
    		for (i = 0; i < total; i++)
    			cout << sayings[i][0] << ": " << sayings[i] << endl;
    
    		int shortest = 0;
    		int first = 0;
    		for (i = 1; i < total; i++)
    		{
    			if (sayings[i].length() < sayings[shortest].length())
    				shortest = i;
    			if (sayings[i] < sayings[first])
    				first = i;
    		}
    		cout << "Shortest saying:\n" << sayings[shortest] << endl;
    		cout << "First alphabetically:\n" << sayings[first] << endl;
    		cout << "This program used " << String::HowMany()
    			<< " String objects. Bye.\n";
    	}
    	else
    		cout << "No input! Bye.\n";
    	return 0;
    
    }
    ```

* ç»“æœï¼š

  * ```c++
    Hi, what's your name?
    >> Misty Gutz
    Misty Gutz, please enter up to 10 short sayings <empty line to quit>:
    1: a fool and his money are soon parted
    2: penny wise, pound foolish
    3: the love of money is the root of much evil
    4: out of sight, out of mind
    5: absence makes the heart grow fonder
    6: absinthe makes the hart grow fonder
    7:
    Here are your sayings:
    a: a fool and his money are soon parted
    p: penny wise, pound foolish
    t: the love of money is the root of much evil
    o: out of sight, out of mind
    a: absence makes the heart grow fonder
    a: absinthe makes the hart grow fonder
    Shortest saying:
    penny wise, pound foolish
    First alphabetically:
    a fool and his money are soon parted
    This program used 11 String objects. Bye.
    ```

### 12.3 åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newæ—¶åº”æ³¨æ„çš„äº‹é¡¹

* å¦‚æœåœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨newæ¥åˆå§‹åŒ–æŒ‡é’ˆæˆå‘˜ï¼Œåˆ™åº”åœ¨ææ„å‡½æ•°ä¸­ä½¿ç”¨deleteã€‚

* new å’Œ delete å¿…é¡»ç›¸äº’å…¼å®¹ã€‚new å¯¹åº”äº deleteï¼Œ new[ ] å¯¹åº”äº delete[ ]ã€‚

* å¦‚æœæœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œåˆ™å¿…é¡»ä»¥ç›¸åŒçš„æ–¹å¼ä½¿ç”¨ newï¼Œè¦ä¹ˆéƒ½å¸¦ä¸­æ‹¬å·ï¼Œè¦ä¹ˆéƒ½ä¸å¸¦ã€‚å› ä¸ºåªæœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»ä¸å®ƒå…¼å®¹ã€‚ç„¶è€Œå¯ä»¥åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­ä½¿ç”¨ new åˆå§‹åŒ–æŒ‡é’ˆï¼Œè€Œåœ¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ä¸­å°†æŒ‡é’ˆåˆå§‹åŒ–ä¸ºç©ºï¼Œè¿™æ˜¯å› ä¸º delete å¯ä»¥ç”¨äºç©ºæŒ‡é’ˆã€‚

* åº”å®šä¹‰ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ï¼Œé€šè¿‡æ·±åº¦å¤åˆ¶å°†ä¸€ä¸ªå¯¹è±¡åˆå§‹åŒ–ä¸ºå¦ä¸€ä¸ªå¯¹è±¡ã€‚

  * ```C++
    String::String(const String& st)
    {
    	num_strings++;
    	len = st.len;
    	str = new char[len + 1];
    	std::strcpy(str, st.str);
    }
    ```

  * å…·ä½“åœ°è¯´ï¼Œå¤åˆ¶æ„é€ å‡½æ•°åº”åˆ†é…è¶³å¤Ÿçš„ç©ºé—´æ¥å‚¨å­˜å¤åˆ¶åœ°å€¼ï¼Œå¹¶å¤åˆ¶æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ•°æ®çš„åœ°å€ã€‚å¦å¤–ï¼Œè¿˜åº”è¯¥æ›´æ–°æ‰€å—å½±å“çš„é™æ€ç±»æˆå‘˜ã€‚

* åº”å½“å®šä¹‰ä¸€ä¸ªèµ‹å€¼è¿ç®—ç¬¦ï¼Œé€šè¿‡æ·±åº¦å¤åˆ¶å°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶ç»™å¦ä¸€ä¸ªå¯¹è±¡ã€‚

  * ```c++
    String& String::operator=(const String& st)
    {
    	if (this == &st)
    		return *this;
    	delete[] str;
    	len = st.len;
    	str = new char[len + 1];
    	std::strcpy(str, st.str);
    	return *this;
    }
    ```

  * å…·ä½“åœ°è¯´ï¼Œè¯¥æ–¹æ³•åº”å®Œæˆè¿™äº›æ“ä½œï¼šæ£€æŸ¥è‡ªæˆ‘èµ‹å€¼çš„æƒ…å†µï¼Œé‡Šæ”¾æˆå‘˜æŒ‡é’ˆä»¥å‰æŒ‡å‘çš„å†…å­˜ï¼Œå¤åˆ¶æ•°æ®è€Œä¸ä»…ä»…æ˜¯æ•°æ®çš„åœ°å€ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è°ƒç”¨å¯¹è±¡çš„å¼•ç”¨ã€‚

#### 12.3.1 åº”è¯¥å’Œä¸åº”è¯¥

* åŒ…æ‹¬ä»¥ä¸Šæ³¨æ„äº‹é¡¹çš„ç¤ºä¾‹ï¼Œè§P448

#### 12.3.2 åŒ…å«ç±»æˆå‘˜çš„ç±»çš„é€æˆå‘˜å¤åˆ¶

* æ˜¯å¦è¦ä¸ºå…¶ä»–ç±»ç¼–å†™å¤åˆ¶æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦ï¼Ÿä¸ï¼Œè‡³å°‘å¯¹æŸäº›ç±»æ¥è¯´ä¸éœ€è¦ã€‚è§P449ã€‚

### 12.4 æœ‰å…³è¿”å›å¯¹è±¡çš„è¯´æ˜

å½“æˆå‘˜å‡½æ•°æˆ–ç‹¬ç«‹çš„å‡½æ•°è¿”å›å¯¹è±¡æ—¶ï¼Œæœ‰å‡ ç§è¿”å›æ–¹å¼å¯ä¾›é€‰æ‹©ï¼š

* å¯ä»¥è¿”å›æŒ‡å‘å¯¹è±¡çš„åº”ç”¨ã€æŒ‡å‘å¯¹è±¡çš„ const å¼•ç”¨æˆ– const å¯¹è±¡ã€‚

#### 12.4.1 è¿”å›æŒ‡å‘ const å¯¹è±¡çš„å¼•ç”¨

* ä½¿ç”¨ const å¼•ç”¨åŸå› ï¼šæé«˜æ•ˆç‡ã€‚

* ä¸€ä¸‹ä¸¤ç§æ–¹æ³•å‡å¯è¡Œï¼š

  * ```c++
    Vector Max(const Vector & v1, const Vector & v2)
    {
        if (v1.magval() > v2.magval())
            return v1;
        else
            return v2;
    }
    ```

    * ã€Šè¿”å›å¯¹è±¡æ–¹æ³•ã€‹

  * ```c++
    const Vector & Max(const Vector & v1, const Vector & v2)
    {
        if (v1.magval() > v2.magval())
            return v1;
        else
            return v2;
    }
    ```

    * ã€Šè¿”å›å¼•ç”¨æ–¹æ³•ã€‹

  * ã€Šè¿”å›å¯¹è±¡æ–¹æ³•ã€‹å°†å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè€Œã€Šè¿”å›å¼•ç”¨æ–¹æ³•ã€‹ä¸ä¼šã€‚

    * å› æ­¤ç¬¬äºŒä¸ªç‰ˆæœ¬æ•ˆç‡æ›´é«˜ã€‚

  * å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡åº”è¯¥åœ¨è°ƒç”¨å‡½æ•°æ‰§è¡Œæ—¶å­˜åœ¨ã€‚

  * v1ï¼Œv2éƒ½è¢«å£°æ˜ä¸ºconstå¼•ç”¨ï¼Œå› æ­¤è¿”å›ç±»å‹å¿…é¡»ä¸ºconstè¿™æ ·æ‰åŒ¹é…ã€‚

#### 12.4.2 è¿”å›æŒ‡å‘é const å¯¹è±¡çš„å¼•ç”¨

å¸¸è§çš„è¿”å›é const å¯¹è±¡æœ‰ä¸¤ç§æƒ…å½¢ï¼šï¼ˆå‰è€…ä¸ºäº†æé«˜æ•ˆç‡ï¼Œåè€…å¿…é¡»è¿™æ ·åšï¼‰

* 1ã€é‡è½½èµ‹å€¼è¿ç®—ç¬¦ï¼š

  * operator=()çš„è¿”å›å€¼ç”¨äºè¿ç»­èµ‹å€¼

    * ```c++
      String s1("Good Stuff");
      String s2, s3;
      s3 = s2 = s1;
      ```

    * è¿”å› String å¯¹è±¡æˆ– String å¯¹è±¡çš„å¼•ç”¨éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†ä¸Vectorç¤ºä¾‹ä¸­ä¸€æ ·ï¼Œé€šè¿‡ä½¿ç”¨å¼•ç”¨ï¼Œå¯é¿å…è¯¥å‡½æ•°è°ƒç”¨ String çš„å¤åˆ¶æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ String å¯¹è±¡ã€‚

    * è¯¥ä¾‹å­è¿”å›ç±»å‹ä¸æ˜¯ const ï¼Œå› ä¸ºæ–¹æ³• operator=()è¿”å›ä¸€ä¸ªæŒ‡å‘ s2 çš„å¼•ç”¨ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚

* 2ã€é‡è½½ä¸coutä¸€èµ·ä½¿ç”¨çš„<<è¿ç®—ç¬¦

  * ```c++
    String s1("Good stuff");
    cout << s1 << "is coming!";
    ```

  * operator<<(cout, s1)çš„è¿”å›å€¼æˆä¸ºä¸€ä¸ªç”¨äºæ˜¾å¼å­—ç¬¦ä¸²"is coming!"çš„å¯¹è±¡ã€‚è¿”å›ç±»å‹å¿…é¡»æ˜¯ ostream&ï¼Œè€Œä¸èƒ½ä»…ä»…æ˜¯ ostreamã€‚

  * å¦‚æœä½¿ç”¨è¿”å›ç±»å‹ ostream è§P450ã€‚

#### 12.4.3 è¿”å›å¯¹è±¡

å¦‚æœè¢«è¿”å›çš„å¯¹è±¡æ˜¯è¢«è°ƒç”¨å‡½æ•°ä¸­çš„**å±€éƒ¨å˜é‡**ï¼Œåˆ™ä¸åº”æŒ‰å¼•ç”¨æ–¹å¼è¿”å›å®ƒï¼Œå› ä¸ºåœ¨è¢«è°ƒç”¨å‡½æ•°æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œå±€éƒ¨å¯¹è±¡å°†è°ƒç”¨å…¶ææ„å‡½æ•°ã€‚å› æ­¤ï¼Œå½“æ§åˆ¶æƒå›åˆ°è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡å°†ä¸å†å­˜åœ¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¿”å›å¯¹è±¡è€Œä¸æ˜¯å¼•ç”¨ã€‚é€šå¸¸ï¼Œè¢«é‡è½½çš„ç®—æœ¯è¿ç®—ç¬¦å±äºè¿™ä¸€ç±»ã€‚

* è¿”å›å€¼ä¸èƒ½æ˜¯æŒ‡å‘åœ¨è°ƒç”¨å‡½æ•°ä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡çš„å¼•ç”¨ã€‚

* è§P450ï¼Œoperator+( )ä¸­è®¡ç®—å¾—åˆ°çš„ä¸¤ä¸ªçŸ¢é‡çš„å’Œè¢«å­˜å‚¨åœ¨ä¸€ä¸ªæ–°çš„ä¸´æ—¶å¯¹è±¡ä¸­ï¼Œè¯¥å‡½æ•°ä¹Ÿä¸åº”è¿”å›æŒ‡å‘è¯¥ä¸´æ—¶å¯¹è±¡çš„åº”ç”¨ï¼Œè€Œåº”è¯¥è¿”å›å®é™…çš„ Vector å¯¹è±¡ï¼Œè€Œä¸æ˜¯å¼•ç”¨ï¼š

  * ```c++
    Vector Vector::operator+(const Vector & b) const
    {
        return Vector(x + b.x, y + b.y);
    }
    ```

  * åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­˜åœ¨è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°æ¥åˆ›å»ºè¢«è¿”å›çš„å¯¹è±¡çš„å¼€é”€ï¼Œç„¶è€Œè¿™æ˜¯æ— æ³•é¿å…çš„ã€‚

* å› æ­¤ï¼Œä¸Šè¿°ä¾‹å­è¿”å›è¯­å¥å¼•å‘çš„å¯¹å¤åˆ¶æ„é€ å‡½æ•°çš„éšå¼è°ƒç”¨åˆ›å»ºä¸€ä¸ªè°ƒç”¨ç¨‹åºèƒ½å¤Ÿè®¿é—®çš„å¯¹è±¡ã€‚

#### 12.4.4 è¿”å› const å¯¹è±¡

è§P451ï¼š

* æ€»ä¹‹ï¼Œå¦‚æœæ–¹æ³•æˆ–å‡½æ•°è¦è¿”å›å±€éƒ¨å¯¹è±¡ï¼Œåˆ™åº”è¿”å›å¯¹è±¡ï¼Œè€Œä¸æ˜¯æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ã€‚
  * åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°æ¥ç”Ÿæˆè¿”å›çš„å¯¹è±¡ã€‚

* å¦‚æœæ–¹æ³•æˆ–å‡½æ•°è¦è¿”å›ä¸€ä¸ªæ²¡æœ‰å…¬æœ‰å¤åˆ¶æ„é€ å‡½æ•°çš„ç±»(å¦‚ ostream ç±»)çš„å¯¹è±¡ï¼Œå®ƒå¿…é¡»è¿”å›ä¸€ä¸ªæŒ‡å‘è¿™ç§å¯¹è±¡çš„å¼•ç”¨ã€‚
* æœ€åï¼Œæœ‰äº›æ–¹æ³•å’Œå‡½æ•°(å¦‚é‡è½½çš„èµ‹å€¼è¿ç®—ç¬¦)å¯ä»¥è¿”å›å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥è¿”å›æŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”é¦–é€‰å¼•ç”¨ï¼Œå› ä¸ºå…¶æ•ˆç‡æ›´é«˜ã€‚

### 12.5 ä½¿ç”¨æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆ

ç¨‹åºæ¸…å•12.6ä½¿ç”¨æ•°ç»„ç´¢å¼•å€¼æ¥è·Ÿè¸ªæœ€çŸ­çš„å­—ç¬¦ä¸²å’ŒæŒ‰å­—æ¯é¡ºåºæ’åœ¨æœ€å‰é¢çš„å­—ç¬¦ä¸²ã€‚

å¦ä¸€ç§æ–¹æ³•ä½¿ç”¨æŒ‡é’ˆæŒ‡å‘è¿™äº›ç±»åˆ«çš„å¼€å§‹ä½ç½®ã€‚ç¨‹åºæ¸…å•12.7ä½¿ç”¨ä¸¤ä¸ªæŒ‡å‘ String çš„æŒ‡é’ˆå®ç°äº†è¿™ç§æ–¹æ³•ã€‚

æœ€åˆï¼Œshortest æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚æ¯å½“ç¨‹åºæ‰¾åˆ°æ¯”æŒ‡å‘å­—ç¬¦ä¸²æ›´çŸ­çš„å¯¹è±¡æ—¶ï¼Œå°±æŠŠ shortest é‡æ–°è®¾ç½®ä¸ºæŒ‡å‘è¯¥å¯¹è±¡ã€‚åŒæ ·ï¼Œfirst æŒ‡é’ˆè·Ÿè¸ªæŒ‰å­—æ¯é¡ºåºæ’åœ¨æœ€å‰é¢çš„å­—ç¬¦ä¸²ã€‚ï¼ˆè¿™äº›æŒ‡é’ˆå¹¶ä¸è¦æ±‚ä½¿ç”¨ new æ¥åˆ†é…å†…å­˜ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªæŒ‡é’ˆæ˜¯æŒ‡å‘å·²æœ‰çš„å¯¹è±¡ï¼‰

æ­¤å¤–ï¼Œè¿˜ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆæ¥è·Ÿè¸ªæ–°å¯¹è±¡ï¼š

```c++
String * favorite = new String(sayings[choice]);
```

æŒ‡é’ˆ favorite æŒ‡å‘ new åˆ›å»ºçš„æœªè¢«å‘½åå¯¹è±¡ã€‚è¿™æ„å‘³ç€ä½¿ç”¨å¯¹è±¡  saying[choice] æ¥åˆå§‹åŒ–æ–°çš„ String å¯¹è±¡ï¼Œè¿™å°†è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå› ä¸ºå¤åˆ¶æ„é€ å‡½æ•°ï¼ˆconst String &ï¼‰çš„å‚æ•°ç±»å‹ä¸åˆå§‹åŒ–å€¼ï¼ˆsaying[choice])åŒ¹é…ã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch12_07_sayings2.cpp -- using pointers to objects
    // compile with ch12_07_sayings2.cpp
    #include <iostream>
    #include <cstdlib>
    #include <ctime>
    #include "ch12_04_string1.h"
    
    const int ArSize = 10;
    const int MaxLen = 81;
    
    int main()
    {
    	using namespace std;
    
    	String name;
    	cout << "Hi, what's your name?\n>> ";
    	cin >> name;
    
    	cout << name << ", please enter up to " << ArSize
    		<< " short sayings <empty line to quit>:\n";
    	String sayings[ArSize];
    	char temp[MaxLen];
    	int i;
    	for (i = 0; i < ArSize; i++)
    	{
    		cout << i + 1 << ": ";
    		cin.get(temp, MaxLen);
    		while (cin && cin.get() != '\n')
    			continue;
    		if (!cin || temp[0] == '\0')	//empty line?
    			break;
    		else
    			sayings[i] = temp;
    	}
    	int total = i;
    
    	if (total > 0)
    	{
    		cout << "Here are your sayings:\n";
    		for (i = 0; i < total; i++)
    			cout << sayings[i] << endl;
    	// use pointers to keep track of shortest, first strings
    		String* shortest = &sayings[0];
    		String* first = &sayings[0];
    		for (i = 1; i < total; i++)
    		{
    			if (sayings[i].length() < shortest->length())
    				shortest = &sayings[i];
    			if (sayings[i] < *first)
    				first = &sayings[i];
    		}
    		cout << "Shortest saying:\n" << *shortest << endl;
    		cout << "First alphabetically:\n" << *first << endl;
    		srand(time(0));
    		int choice = rand() % total; // pick index at random
    	// use new to create, initialize new String object
    		String* favorite = new String(sayings[choice]);
    		cout << "My favorite saying:\n" << *favorite << endl;
    		delete favorite;
    	}
    	else
    		cout << "Not much to say, eh?\n";
    	cout << "No input! Bye.\n";
    	return 0;
    
    }
    ```

* ç»“æœï¼š

  * ```c++
    Hi, what's your name?
    >> Kirt Rood
    Kirt Rood, please enter up to 10 short sayings <empty line to quit>:
    1: a friend in need is a friend indeed
    2: neither a borrower nor a lender be
    3: a stich in times saves nine
    4: a niche in time saves stine
    5: it takes a crook to catch a crook
    6: cold hands, warm heart
    7:
    Here are your sayings:
    a friend in need is a friend indeed
    neither a borrower nor a lender be
    a stich in times saves nine
    a niche in time saves stine
    it takes a crook to catch a crook
    cold hands, warm heart
    Shortest saying:
    cold hands, warm heart
    First alphabetically:
    a friend in need is a friend indeed
    My favorite saying:
    a stich in times saves nine
    No input! Bye.
    ```

  * ä½¿ç”¨newåˆå§‹åŒ–å¯¹è±¡ï¼š

    * å¦‚æœClass_nameæ˜¯ç±»ï¼Œvalueçš„ç±»å‹ä¸ºType_nameï¼Œåˆ™ï¼š

      * ```c++
        Class_name * pclass = new Class_name(value);
        ```

    * å°†è°ƒç”¨å¦‚ä¸‹æ„é€ å‡½æ•°ï¼š

      * ```c++
        Class_name(Type_name);
        ```

    * è¿™é‡Œå¯èƒ½è¿˜æœ‰ä¸€äº›çç¢çš„è½¬æ¢ï¼š

      * ```c++
        Class_name(const Type_name &);
        ```

    * å¦å¤–ï¼Œå¦‚æœä¸å­˜åœ¨äºŒä¹‰æ€§ï¼Œåˆ™å°†å‘ç”Ÿç”±åŸå‹åŒ¹é…å¯¼è‡´çš„è½¬æ¢ï¼ˆå¦‚ int åˆ° doubleï¼‰ã€‚ä¸‹é¢åˆå§‹åŒ–æ–¹å¼å°†è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼š

      * ```c++
        Class_name * ptr = new Class_name;
        ```

#### 12.5.1 å†è°ˆ new å’Œ delete

ä¸Šè¿°å·¥ç¨‹åœ¨ä¸¤ä¸ªå±‚æ¬¡ä¸Šä½¿ç”¨äº† new å’Œ deleteï¼š

* 1ã€ä½¿ç”¨ new ä¸ºåˆ›å»ºçš„æ¯ä¸€ä¸ªå¯¹è±¡çš„åç§°å­—ç¬¦ä¸²åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè¿™æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤ææ„å‡½æ•°ä½¿ç”¨ delete æ¥é‡Šæ”¾è¿™äº›å†…å­˜ã€‚å› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå­—ç¬¦æ•°ç»„ï¼Œæ‰€ä»¥ææ„å‡½æ•°ä½¿ç”¨çš„æ˜¯å¸¦ä¸­æ‹¬å·çš„ deleteã€‚è¿™æ ·ï¼Œå½“å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œç”¨äºå­˜å‚¨å­—ç¬¦ä¸²çš„å†…å®¹å°†è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚

  * ```c++
    // class methods
    // construct StringBad from C string
    String::String(const char* s)
    {
    	len = std::strlen(s);
    	str = new char[len + 1];
    	std::strcpy(str, s);
    	num_strings++;
    }
    
    String::String()
    {
    	len = 4;
    	str = new char[1];
    	str[0] = '\0';
    	num_strings++;
    }
    
    String::String(const String& st)
    {
    	num_strings++;
    	len = st.len;
    	str = new char[len + 1];
    	std::strcpy(str, st.str);
    }
    
    String::~String()
    {
    	--num_strings;
    	delete[] str;
    }
    ```

* 2ã€ä½¿ç”¨ new æ¥ä¸ºæ•´ä¸ªå¯¹è±¡åˆ†é…å†…å­˜ï¼š

  * ```c++
    String* favorite = new String(sayings[choice]);
    cout << "My favorite saying:\n" << *favorite << endl;
    delete favorite;
    ```

  * è¿™ä¸æ˜¯ä¸ºè¦å­˜å‚¨çš„å­—ç¬¦ä¸²åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ºä¿å­˜å­—ç¬¦ä¸²åœ°å€çš„ str æŒ‡é’ˆå’Œ len æˆå‘˜åˆ†é…å†…å­˜ï¼ˆç¨‹åºå¹¶æ²¡æœ‰ç»™ num_string æˆå‘˜åˆ†é…å†…å­˜ï¼Œè¿™æ˜¯å› ä¸º num_string æˆå‘˜æ˜¯é™æ€æˆå‘˜ï¼Œå®ƒç‹¬ç«‹äºå¯¹è±¡è¢«ä¿å­˜ï¼‰ã€‚

  * åˆ›å»ºå¯¹è±¡å°†è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåè€…åˆ†é…ç”¨äºä¿å­˜å­—ç¬¦ä¸²çš„å†…å­˜ï¼Œå¹¶å°†å­—ç¬¦ä¸²çš„åœ°å€èµ‹ç»™ strã€‚

  * ç„¶åå½“ç¨‹åºä¸å†éœ€è¦è¯¥å¯¹è±¡æ—¶ï¼Œä½¿ç”¨ deleteåˆ é™¤å®ƒã€‚å¯¹è±¡æ˜¯å•ä¸ªçš„ï¼Œå› æ­¤ç¨‹åºä½¿ç”¨ä¸å¸¦ä¸­æ‹¬å·çš„ deleteã€‚

  * ä¸å‰é¢ç›¸åŒï¼Œè¿™å°†åªé‡Šæ”¾ç”¨äºä¿å­˜ str æŒ‡é’ˆå’Œ len æˆå‘˜çš„ç©ºé—´ï¼Œå¹¶ä¸é‡Šæ”¾ str æŒ‡å‘çš„å†…å­˜ï¼Œè€Œè¯¥ä»»åŠ¡å°†ç”±ææ„å‡½æ•°å®Œæˆã€‚

  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/2475707c-f450-4cea-8c5e-db6f4cca9f73)


* ææ„å‡½æ•°å°†è¢«è°ƒç”¨çš„æƒ…å†µï¼Œè§P454

  * å¦‚æœå¯¹è±¡æ˜¯åŠ¨æ€å˜é‡ï¼Œåˆ™å½“æ‰§è¡Œå®Œå®šä¹‰è¯¥å¯¹è±¡çš„ç¨‹åºå—æ—¶ï¼Œå°†è°ƒç”¨è¯¥å¯¹è±¡çš„ææ„å‡½æ•°ã€‚
  * å¦‚æœå¯¹è±¡æ—¶é™æ€å˜é‡ï¼Œåˆ™åœ¨ç¨‹åºç»“æŸæ—¶å°†è°ƒç”¨å¯¹è±¡çš„ææ„å‡½æ•°ã€‚
  * å¦‚æœå¯¹è±¡æ˜¯ new åˆ›å»ºçš„ï¼Œåˆ™ä»…å½“æ‚¨æ˜¾å¼ä½¿ç”¨ delete åˆ é™¤å¯¹è±¡æ—¶ï¼Œå…¶ææ„å‡½æ•°æ‰ä¼šè¢«è°ƒç”¨ã€‚

#### 12.5.2 æŒ‡é’ˆå’Œå¯¹è±¡å°ç»“

ä½¿ç”¨å¯¹è±¡æŒ‡é’ˆéœ€æ³¨æ„å‡ ç‚¹ï¼š

![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/cce5f65a-45e8-43c0-ae7c-8705edb1154a)

* ä½¿ç”¨å¸¸è§„è¡¨ç¤ºæ³•æ¥å£°æ˜æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼š

  * ```c++
    String * glamour;
    ```

* å¯ä»¥å°†æŒ‡é’ˆåˆå§‹åŒ–ä¸ºæŒ‡å‘å·²æœ‰çš„å¯¹è±¡ï¼š

  * ```c++
    String * first = &sayings[0];
    ```

* å¯ä»¥ä½¿ç”¨ new æ¥åˆå§‹åŒ–æŒ‡é’ˆï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼š

  * ```c++
    String * favorite = new String(sayings[choice]);
    ```

* å¯¹ç±»ä½¿ç”¨ new å°†è°ƒç”¨ç›¸åº”çš„ç±»æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡ï¼š

  * ```c++
    // invokes default constructor
    String * gleep = new String;
    // invokes the String(const char *)constructor
    String * glop = new String("my my my");
    // invokes the String(const String &)constructor
    String * favorite = new String(sayings[choice]);
    ```

  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/25c78551-7e65-4f13-9f23-fc2c2c3ee8e1)

* å¯ä»¥ä½¿ç”¨->è¿ç®—ç¬¦é€šè¿‡æŒ‡é’ˆè®¿é—®ç±»å¯¹è±¡ï¼š

  * ```c++
    if (sayings[i].length() < shortest->length());
    ```

* å¯ä»¥å¯¹å¯¹è±¡æŒ‡é’ˆåº”ç”¨è§£é™¤å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ*ï¼‰æ¥è·å¾—å¯¹è±¡ï¼š

  * ```c++
    if (sayings[i] < *first)
        first = &sayings[i];
    ```

#### 12.5.3 å†è°ˆå®šä½ new è¿ç®—ç¬¦

å®šä½ new è¿ç®—ç¬¦èƒ½å¤Ÿè®©æ‚¨åœ¨åˆ†é…å†…å­˜æ—¶èƒ½å¤ŸæŒ‡å®šå†…å­˜ä½ç½®ï¼Œåœ¨å®šä½ new è¿ç®—ç¬¦ç”¨äºå¯¹è±¡æ—¶çš„æƒ…å†µæœ‰äº›ä¸åŒã€‚

* ç¤ºä¾‹ï¼š

  * ```c++
    // ch12_08_placenew1.cpp -- new, placement new, no delete
    #include <iostream>
    #include <string>
    #include <new>
    using namespace std;
    const int BUF = 512;
    
    class JustTesting
    {
    private:
    	string words;
    	int number;
    public:
    	JustTesting(const string& s = "Just Testing", int n = 0)
    	{
    		words = s;
    		number = n;
    		cout << words << " constructed\n";
    	}
    	~JustTesting() { cout << words << " destroyed\n"; }
    	void Show() const { cout << words << ", " << number << endl; }
    };
    
    int main()
    {
    	char* buffer = new char[BUF];
    
    	JustTesting* pc1, * pc2;
    
    	pc1 = new (buffer) JustTesting;		// place object in buffer
    	pc2 = new JustTesting("Heap1", 20);	// place object on heap
    
    	cout << "Memory block addresses:\n" << "buffer: "
    		<< (void*)buffer << "     heap: " << pc2 << endl;
    	cout << "Memory contents:\n";
    	cout << pc1 << ": ";
    	pc1->Show();
    	cout << pc2 << ": ";
    	pc2->Show();
    
    	JustTesting* pc3, * pc4;
    	pc3 = new (buffer) JustTesting("Bad Idea", 6);
    	pc4 = new JustTesting("Heap2", 10);
    
    	cout << "Memory contents:\n";
    	cout << pc3 << ": ";
    	pc3->Show();
    	cout << pc4 << ": ";
    	pc4->Show();
    
    	delete pc2;
    	delete pc4;
    	delete[] buffer;
    	cout << "Done\n";
    	return 0;
    }
    ```

* ç»“æœï¼š

  * ```c++
    Just Testing constructed
    Heap1 constructed
    Memory block addresses:
    buffer: 008B29D8     heap: 008ACF18
    Memory contents:
    008B29D8: Just Testing, 0
    008ACF18: Heap1, 20
    Bad Idea constructed
    Heap2 constructed
    Memory contents:
    008B29D8: Bad Idea, 6
    008AC4E8: Heap2, 10
    Heap1 destroyed
    Heap2 destroyed
    Done
    ```

  * è¯¥ç¨‹åºä½¿ç”¨ new è¿ç®—ç¬¦åˆ›å»ºäº†ä¸€ä¸ª512å­—èŠ‚çš„å†…å­˜ç¼“å†²åŒºï¼Œç„¶åä½¿ç”¨ new è¿ç®—ç¬¦åœ¨å †ä¸­åˆ›å»ºä¸¤ä¸ªJustTestingå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å®šä½ new è¿ç®—ç¬¦åœ¨å†…å­˜ç¼“å†²åŒºä¸­åˆ›å»ºä¸¤ä¸ª JustTesting å¯¹è±¡ã€‚æœ€åï¼Œå®ƒä½¿ç”¨ delete æ¥é‡Šæ”¾ä½¿ç”¨ new åˆ†é…çš„å†…å­˜ã€‚

  * ä¸¤ä¸ªé—®é¢˜ï¼š

    * 1ã€åœ¨åˆ›å»ºç¬¬äºŒä¸ªå¯¹è±¡æ—¶ï¼Œå®šä½ new è¿ç®—ç¬¦ä½¿ç”¨ä¸€ä¸ªæ–°å¯¹è±¡æ¥è¦†ç›–ç”¨äºç¬¬ä¸€ä¸ªå¯¹è±¡çš„å†…å­˜å•å…ƒã€‚å¦‚æœç±»åŠ¨æ€åœ°ä¸ºå…¶æˆå‘˜åˆ†é…å†…å­˜ï¼Œè¿™å°†å¼•å‘é—®é¢˜ã€‚

      * è§£å†³åŠæ³•ï¼šè¦ä½¿ç”¨ä¸åŒçš„å†…å­˜å•å…ƒï¼Œéœ€è¦æä¾›ä¸¤ä¸ªä½äºç¼“å†²åŒºä¸åŒçš„åœ°å€ï¼Œå¹¶ç¡®ä¿è¿™ä¸¤ä¸ªå†…å­˜å•å…ƒä¸é‡å ï¼š

        * ```c++
          pc1 = new (buffer) JustTesting;
          pc3 = new (buffer + sizeof (JustTesting)) JustTesting("Better Idea", 6);
          ```

        * å…¶ä¸­pc3ç›¸å¯¹äºpc1çš„åç§»é‡ä¸ºJustTestingå¯¹è±¡çš„å¤§å°ã€‚

    * 2ã€å°† delete ç”¨äº pc2å’Œpc4æ—¶ï¼Œå°†è‡ªåŠ¨è°ƒç”¨ä¸ºpc2å’Œpc4æŒ‡å‘åœ°å¯¹è±¡è°ƒç”¨ææ„å‡½æ•°ï¼›ç„¶è€Œï¼Œå°†delete[] ç”¨äºbufferæ—¶ï¼Œä¸ä¼šä¸ºä½¿ç”¨å®šä½ new è¿ç®—ç¬¦åˆ›å»ºåœ°å¯¹è±¡è°ƒç”¨ææ„å‡½æ•°ã€‚

      * è§£å†³åŠæ³•ï¼šå¦‚æœä½¿ç”¨å®šä½ new è¿ç®—ç¬¦æ¥ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼Œå¿…é¡»ç¡®ä¿å…¶ææ„å‡½æ•°è¢«è°ƒç”¨ã€‚

      * ```c++
        //å¯¹äºåœ¨å †ä¸­åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯ä»¥è¿™æ ·
        delete pc2;
        //ä½†ä¸èƒ½è¿™æ ·åš
        delete pc1;
        delete pc3;
        //å› ä¸ºdeleteå¯ä¸å¸¸è§„newè¿ç®—ç¬¦é…åˆä½¿ç”¨ï¼Œä½†ä¸èƒ½ä¸å®šä½newè¿ç®—ç¬¦é…åˆä½¿ç”¨ã€‚
        ```

      * delete [] buffer é‡Šæ”¾ä½¿ç”¨å¸¸è§„ new è¿ç®—ç¬¦åˆ†é…çš„æ•´ä¸ªå†…å­˜å—ï¼Œä½†å®ƒæ²¡æœ‰ä¸ºå®šä½ new è¿ç®—ç¬¦åœ¨è¯¥å†…å­˜å—ä¸­åˆ›å»ºçš„å¯¹è±¡è°ƒç”¨ææ„å‡½æ•°ï¼Œè§P458ã€‚

        * è§£å†³æ–¹æ¡ˆï¼šæ˜¾å¼åœ°ä½¿ç”¨å®šä½ new è¿ç®—ç¬¦åˆ›å»ºçš„å¯¹è±¡è°ƒç”¨ææ„å‡½æ•°ï¼š

          * ```c++
            pc3->~JustTesting();
            pc1->~JustTesting();
            ```

          * éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯æ­£ç¡®çš„åˆ é™¤é¡ºåºã€‚å¯¹äºä½¿ç”¨å®šä½ new è¿ç®—ç¬¦åˆ›å»ºçš„å¯¹è±¡ï¼Œåº”ä»¥ä¸åˆ›å»ºé¡ºåºç›¸åçš„é¡ºåºè¿›è¡Œåˆ é™¤ã€‚åŸå› åœ¨äºï¼Œæ™šåˆ›å»ºçš„å¯¹è±¡å¯èƒ½ä¾èµ–äºæ—©åˆ›å»ºçš„å¯¹è±¡ã€‚å¦å¤–ï¼Œåˆå½“æ‰€æœ‰å¯¹è±¡éƒ½è¢«é”€æ¯åï¼Œæ‰èƒ½é‡Šæ”¾ç”¨äºå­˜å‚¨è¿™äº›å¯¹è±¡çš„ç¼“å†²åŒºã€‚

* æ”¹è¿›åç¤ºä¾‹ï¼š

  * ```c++
    // ch12_09_placenew2.cpp -- new, placement new, no delete
    #include <iostream>
    #include <string>
    #include <new>
    using namespace std;
    const int BUF = 512;
    
    class JustTesting
    {
    private:
    	string words;
    	int number;
    public:
    	JustTesting(const string& s = "Just Testing", int n = 0)
    	{
    		words = s;
    		number = n;
    		cout << words << " constructed\n";
    	}
    	~JustTesting() { cout << words << " destroyed\n"; }
    	void Show() const { cout << words << ", " << number << endl; }
    };
    
    int main()
    {
    	char* buffer = new char[BUF];
    
    	JustTesting* pc1, * pc2;
    
    	pc1 = new (buffer) JustTesting;		// place object in buffer
    	pc2 = new JustTesting("Heap1", 20);	// place object on heap
    
    	cout << "Memory block addresses:\n" << "buffer: "
    		<< (void*)buffer << "     heap: " << pc2 << endl;
    	cout << "Memory contents:\n";
    	cout << pc1 << ": ";
    	pc1->Show();
    	cout << pc2 << ": ";
    	pc2->Show();
    
    	JustTesting* pc3, * pc4;
    // fix placement new location
    	pc3 = new (buffer + sizeof (JustTesting)) JustTesting("Better Idea", 6);
    	pc4 = new JustTesting("Heap2", 10);
    
    	cout << "Memory contents:\n";
    	cout << pc3 << ": ";
    	pc3->Show();
    	cout << pc4 << ": ";
    	pc4->Show();
    
    	delete pc2;
    	delete pc4;
    // explicitly destroy placement new objects
    	pc3->~JustTesting();
    	pc1->~JustTesting();
    	delete[] buffer;
    	cout << "Done\n";
    	return 0;
    }
    ```

* ç»“æœï¼š

  * ```c++
    Just Testing constructed
    Heap1 constructed
    Memory block addresses:
    buffer: 00F22C10     heap: 00F1CF18
    Memory contents:
    00F22C10: Just Testing, 0
    00F1CF18: Heap1, 20
    Better Idea constructed
    Heap2 constructed
    Memory contents:
    00F22C30: Better Idea, 6
    00F1C4E8: Heap2, 10
    Heap1 destroyed
    Heap2 destroyed
    Better Idea destroyed
    Just Testing destroyed
    Done
    ```



### 12.6 å¤ä¹ å„ç§æŠ€æœ¯

#### 12.6.1 é‡è½½<<è¿ç®—ç¬¦

è¦é‡æ–°å®šä¹‰<<è¿ç®—ç¬¦ï¼Œä»¥ä¾¿å°†å®ƒå’Œcoutä¸€èµ·ç”¨æ¥æ˜¾ç¤ºå¯¹è±¡çš„å†…å®¹ï¼Œåˆ™éœ€è¦å®šä¹‰ä¸‹é¢çš„å‹å…ƒè¿ç®—ç¬¦å‡½æ•°ï¼š

* ```c++
  ostream & operator<<(ostream & os, const c_name & obj)
  {
      os << ...;
      return os;
  }
  ```

* å…¶ä¸­ c_name æ˜¯ç±»åã€‚å¦‚æœè¯¥ç±»æä¾›äº†èƒ½å¤Ÿè¿”å›æ‰€éœ€å†…å®¹çš„å…¬æœ‰æ–¹æ³•ï¼Œåˆ™å¯åœ¨è¿ç®—ç¬¦å‡½æ•°ä¸­ä½¿ç”¨è¿™äº›æ³•ï¼Œè¿™æ ·ä¾¿ä¸ç”¨å°†å®ƒä»¬è®¾ç½®ä¸ºå‹å…ƒå‡½æ•°äº†ã€‚

#### 12.6.2 è½¬æ¢å‡½æ•°

è¦å°†å•ä¸ªå€¼è½¬æ¢ä¸ºç±»ç±»å‹ï¼Œéœ€è¦åˆ›å»ºåŸå‹å¦‚ä¸‹çš„ç±»æ„é€ å‡½æ•°ï¼š

* ```c++
  c_name(type_name value);
  ```

* c_nameï¼šç±»åï¼Œtype_nameï¼šè¦è½¬æ¢çš„ç±»å‹çš„åç§°

è¦å°†ç±»è½¬æ¢ä¸ºå…¶ä»–ç±»å‹ï¼Œéœ€è¦åˆ›å»ºåŸå‹å¦‚ä¸‹çš„ç±»æˆå‘˜å‡½æ•°ï¼š

* ```c++
  operator type_name();
  ```

* è™½ç„¶è¯¥å‡½æ•°æ²¡æœ‰å£°æ˜è¿”å›ç±»å‹ï¼Œä½†åº”è¿”å›æ‰€éœ€ç±»å‹çš„å€¼ã€‚

* ä½¿ç”¨è½¬æ¢å‡½æ•°æ—¶è¦å°å¿ƒã€‚å¯ä»¥åœ¨å£°æ˜æ„é€ å‡½æ•°æ—¶ä½¿ç”¨å…³é”®å­— explicitï¼Œä»¥é˜²æ­¢å®ƒè¢«ç”¨äºéšå¼è½¬æ¢ã€‚

#### 12.6.3 å…¶æ„é€ å‡½æ•°ä½¿ç”¨newçš„ç±»

å¦‚æœç±»ä½¿ç”¨newè¿ç®—ç¬¦æ¥åˆ†é…ç±»æˆå‘˜æŒ‡å‘çš„å†…å­˜ï¼Œåœ¨è®¾è®¡æ—¶åº”é‡‡å–ä¸€äº›é¢„é˜²æªæ–½ï¼š

* å¯¹äºæŒ‡å‘çš„å†…å­˜æ˜¯ç”± new åˆ†é…çš„æ‰€æœ‰ç±»æˆå‘˜ï¼Œéƒ½åº”åœ¨ç±»çš„ææ„å‡½æ•°ä¸­å¯¹å…¶ä½¿ç”¨ deleteï¼Œè¯¥è¿ç®—å°†é‡Šæ”¾åˆ†é…çš„å†…å­˜ã€‚

* å¦‚æœææ„å‡½æ•°é€šè¿‡å¯¹æŒ‡é’ˆç±»æˆå‘˜ä½¿ç”¨ delete æ¥é‡Šæ”¾å†…å­˜ï¼Œåˆ™æ¯ä¸ªæ„é€ å‡½æ•°éƒ½åº”å½“ä½¿ç”¨ new æ¥åˆåŒ–æŒ‡é’ˆï¼Œæˆ–å°†å®ƒè®¾ç½®ä¸ºç©ºæŒ‡é’ˆã€‚

* æ„é€ å‡½æ•°ä¸­è¦ä¹ˆä½¿ç”¨new[]ï¼Œè¦ä¹ˆä½¿ç”¨newï¼Œè€Œä¸èƒ½æ··ç”¨ã€‚å¦‚æœæ„é€ å‡½æ•°ä½¿ç”¨çš„æ˜¯ new[]]ï¼Œåˆ™æå‡½æ•°åº”ä½¿ç”¨ delete[]]ï¼›å¦‚æœæ„é€ å‡½æ•°ä½¿ç”¨çš„æ˜¯newï¼Œåˆ™ææ„å‡½æ•°åº”ä½¿ç”¨ deleteã€‚

* åº”å®šä¹‰ä¸€ä¸ªåˆ†é…å†…å­˜(è€Œä¸æ˜¯å°†æŒ‡é’ˆæŒ‡å‘å·²æœ‰å†…å­˜)çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚è¿™æ ·ç¨‹åºå°†èƒ½å¤Ÿå°†ç±»å¯¹åˆå§‹åŒ–ä¸ºå¦ä¸€ä¸ªç±»å¯¹è±¡ã€‚è¿™ç§æ„é€ å‡½æ•°çš„åŸå‹é€šå¸¸å¦‚ä¸‹ï¼š

  * ```C++
    className(const className &)
    ```

* åº”å®šä¹‰ä¸€ä¸ªé‡è½½èµ‹å€¼è¿ç®—ç¬¦çš„ç±»æˆå‘˜å‡½æ•°ï¼Œå…¶å‡½æ•°å®šä¹‰å¦‚ä¸‹(å…¶ä¸­ c_pinter æ˜¯ c_name çš„ç±»æˆå‘˜ï¼Œç±»å‹ä¸ºæŒ‡å‘ type_name çš„æŒ‡é’ˆ)ã€‚ä¸‹é¢çš„ç¤ºä¾‹å‡è®¾ä½¿ç”¨ new[] æ¥åˆå§‹åŒ–å˜é‡ c_pointerï¼š

  * ```c++
    c_name & c_name::operator=(const c_name & cn)
    {
        if (this == & cn)
            return *this;
        delete [] c_pointer;
        c_pointer = new type_name[size];
        ...
        return *this;
    }
    ```



### 12.7 é˜Ÿåˆ—æ¨¡æ‹Ÿ

* é˜Ÿåˆ—ï¼šå¯ä»¥å­˜å‚¨æœ‰åºçš„é¡¹ç›®åºåˆ—ã€‚
  * æ–°é¡¹ç›®è¢«æ·»åŠ åœ¨é˜Ÿå°¾ï¼Œå¹¶å¯ä»¥åˆ é™¤é˜Ÿé¦–çš„é¡¹ç›®ã€‚
  * é˜Ÿåˆ—ä¼˜ç‚¹åƒæ ˆï¼Œä½†æ ˆåœ¨åŒä¸€ç«¯è¿›è¡Œæ·»åŠ å’Œåˆ é™¤ã€‚
  * å› æ­¤æ ˆï¼šåè¿›å…ˆå‡ºï¼ˆLIFOï¼Œlast-inï¼Œfirst-outï¼‰ï¼Œé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼Œfirst-inï¼Œfirst-outï¼‰
  * æ¦‚å¿µä¸Šçœ‹ï¼Œé˜Ÿåˆ—å¥½æ¯”æ˜¯æ”¶æ¬¾å°æˆ–ATMå‰é¢æ’çš„é˜Ÿ
* é˜Ÿåˆ—æ¨¡æ‹Ÿæ–¹æ¡ˆï¼šï¼ˆé˜Ÿåˆ—ä¸­çš„é¡¹ç›®æ˜¯é¡¾å®¢ï¼ŒHeatheré“¶è¡Œçš„ä»£è¡¨ä»‹ç»è§P461ï¼Œè®¾è®¡ä¸€ä¸ªè¡¨ç¤ºé¡¾å®¢çš„ç±»ï¼›ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥æ¨¡æ‹Ÿé¡¾å®¢å’Œé˜Ÿåˆ—ä¹‹é—´çš„äº¤äº’ï¼‰
  * ![image](https://github.com/CoderSuHang/Cpp-Primer-Plus-Notes/assets/104765251/37b79b8b-63cf-4d55-b64a-59e2ce701248)

#### 12.7.1 é˜Ÿåˆ—ç±»

é¦–å…ˆè®¾è®¡ä¸€ä¸ªQueueç±»ï¼Œé˜Ÿåˆ—ç‰¹å¾å¦‚ä¸‹ï¼š

* é˜Ÿåˆ—å­˜å‚¨æœ‰åºçš„é¡¹ç›®åºåˆ—ï¼›
* é˜Ÿåˆ—æ‰€èƒ½å®¹çº³çš„é¡¹ç›®æ•°æœ‰ä¸€å®šçš„é™åˆ¶ï¼›
* åº”å½“èƒ½å¤Ÿåˆ›å»ºç©ºé˜Ÿåˆ—ï¼›
* åº”å½“èƒ½å¤Ÿæ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼›
* åº”å½“èƒ½å¤Ÿæ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦æ˜¯æ»¡çš„ï¼›
* åº”å½“èƒ½å¤Ÿåœ¨é˜Ÿå°¾æ·»åŠ é¡¹ç›®ï¼›
* åº”å½“èƒ½å¤Ÿä»é˜Ÿé¦–åˆ é™¤é¡¹ç›®ï¼›
* åº”å½“èƒ½å¤Ÿç¡®å®šé˜Ÿåˆ—ä¸­çš„é¡¹ç›®æ•°ã€‚

è®¾è®¡ç±»æ˜¯ï¼Œéœ€è¦å¼€å‘å…±æœ‰æ¥å£å’Œç§æœ‰æ¥å£ï¼š

**1ã€Queueç±»çš„æ¥å£**

* Queueç±»çš„å…±æœ‰æ¥å£ï¼š

  * ``` c++
    class Queue
    {
        enum {Q_SIZE = 10};
     private:
     // private representation to be developed later
     public:
        Queue(int qs = Q_SIZE);
        ~Queue();
        bool isempty() const;
        bool isfull() const;
        int queuecount() const;
        bool enqueue(const Item &item);
        bool dequeue(Item &item);
    };
    ```

  * æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªç©ºé˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé˜Ÿåˆ—æœ€å¤šå¯å­˜å‚¨ 10 ä¸ªé¡¹ç›®ï¼Œä½†æ˜¯å¯ä»¥ç”¨æ˜¾å¼åˆå§‹åŒ–å‚æ•°è¦†ç›–è¯¥é»˜è®¤å€¼ï¼š

    * ```c++
      Queue line1;
      Queue line2(20);
      ```

  * ä½¿ç”¨é˜Ÿåˆ—æ—¶ï¼Œå¯ä»¥ä½¿ç”¨typedefæ¥å®šä¹‰Itemã€‚

**2ã€Queueç±»çš„å®ç°**

ç¡®å®šæ¥å£åï¼Œä¾¿å¯ä»¥å®ç°å®ƒã€‚

* é¦–å…ˆï¼Œéœ€è¦ç¡®å®šå¦‚ä½•è¡¨ç¤ºé˜Ÿåˆ—æ•°æ®ï¼š

  * ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨newåŠ¨æ€åˆ†é…ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒåŒ…å«æ‰€éœ€çš„å…ƒç´ æ•°ã€‚ç„¶è€Œï¼Œå¯¹äºé˜Ÿåˆ—æ“ä½œæ¥è¯´ï¼Œæ•°ç»„å¹¶ä¸åˆé€‚ã€‚è§P462ï¼Œæ•°ç»„å®ç°å¾ªç¯å˜åŒ–è¾ƒéš¾ã€‚

  * å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨é“¾è¡¨ï¼Œèƒ½å¤Ÿå¾ˆå¥½åœ°æ»¡è¶³é˜Ÿåˆ—çš„è¦æ±‚ã€‚

    * é“¾è¡¨ç”±èŠ‚ç‚¹åºåˆ—æ„æˆï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸­éƒ½åŒ…å«è¦ä¿å­˜åˆ°é“¾è¡¨ä¸­çš„ä¿¡æ¯ä»¥åŠä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚

    * å¯¹äºè¿™é‡Œçš„é˜Ÿåˆ—æ¥è¯´ï¼Œæ•°æ®éƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªItemç±»å‹çš„å€¼ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç»“æ„æ¥è¡¨ç¤ºèŠ‚ç‚¹ï¼š

      * ```c++
        Struct Node
        {
            Item item;
            struct Node * next;
        };
        ```

    * å¦‚ä¸‹å›¾æ‰€ç¤ºæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½åªåŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚

      * ![image-20231214170101984](C:\Users\10482\AppData\Roaming\Typora\typora-user-images\image-20231214170101984.png)
      * é€šå¸¸ï¼Œé“¾è¡¨æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„æŒ‡é’ˆè¢«è®¾ç½®ä¸ºNULLæˆ–0ï¼Œä»¥æŒ‡å‡ºåé¢æ²¡æœ‰èŠ‚ç‚¹äº†ã€‚
      * è§P462ã€‚å¦‚ä½•è·Ÿè¸ªé“¾è¡¨èŠ‚ç‚¹ï¼š
        * ![image-20231214170528677](C:\Users\10482\AppData\Roaming\Typora\typora-user-images\image-20231214170528677.png)

* å…¶æ¬¡å¯¹ç±»çš„ç§æœ‰éƒ¨åˆ†è¿›è¡Œå£°æ˜ä¸ä¸‹é¢ç±»ä¼¼ï¼š

  * ```c++
    class Queue
    {
    private:
    // class scope definitions
        // Node is a nested structure definition local to this class
        struct Node { Item item; struct Node * next; };
        enum { Q_SIZE = 10 };
    // private class members
        Node * front;
        Node * rear;
        int items;
        const int qsize;
        ...
    public:
        ...
    };
    ```

  * ä¸Šè¿°å£°æ˜ä½¿ç”¨äº† C++ çš„ä¸€é¡¹ç‰¹æ€§ï¼šåœ¨ç±»ä¸­å¥—ç»“æ„æˆ–ç±»å£°æ˜ã€‚

    * é€šè¿‡å°† Node å£°æ˜æ”¾åœ¨ Oueue ç±»ä¸­å¯ä»¥ä½¿å…¶ä½œç”¨åŸŸä¸ºæ•´ä¸ªç±»ã€‚
    * ä¹Ÿå°±æ˜¯è¯´ï¼ŒNode æ˜¯è¿™æ ·ä¸€ç§ç±»å‹ï¼šå¯ä»¥ä½¿ç”¨å®ƒæ¥å£°æ˜ç±»æˆå‘˜ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä½œä¸ºç±»æ–¹æ³•ä¸­çš„ç±»å‹åç§°ï¼Œä½†åªèƒ½åœ¨ç±»ä¸­ä½¿ç”¨ã€‚
    * è¿™æ ·ï¼Œå°±ä¸å¿…æ‹…å¿ƒè¯¥ Node å£°æ˜ä¸æŸäº›å…¨å±€å£°æ˜æˆ–å…¶ä»–ç±»ä¸­å£°æ˜çš„ Node å‘ç”Ÿå†²çªã€‚æœ‰äº›è¾ƒè€çš„ç¼–è¯‘å™¨ä¸æ”¯æŒåµŒå¥—çš„ç»“æ„å’Œç±»ï¼Œå¦‚æœæ‚¨çš„ç¼–è¯‘å™¨æ˜¯è¿™æ ·çš„ï¼Œåˆ™å¿…é¡»å°† Nodeç»“æ„å®šä¹‰ä¸ºå…¨å±€çš„ï¼Œå°†å…¶ä½œç”¨åŸŸè®¾ç½®ä¸ºæ•´ä¸ªæ–‡ä»¶ã€‚
    * è¯¦æƒ…è§P463ã€‚

**3ã€ç±»æ–¹æ³•**

* ç±»æ„é€ å‡½æ•°åº”æä¾›ç±»æˆå‘˜çš„å€¼ã€‚è€Œåœ¨æœ¬ä¾‹ä¸­ï¼Œé˜Ÿåˆ—æœ€åˆæ˜¯ç©ºçš„ï¼Œå› æ­¤é˜Ÿé¦–å’Œé˜Ÿå°¾æŒ‡é’ˆéƒ½è®¾ç½®ä¸ºNULLæˆ–0æˆ–nullptrï¼Œå¹¶å°†itemsè®¾ç½®ä¸º0ã€‚å¦å¤–ï¼Œè¿˜åº”å°†é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦qsizeè®¾ç½®ä¸ºæ„é€ å‡½æ•°å‚æ•°qsçš„å€¼ã€‚ï¼ˆP464æœ‰æ— æ³•æ­£å¸¸è¿è¡Œæ¡ˆä¾‹ï¼‰

  * å¯¹äºconstæ•°æ®æˆå‘˜ï¼Œå¿…é¡»åœ¨æ‰§è¡Œåˆ°æ„é€ å‡½æ•°ä½“ä¹‹å‰ï¼Œå³åˆ›å»ºå¯¹è±¡æ—¶è¿›è¡Œåˆå§‹åŒ–ï¼š

    * æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨ï¼šç”±é€—å·åˆ†å‰²çš„åˆå§‹åŒ–åˆ—è¡¨ç»„æˆï¼ˆå‰é¢å¸¦æ‹¬å·ï¼‰ã€‚å®ƒä½äºå‚æ•°åˆ—è¡¨çš„å³æ‹¬å·ä¹‹åã€å‡½æ•°ä½“å·¦æ‹¬å·ä¹‹å‰ã€‚

      * å¦‚æœæ•°æ®æˆå‘˜åç§°ä¸ºmdataï¼Œå¹¶éœ€è¦å°†å®ƒåˆå§‹åŒ–ä¸ºvalï¼Œåˆ™åˆå§‹åŒ–å™¨ä¸ºmdata(val)ï¼š

      * ```c++
        Queue::Queue(int qs) : qsize(qs)
        {
            front = rear = NULL;
            items = 0;
        }
        ```

    * é€šå¸¸ï¼Œåˆå€¼å¯ä»¥æ˜¯å¸¸é‡æˆ–æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­çš„å‚æ•°ã€‚è¿™ç§æ–¹æ³•å¹¶ä¸é™äºåˆå§‹åŒ–å¸¸é‡ï¼Œå› æ­¤å¯å°†Queueæ„é€ å‡½æ•°å†™æˆå¦‚ä¸‹ï¼š

      * ```c++
        Queue::Queue(int qs) : qsize(qs), front(NULL), rear(NULL), items(0)
        {
            
        }
        ```

      * â—åªæœ‰æ„é€ å‡½æ•°å¯ä»¥ä½¿ç”¨è¿™ç§åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•ã€‚

        * å¯¹äºconstç±»æˆå‘˜ï¼Œå¿…é¡»ä½¿ç”¨è¿™ç§è¯­æ³•ã€‚

        * å¯¹äºè¢«å£°æ˜ä¸ºå¼•ç”¨çš„ç±»æˆå‘˜ï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨è¿™ç§è¯­æ³•ã€‚

          * ```c++
            class Agency {...};
            class Agent
            {
            private:
                Agency & belong;
                ...
            };
            Agent::Agent(Agency & a) : belong(a) {...}
            ```

          * è¿™æ˜¯å› ä¸ºå¼•ç”¨ä¸constæ•°æ®ç±»ä¼¼ï¼Œåªèƒ½åœ¨è¢«åˆ›å»ºæ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚

    * æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨è¯­æ³•è¯¦æƒ…è§P464ã€‚

  * C++çš„ç±»å†…åˆå§‹åŒ–ï¼š

    * å…è®¸ä»¥æ›´ç›´è§‚çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨**æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨**ç­‰ä»·ï¼š

      * ```c++
        class Classy
        {
            int mem1 = 10;
            const int mem2 = 20;
            //...
        };
        //ç­‰ä»·äº
        Classy::Classy() : mem1(10), mem2(20) {...}
        ```

* isempty()ã€isfull()å’Œqueuecount()çš„ä»£ç éƒ½éå¸¸ç®€å•ï¼š

  * å¦‚æœitemsä¸º0ï¼Œåˆ™é˜Ÿåˆ—ä¸ºç©ºï¼›å¦‚æœitemsç­‰äºqsizeï¼Œåˆ™é˜Ÿåˆ—ä¸ºæ»¡ã€‚å› æ­¤è¦çŸ¥é“é˜Ÿåˆ—ä¸­çš„é¡¹ç›®æ•°ï¼Œè¿”å›itemsçš„å€¼å³å¯ã€‚

* å°†é¡¹ç›®æ·»åŠ åˆ°é˜Ÿå°¾ï¼ˆå…¥é˜Ÿï¼‰çš„æ–¹æ³•ï¼š

  * ```c++
    bool Queue::enqueue(const Item & item)
    {
        if (isfull())
            return false;
        Node * add = new Node;	// create node
    // no failure, new throws std::bad_alloc excption
        add->item = item;
        add->next = NULL;
        items++;
        if (front == NULL)
            front = add;
        else
            rear->next = add;
        rear = add;
        return ture;
    }
    ```

  * ![image-20231214194334553](C:\Users\10482\AppData\Roaming\Typora\typora-user-images\image-20231214194334553.png)

#### 12.7.2 Customer ç±»

#### 12.7.3 ATMæ¨¡æ‹Ÿ
